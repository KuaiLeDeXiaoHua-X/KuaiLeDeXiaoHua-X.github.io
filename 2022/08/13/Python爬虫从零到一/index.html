<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="mes9s0">
    
    <title>
        
            Python爬虫从零到一 |
        
        Mes9s0&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/biaoti.jpeg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/xiaoxin.jpeg","favicon":"/images/biaoti.jpeg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"只是希望进步而已."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="CaiJiang's Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Mes9s0&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Python爬虫从零到一</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/xiaoxin.jpeg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">mes9s0</span>
                        
                            <span class="author-label">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-08-13 22:12:29</span>
        <span class="mobile">2022-08-13 22:12</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Python%E7%88%AC%E8%99%AB%E7%AF%87/">Python爬虫篇</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Python/">Python</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>20.1k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>96 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>​    无前言</p>
<h3 id="一"><a href="#一" class="headerlink" title="一"></a>一</h3><h4 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h4><p>​    robots.txt协议： 君⼦协议。规定了⽹站中哪些数据可以被爬⾍爬取，哪些数据不可以被爬取。一些网站的waf会拦，可以访问下看看有没有waf（不拦不代表没有）。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-073950.jpg"
                      alt="image-20220905153145473"
                ></p>
<h4 id="py字符集问题"><a href="#py字符集问题" class="headerlink" title="py字符集问题"></a>py字符集问题</h4><p>​    python里有一个open()函数，我们看看这个open()函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">file, mode=<span class="string">&#x27;r&#x27;</span>, buffering=<span class="literal">None</span>, encoding=<span class="literal">None</span>, errors=<span class="literal">None</span>, newline=<span class="literal">None</span>, closefd=<span class="literal">True</span></span>): <span class="comment"># known special case of open</span></span><br></pre></td></tr></table></figure>

<p>​    其中有一个encoding，其作用是当对文件进行操作的时候，是以指定的编码格式进行操作的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-073953.jpg"
                      alt="image-20220905154928627"
                ></p>
<p>​    如果乱码程序输出报错的，可以看看是不是这里出了问题。</p>
<h4 id="第一个小爬虫"><a href="#第一个小爬虫" class="headerlink" title="第一个小爬虫"></a>第一个小爬虫</h4><p>​    我们需要⽤代码来模拟⼀个浏览器, 然后同 样的输⼊百度的⽹址. 那么我们的程序应该也能拿到百度的内容。在python中, 我们可以直接⽤urllib模块来完成对浏览器的模拟⼯作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line">resp = urlopen(url)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.read())</span><br></pre></td></tr></table></figure>

<p>​    我们看到的回显是这样的，前面有一个b’，这其实代表字节，我们需要在程序里还原成字符串才可正常显示。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-073954.jpg"
                      alt="image-20220905155803589"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line">resp = urlopen(url)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.read().decode(<span class="string">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-073956.jpg"
                      alt="image-20220905160011971"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line">resp = urlopen(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;mybaidu.html&quot;</span>,mode=<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(resp.read().decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;over!&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="web请求剖析"><a href="#web请求剖析" class="headerlink" title="web请求剖析"></a>web请求剖析</h4><p>​    在访问百度的时候, 浏览器会把这⼀次请求发 送到百度的服务器(百度的⼀台电脑), 由服务器接收到这个请求, 然后 加载⼀些数据. 返回给浏览器, 再由浏览器进⾏显示. 听起来好像是个 废话…但是这⾥蕴含着⼀个极为重要的东⻄在⾥⾯, 注意, 百度的服 务器返回给浏览器的不直接是⻚⾯, ⽽是⻚⾯源代码(由html, css, js 组成). 由浏览器把⻚⾯源代码进⾏执⾏, 然后把执⾏之后的结果展示给⽤户。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-073958.jpg"
                      alt="image-20220905161042636"
                ></p>
<p>​    下面看看常见的页面渲染数据的过程，我们常⻅的⻚⾯渲染过程有两种。</p>
<h5 id="服务器渲染"><a href="#服务器渲染" class="headerlink" title="服务器渲染"></a>服务器渲染</h5><p>​    这个是最简单的. 含义呢就是我们在请求到服务 器的时候, 服务器直接把数据全部写⼊到html中, 我们浏览器就 能直接拿到带有数据的html内容. ⽐如, 由于数据是直接写在html中的, 所以我们能看到的数据都在⻚⾯ 源代码中能找的到的. 这种⽹⻚⼀般都相对⽐较容易就能抓取到⻚⾯内容。</p>
<h5 id="前端JS渲染"><a href="#前端JS渲染" class="headerlink" title="前端JS渲染"></a>前端JS渲染</h5><p>​    这种就稍显麻烦了. 这种机制⼀般是第⼀次请求服务器返回⼀堆 HTML框架结构. 然后再次请求到真正保存数据的服务器, 由这个 服务器返回数据, 最后在浏览器上对数据进⾏加载。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-73960.jpg"
                      alt="image-20220905161347999"
                ></p>
<p>​    这样做的好处是服务器那边能缓解压⼒. ⽽且分⼯明确. ⽐较容易维护。那数据是何时加载进来的呢? 其实就是在我们进⾏⻚⾯向下滚动 的时候, jd就在偷偷的加载数据了, 此时想要看到这个⻚⾯的加 载全过程, 我们就需要借助浏览器的调试⼯具了。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074001.jpg"
                      alt="image-20220905161638026"
                ></p>
<h4 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h4><p>​    HTTP协议, Hyper Text Transfer Protocol（超⽂本传输协议）的缩 写,是⽤于从万维⽹(WWW:World Wide Web)服务器传输超⽂本 到本地浏览器的传送协议. 直⽩点⼉, 就是浏览器和服务器之间的数 据交互遵守的就是HTTP协议.</p>
<p>​    请求:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请求⾏ -&gt; 请求⽅式(get/post) 请求url地址 协议</span><br><span class="line">请求头 -&gt; 放⼀些服务器要使⽤的附加信息</span><br><span class="line"></span><br><span class="line">请求体 -&gt; ⼀般放⼀些请求参数</span><br></pre></td></tr></table></figure>

<p>​    响应：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">状态⾏ -&gt; 协议 状态码</span><br><span class="line">响应头 -&gt; 放⼀些客户端要使⽤的⼀些附加信息</span><br><span class="line"></span><br><span class="line">响应体 -&gt; 服务器返回的真正客户端要⽤的内容(HTML,json)等</span><br></pre></td></tr></table></figure>

<p>​    写爬⾍的时候要格外注意请求头和响应头. 这两个地⽅⼀ 般都隐含着⼀些⽐较重要的内容。请求头中最常⻅的⼀些重要内容(爬⾍需要):</p>
<pre><code>1. User-Agent : 请求载体的身份标识(⽤啥发送的请求) 
1. Referer: 防盗链(这次请求是从哪个⻚⾯来的? 反爬会⽤到) 
1. cookie: 本地字符串数据信息(⽤户登录信息, 反爬的token)
</code></pre>
<p>​    响应头中⼀些重要的内容:</p>
<ol>
<li>cookie: 本地字符串数据信息(⽤户登录信息, 反爬的token) </li>
<li>各种神奇的莫名其妙的字符串(这个需要经验了, ⼀般都是token 字样, 防⽌各种攻击和反爬)</li>
</ol>
<h4 id="requests模块⼊⻔–GET"><a href="#requests模块⼊⻔–GET" class="headerlink" title="requests模块⼊⻔–GET"></a>requests模块⼊⻔–GET</h4><p>​    在前⾯⼩节中, 我们使⽤urllib来抓取⻚⾯源代码. 这个是python内置的⼀个模块. 但是, 它并不是我们常⽤的爬⾍⼯具. 常⽤的抓取⻚⾯的 模块通常使⽤⼀个第三⽅模块requests. 这个模块的优势就是⽐urllib 还要简单, 并且处理各种请求都⽐较⽅便</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install requests</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074002.jpg"
                      alt="image-20220905221222888"
                ></p>
<p>​    接下来我们来看看requests能带给我们什么。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">query = <span class="built_in">input</span>(<span class="string">&quot;输入一个人:&quot;</span>)</span><br><span class="line">url = <span class="string">f&#x27;https://www.sogou.com/web?query=<span class="subst">&#123;query&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url,headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kw = <span class="built_in">input</span>(<span class="string">&quot;请输⼊你要搜索的内容:&quot;</span>)</span><br><span class="line">response = requests.get(<span class="string">f&quot;https://www.sogou.com/web?query=<span class="subst">&#123;kw&#125;</span>&quot;</span>) <span class="comment"># 发送get请求</span></span><br><span class="line"><span class="comment"># print(response.text) # 直接拿结果(⽂本)</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;sogou.html&quot;</span>, mode=<span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line"> f.write(response.text)</span><br></pre></td></tr></table></figure>

<h4 id="requests模块⼊⻔–POST"><a href="#requests模块⼊⻔–POST" class="headerlink" title="requests模块⼊⻔–POST"></a>requests模块⼊⻔–POST</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://fanyi.baidu.com/sug&quot;</span></span><br><span class="line"></span><br><span class="line">s = <span class="built_in">input</span>(<span class="string">&quot;输入你要翻译的单词&quot;</span>)</span><br><span class="line">dat = &#123;</span><br><span class="line">    <span class="string">&quot;kw&quot;</span>:s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp =  requests.post(url,data=dat)</span><br><span class="line"><span class="built_in">print</span>(resp.json())</span><br><span class="line"></span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074004.jpg"
                      alt="image-20220905232130423"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">kw = <span class="built_in">input</span>(<span class="string">&quot;请输⼊你要翻译的英语单词:&quot;</span>)</span><br><span class="line">dic = &#123;</span><br><span class="line"> <span class="string">&quot;kw&quot;</span>: kw <span class="comment"># 这⾥要和抓包⼯具⾥的参数⼀致.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.post(<span class="string">&quot;https://fanyi.baidu.com/sug&quot;</span>,data=dic)</span><br><span class="line"><span class="comment"># 返回值是json 那就可以直接解析成json</span></span><br><span class="line">resp_json = resp.json()</span><br><span class="line"><span class="comment"># &#123;&#x27;errno&#x27;: 0, &#x27;data&#x27;: [&#123;&#x27;k&#x27;: &#x27;Apple&#x27;, &#x27;v&#x27;: &#x27;n.苹果公司，原称苹果电脑公司&#x27;....</span></span><br><span class="line"><span class="built_in">print</span>(resp_json[<span class="string">&#x27;data&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;v&#x27;</span>]) <span class="comment"># 拿到返回字典中的内容</span></span><br><span class="line"></span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074005.jpg"
                      alt="image-20220905233714269"
                ></p>
<h4 id="requests模块⼊⻔–GET进阶"><a href="#requests模块⼊⻔–GET进阶" class="headerlink" title="requests模块⼊⻔–GET进阶"></a>requests模块⼊⻔–GET进阶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/j/chart/top_list&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新封装参数</span></span><br><span class="line">param = &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;24&quot;</span>,</span><br><span class="line">    <span class="string">&quot;interval_id&quot;</span>: <span class="string">&quot;100:90&quot;</span>,</span><br><span class="line">    <span class="string">&quot;action&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;limit&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url=url, params=param,headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.json())</span><br><span class="line"></span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074007.jpg"
                      alt="image-20220906001100112"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/j/chart/top_list&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新封装参数</span></span><br><span class="line">param = &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;24&quot;</span>,</span><br><span class="line">    <span class="string">&quot;interval_id&quot;</span>: <span class="string">&quot;100:90&quot;</span>,</span><br><span class="line">    <span class="string">&quot;action&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;limit&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url=url, params=param,headers=headers)</span><br><span class="line"></span><br><span class="line">list_data = resp.json()</span><br><span class="line"></span><br><span class="line">fp = <span class="built_in">open</span>(<span class="string">&#x27;./douban.json&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">json.dump(list_data,fp=fp,ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;over!!!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">If ``ensure_ascii`` is false, then the strings written to ``fp`` can</span><br><span class="line">contain non-ASCII characters if they appear in strings contained in</span><br><span class="line">``obj``. Otherwise, all such characters are escaped in JSON strings.</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074008.jpg"
                      alt="image-20220906001855644"
                ></p>
<ol>
<li>爬⾍就是写程序去模拟浏览器⽤来抓取互联⽹上的内容</li>
<li>python中⾃带了⼀个urllib提供给我们进⾏简易爬⾍的编写 </li>
<li>requests模块的简单使⽤, 包括get, post两种⽅式的请求. 以及 User-Agent的介绍</li>
</ol>
<hr>
<h3 id="二"><a href="#二" class="headerlink" title="二"></a>二</h3><h4 id="数据解析概述"><a href="#数据解析概述" class="headerlink" title="数据解析概述"></a>数据解析概述</h4><p>​    在上⼀章中, 我们基本上掌握了抓取整个⽹⻚的基本技能. 但是呢, ⼤ 多数情况下, 我们并不需要整个⽹⻚的内容, 只是需要那么⼀⼩部分. 怎么办呢? 这就涉及到了数据提取的问题. </p>
<p>​    提供三种解析⽅式: </p>
<pre><code>1. re解析 
1. bs4解析 
1. xpath解析
</code></pre>
<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><p>​    Regular Expression, 正则表达式, ⼀种使⽤表达式的⽅式对字符串 进⾏匹配的语法规则.只要掌握了正则编写的逻辑关系, 写出⼀个提取⻚⾯内容的正则其实并不复杂。</p>
<p>​    正则的语法: 使⽤元字符进⾏排列组合⽤来匹配字符串</p>
<p>​    在线测试正则表达式<a class="link"   target="_blank" rel="noopener" href="https://tool.oschina.net/regex/" >https://tool.oschina.net/regex/<i class="fas fa-external-link-alt"></i></a> </p>
<p>​    元字符: 具有固定含义的特殊符号 </p>
<p>​    常⽤元字符:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">. 匹配除换⾏符以外的任意字符</span><br><span class="line">\w 匹配字⺟或数字或下划线</span><br><span class="line">\s 匹配任意的空⽩符</span><br><span class="line">\d 匹配数字</span><br><span class="line">\n 匹配⼀个换⾏符</span><br><span class="line">\t 匹配⼀个制表符</span><br><span class="line"></span><br><span class="line">^ 匹配字符串的开始</span><br><span class="line">$ 匹配字符串的结尾</span><br><span class="line"></span><br><span class="line">\W 匹配⾮字⺟或数字或下划线</span><br><span class="line">\D 匹配⾮数字</span><br><span class="line">\S 匹配⾮空⽩符</span><br><span class="line">a|b 匹配字符a或字符b</span><br><span class="line">() 匹配括号内的表达式，也表示⼀个组</span><br><span class="line">[...] 匹配字符组中的字符</span><br><span class="line">[^...] 匹配除了字符组中字符的所有字符</span><br></pre></td></tr></table></figure>

<p>​    量词: 控制前⾯的元字符出现的次数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 重复零次或更多次</span><br><span class="line">+ 重复⼀次或更多次</span><br><span class="line">? 重复零次或⼀次</span><br><span class="line">&#123;n&#125; 重复n次</span><br><span class="line">&#123;n,&#125; 重复n次或更多次</span><br><span class="line">&#123;n,m&#125; 重复n到m次</span><br></pre></td></tr></table></figure>

<p>​    贪婪匹配和惰性匹配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.* 贪婪匹配</span><br><span class="line">.*? 惰性匹配</span><br></pre></td></tr></table></figure>

<p>​    这两个要着重的说⼀下. 因为我们写爬⾍⽤的最多的就是这个惰性匹配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">str: 玩⼉吃鸡游戏, 晚上⼀起上游戏, ⼲嘛呢? 打游戏啊</span><br><span class="line">reg: 玩⼉.*?游戏</span><br><span class="line">结果: </span><br><span class="line">		玩⼉吃鸡游戏</span><br><span class="line">reg: 玩⼉.*游戏</span><br><span class="line">结果: </span><br><span class="line">		玩⼉吃鸡游戏, 晚上⼀起上游戏, ⼲嘛呢? 打游戏</span><br><span class="line"></span><br><span class="line">str: &lt;div&gt;胡辣汤&lt;/div&gt;</span><br><span class="line">reg: &lt;.*&gt;</span><br><span class="line">结果: </span><br><span class="line">		&lt;div&gt;胡辣汤&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">str: &lt;div&gt;胡辣汤&lt;/div&gt;</span><br><span class="line">reg: &lt;.*?&gt;</span><br><span class="line">结果:</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">str: &lt;div&gt;胡辣汤&lt;/div&gt;&lt;span&gt;饭团&lt;/span&gt;</span><br><span class="line">reg: &lt;div&gt;.*?&lt;/div&gt;</span><br><span class="line">结果:</span><br><span class="line">		&lt;div&gt;胡辣汤&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">str:abduaiaiuhfwhfioahwfxafjawofijawoifjx</span><br><span class="line">reg:.*?x</span><br><span class="line">结果:</span><br><span class="line">		abduaiaiuhfwhfioahwfx</span><br><span class="line">		afjawofijawoifjx</span><br></pre></td></tr></table></figure>

<p>​    能发现这样⼀个规律: .*? 表示尽可能少的匹配, .*表示尽可能多的匹配</p>
<h4 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h4><p>​    怎么在python程序中使⽤正则呢? 答案是re模块。re模块中我们只需要记住这么⼏个功能就⾜够我们使⽤了.</p>
<p>​    1、findall：匹配所有符合正则的内容。返回list</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lst = re.findall(<span class="string">&quot;m&quot;</span>, <span class="string">&quot;mai le fo len, mai nimei!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(lst) <span class="comment"># [&#x27;m&#x27;, &#x27;m&#x27;, &#x27;m&#x27;]</span></span><br><span class="line">lst = re.findall(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;5点之前. 你要给我5000万&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(lst) <span class="comment"># [&#x27;5&#x27;, &#x27;5000&#x27;]</span></span><br><span class="line">lst = re.findall(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;我的电话是10086，我女朋友电话10010&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(lst) <span class="comment"># [&#x27;10086&#x27;, &#x27;10010&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>​    2、finditer：匹配字符串中所有的内容[返回迭代器]，迭代器拿到数据需要.group</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it = re.finditer(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;我的电话10086，我女朋友的电话10010&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> it:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="built_in">print</span>(i.group())</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074009.jpg"
                      alt="image-20220907135829895"
                ></p>
<p>​    3、search，找到一个结果就返回，返回的结果是match对象，拿数据需要.group()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = re.search(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;我的电话10086，我女朋友的电话10010&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s.group()) <span class="comment"># 10086</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>​    4、match，从头开始匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1 = re.match(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;10086，我女朋友的电话10010&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s1.group()) <span class="comment"># 10086</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>​    5、compile，预加载正则表达式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&quot;\d+&quot;</span>)</span><br><span class="line">ret = obj.finditer(<span class="string">&quot;我的电话10086，我女朋友的电话10010&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ret:</span><br><span class="line">    <span class="built_in">print</span>(i.group())</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074010.jpg"
                      alt="image-20220907141941806"
                ></p>
<p>​    6、正则中的内容如何单独提取? 单独获取到正则中的具体内容可以给分组起名字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jay&#x27;&gt;&lt;span id=&#x27;1&#x27;&gt;周杰伦&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jj&#x27;&gt;&lt;span id=&#x27;2&#x27;&gt;林俊杰&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jolin&#x27;&gt;&lt;span id=&#x27;3&#x27;&gt;蔡依林&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;sylar&#x27;&gt;&lt;span id=&#x27;4&#x27;&gt;玛卡巴卡&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;tory&#x27;&gt;&lt;span id=&#x27;5&#x27;&gt;唔西迪西&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># re.S：让 . 可以匹配换行符</span></span><br><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&quot;&lt;div class=&#x27;.*?&#x27;&gt;&lt;span id=&#x27;\d+&#x27;&gt;.*?&lt;/span&gt;&lt;/div&gt;&quot;</span>, re.S)</span><br><span class="line">result = obj.finditer(s)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(it.group())</span><br></pre></td></tr></table></figure>

<p>​    按照之前的办法，我们看到的只是这样</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074012.jpg"
                      alt="image-20220907144846945"
                ></p>
<p>​    我们在组里加上(?P&lt;wahaha&gt;)这类相当于给组起名字，然后通过组拿到起名的内容，便可得到我们想要的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jay&#x27;&gt;&lt;span id=&#x27;1&#x27;&gt;周杰伦&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jj&#x27;&gt;&lt;span id=&#x27;2&#x27;&gt;林俊杰&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jolin&#x27;&gt;&lt;span id=&#x27;3&#x27;&gt;蔡依林&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;sylar&#x27;&gt;&lt;span id=&#x27;4&#x27;&gt;玛卡巴卡&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;tory&#x27;&gt;&lt;span id=&#x27;5&#x27;&gt;唔西迪西&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># re.S：让 . 可以匹配换行符</span></span><br><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&quot;&lt;div class=&#x27;.*?&#x27;&gt;&lt;span id=&#x27;\d+&#x27;&gt;(?P&lt;wahaha&gt;.*?)&lt;/span&gt;&lt;/div&gt;&quot;</span>, re.S)</span><br><span class="line">result = obj.finditer(s)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(it.group(<span class="string">&quot;wahaha&quot;</span>))</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074013.jpg"
                      alt="image-20220907150609578"
                ></p>
<h4 id="豆瓣top250电影排行榜"><a href="#豆瓣top250电影排行榜" class="headerlink" title="豆瓣top250电影排行榜"></a>豆瓣top250电影排行榜</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074015.jpg"
                      alt="image-20220907152411905"
                ></p>
<p>​    ⽬标: 抓取”电影名称”,”上映年份”,”评分”,”评分⼈数”四项内容.</p>
<p>​    ⾸先, 先看⼀下⻚⾯源代码. 数据是否是直接怼在源代码上的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074018.jpg"
                      alt="image-20220907152717524"
                ></p>
<p>​    很明显, 我们想要的数据全部都在⻚⾯源代码中体现了. 所以, 我们不 需要考虑js动态加载数据的情况了. 那么接下来就是编写爬⾍代码的 第⼀步了. 拿到⻚⾯源代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line"> <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; IntelMac OS X 10_15_4) AppleWebKit/537.36 (KHTML, likeGecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/top250?start=0&amp;filter=&quot;</span></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<p>​    从⻚⾯源代码中提取我们需要的内容. 这时候我们就可以去写正则了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拿到页面源代码 requests</span></span><br><span class="line"><span class="comment"># 通过re来提取想要的信息 re</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/top250&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                  <span class="string">&quot;Chrome/104.0.0.0 Safari/537.36 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line">page_content = resp.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析数据</span></span><br><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;li&gt;.*?&lt;div class=&quot;item&quot;&gt;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;name&gt;.*?)&lt;/span&gt;&#x27;</span>, re.S)</span><br><span class="line">result = obj.finditer(page_content)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(it.group(<span class="string">&quot;name&quot;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074021.jpg"
                      alt="image-20220907153939408"
                ></p>
<p>​    可以看到已经获取了名字，下面我们继续写其他的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拿到页面源代码 requests</span></span><br><span class="line"><span class="comment"># 通过re来提取想要的信息 re</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/top250&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                  <span class="string">&quot;Chrome/104.0.0.0 Safari/537.36 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line">page_content = resp.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析数据</span></span><br><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;li&gt;.*?&lt;div class=&quot;item&quot;&gt;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;name&gt;.*?)&lt;/span&gt;.*?&#x27;</span></span><br><span class="line">                 <span class="string">r&#x27;&lt;p class=&quot;&quot;&gt;.*?&lt;br&gt;(?P&lt;year&gt;.*?)&amp;nbsp.*?&#x27;</span></span><br><span class="line">                 <span class="string">r&#x27;&lt;span class=&quot;rating_num&quot; property=&quot;v:average&quot;&gt;(?P&lt;score&gt;.*?)&lt;/span&gt;.*?&#x27;</span></span><br><span class="line">                 <span class="string">r&#x27;&lt;span&gt;(?P&lt;num&gt;.*?)人评价&lt;/span&gt;&#x27;</span>, re.S)</span><br><span class="line">result = obj.finditer(page_content)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(it.group(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(it.group(<span class="string">&quot;score&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(it.group(<span class="string">&quot;num&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(it.group(<span class="string">&quot;year&quot;</span>).strip())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074023.jpg"
                      alt="image-20220907160353737"
                ></p>
<p>​    保存到文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拿到页面源代码 requests</span></span><br><span class="line"><span class="comment"># 通过re来提取想要的信息 re</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/top250&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                  <span class="string">&quot;Chrome/104.0.0.0 Safari/537.36 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line">page_content = resp.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析数据</span></span><br><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;li&gt;.*?&lt;div class=&quot;item&quot;&gt;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;name&gt;.*?)&lt;/span&gt;.*?&#x27;</span></span><br><span class="line">                 <span class="string">r&#x27;&lt;p class=&quot;&quot;&gt;.*?&lt;br&gt;(?P&lt;year&gt;.*?)&amp;nbsp.*?&#x27;</span></span><br><span class="line">                 <span class="string">r&#x27;&lt;span class=&quot;rating_num&quot; property=&quot;v:average&quot;&gt;(?P&lt;score&gt;.*?)&lt;/span&gt;.*?&#x27;</span></span><br><span class="line">                 <span class="string">r&#x27;&lt;span&gt;(?P&lt;num&gt;.*?)人评价&lt;/span&gt;&#x27;</span>, re.S)</span><br><span class="line">result = obj.finditer(page_content)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;data.csv&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">csvwriter = csv.writer(f)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result:</span><br><span class="line">    <span class="comment"># print(it.group(&quot;name&quot;))</span></span><br><span class="line">    <span class="comment"># print(it.group(&quot;score&quot;))</span></span><br><span class="line">    <span class="comment"># print(it.group(&quot;num&quot;))</span></span><br><span class="line">    <span class="comment"># print(it.group(&quot;year&quot;).strip())</span></span><br><span class="line">    dic = it.groupdict()</span><br><span class="line">    dic[<span class="string">&#x27;year&#x27;</span>] = dic[<span class="string">&#x27;year&#x27;</span>].strip()</span><br><span class="line">    csvwriter.writerow(dic.values())</span><br><span class="line"></span><br><span class="line">resp.close()</span><br><span class="line">f.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;over!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>​    目前我们只能抓到前25条。事实上只要修改url变可以拿到全部数据，后续有时间补全。</p>
<h4 id="电影天堂yyds"><a href="#电影天堂yyds" class="headerlink" title="电影天堂yyds"></a>电影天堂yyds</h4><p>​    需要以下三步</p>
<p>​    1、定位到2022必看片</p>
<p>​    2、从2022必看片中提取到子页面的链接地址</p>
<p>​    3、请求子页面的链接地址。拿到我们想要的下载地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">domain = <span class="string">&quot;https://www.dytt89.com/&quot;</span></span><br><span class="line">resp = requests.get(domain)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<p>​    先拿到页面数据，应该是这样的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074024.jpg"
                      alt="image-20220907204713566"
                ></p>
<p>​    如果报错的话，设置verify=False，且设置编码格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">domain = <span class="string">&quot;https://www.dytt89.com/&quot;</span></span><br><span class="line">resp = requests.get(domain, verify=<span class="literal">False</span>)</span><br><span class="line">resp.encoding = <span class="string">&#x27;gb2312&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074026.jpg"
                      alt="image-20220907205117836"
                ></p>
<p>​    然后拿到ul里的li，也就是2022必看热片里的内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">domain = <span class="string">&quot;https://www.dytt89.com/&quot;</span></span><br><span class="line">resp = requests.get(domain, verify=<span class="literal">False</span>)</span><br><span class="line">resp.encoding = <span class="string">&#x27;gb2312&#x27;</span></span><br><span class="line"></span><br><span class="line">obj1 = re.<span class="built_in">compile</span>(<span class="string">r&quot;2022必看热片.*?&lt;ul&gt;(?P&lt;ul&gt;.*?)&lt;/ul&gt;&quot;</span>, re.S)</span><br><span class="line">result1 = obj1.finditer(resp.text)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result1:</span><br><span class="line">    ul = it.group(<span class="string">&#x27;ul&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(ul)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074027.jpg"
                      alt="image-20220907210337215"
                ></p>
<p>​    接下类进行第二件事，从2022必看片中提取到子页面的链接地址</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074028.jpg"
                      alt="image-20220907210923606"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">domain = <span class="string">&quot;https://www.dytt89.com/&quot;</span></span><br><span class="line">resp = requests.get(domain, verify=<span class="literal">False</span>)</span><br><span class="line">resp.encoding = <span class="string">&#x27;gb2312&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拿到ul里的li</span></span><br><span class="line">obj1 = re.<span class="built_in">compile</span>(<span class="string">r&quot;2022必看热片.*?&lt;ul&gt;(?P&lt;ul&gt;.*?)&lt;/ul&gt;&quot;</span>, re.S)</span><br><span class="line">obj2 = re.<span class="built_in">compile</span>(<span class="string">r&quot;&lt;a href=&#x27;(?P&lt;href&gt;.*?)&#x27;&quot;</span>,re.S)</span><br><span class="line">result1 = obj1.finditer(resp.text)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result1:</span><br><span class="line">    ul = it.group(<span class="string">&#x27;ul&#x27;</span>)</span><br><span class="line"><span class="comment"># 提取子页面链接</span></span><br><span class="line">    result2 = obj2.finditer(ul)</span><br><span class="line">    <span class="keyword">for</span> itt <span class="keyword">in</span> result2:</span><br><span class="line">        <span class="built_in">print</span>(itt.group(<span class="string">&#x27;href&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074029.jpg"
                      alt="image-20220907211829463"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">domain = <span class="string">&quot;https://www.dytt89.com/&quot;</span></span><br><span class="line">resp = requests.get(domain, verify=<span class="literal">False</span>)</span><br><span class="line">resp.encoding = <span class="string">&#x27;gb2312&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拿到ul里的li</span></span><br><span class="line">obj1 = re.<span class="built_in">compile</span>(<span class="string">r&quot;2022必看热片.*?&lt;ul&gt;(?P&lt;ul&gt;.*?)&lt;/ul&gt;&quot;</span>, re.S)</span><br><span class="line">obj2 = re.<span class="built_in">compile</span>(<span class="string">r&quot;&lt;a href=&#x27;(?P&lt;href&gt;.*?)&#x27;&quot;</span>, re.S)</span><br><span class="line">obj3 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;◎片　　名(?P&lt;movie&gt;.*?)&lt;br /&gt;.*? &lt;td &#x27;</span></span><br><span class="line">                  <span class="string">r&#x27;style=&quot;WORD-WRAP: break-word&quot; bgcolor=&quot;#fdfddf&quot;&gt;&lt;a href=&quot;(?P&lt;download&gt;.*?)&quot;&gt;&#x27;</span>, re.S)</span><br><span class="line"></span><br><span class="line">result1 = obj1.finditer(resp.text)</span><br><span class="line"></span><br><span class="line">child_href_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result1:</span><br><span class="line">    ul = it.group(<span class="string">&#x27;ul&#x27;</span>)</span><br><span class="line">    <span class="comment"># 提取子页面链接</span></span><br><span class="line">    result2 = obj2.finditer(ul)</span><br><span class="line">    <span class="keyword">for</span> itt <span class="keyword">in</span> result2:</span><br><span class="line">        <span class="comment"># 拼接子页面的url地址：域名 + 子页面地址</span></span><br><span class="line">        child_href = domain + itt.group(<span class="string">&#x27;href&#x27;</span>).strip(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">        child_href_list.append(child_href)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取子页面内容</span></span><br><span class="line"><span class="keyword">for</span> href <span class="keyword">in</span> child_href_list:</span><br><span class="line">    child_resp = requests.get(href, verify=<span class="literal">False</span>)</span><br><span class="line">    child_resp.encoding = <span class="string">&#x27;gb2312&#x27;</span></span><br><span class="line">    result3 = obj3.search(child_resp.text)</span><br><span class="line">    <span class="built_in">print</span>(result3.group(<span class="string">&quot;movie&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(result3.group(<span class="string">&quot;download&quot;</span>))</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074031.jpg"
                      alt="image-20220907214048829"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aifc</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">domain = <span class="string">&quot;https://www.dytt89.com/&quot;</span></span><br><span class="line">resp = requests.get(domain)</span><br><span class="line">resp.encoding = <span class="string">&#x27;gb2312&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拿到ul里的li</span></span><br><span class="line">obj1 = re.<span class="built_in">compile</span>(<span class="string">r&quot;2022必看热片.*?&lt;ul&gt;(?P&lt;ul&gt;.*?)&lt;/ul&gt;&quot;</span>, re.S)</span><br><span class="line">obj2 = re.<span class="built_in">compile</span>(<span class="string">r&quot;&lt;a href=&#x27;(?P&lt;href&gt;.*?)&#x27;&quot;</span>, re.S)</span><br><span class="line">obj3 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;◎片　　名(?P&lt;movie&gt;.*?)&lt;br /&gt;.*? &lt;td &#x27;</span></span><br><span class="line">                  <span class="string">r&#x27;style=&quot;WORD-WRAP: break-word&quot; bgcolor=&quot;#fdfddf&quot;&gt;&lt;a href=&quot;(?P&lt;download&gt;.*?)&quot;&gt;&#x27;</span>, re.S)</span><br><span class="line"></span><br><span class="line">result1 = obj1.finditer(resp.text)</span><br><span class="line"></span><br><span class="line">child_href_list = []</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;dytt.csv&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">csvwrite1 = csv.writer(f)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result1:</span><br><span class="line">    ul = it.group(<span class="string">&#x27;ul&#x27;</span>)</span><br><span class="line">    <span class="comment"># 提取子页面链接</span></span><br><span class="line">    result2 = obj2.finditer(ul)</span><br><span class="line">    <span class="keyword">for</span> itt <span class="keyword">in</span> result2:</span><br><span class="line">        <span class="comment"># 拼接子页面的url地址：域名 + 子页面地址</span></span><br><span class="line">        child_href = domain + itt.group(<span class="string">&#x27;href&#x27;</span>).strip(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">        child_href_list.append(child_href)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取子页面内容</span></span><br><span class="line"><span class="keyword">for</span> href <span class="keyword">in</span> child_href_list:</span><br><span class="line">    child_resp = requests.get(href)</span><br><span class="line">    child_resp.encoding = <span class="string">&#x27;gb2312&#x27;</span></span><br><span class="line">    result3 = obj3.finditer(child_resp.text)</span><br><span class="line">    <span class="keyword">for</span> ittt <span class="keyword">in</span> result3:</span><br><span class="line">        <span class="built_in">print</span>(ittt.group(<span class="string">&quot;movie&quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(ittt.group(<span class="string">&quot;download&quot;</span>))</span><br><span class="line">        dic = ittt.groupdict()</span><br><span class="line">        csvwrite1.writerow(dic.values())</span><br><span class="line"></span><br><span class="line">resp.close()</span><br><span class="line">f.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;over&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074032.jpg"
                      alt="image-20220907221714766"
                ></p>
<h4 id="bs4解析前戏-html语法规则"><a href="#bs4解析前戏-html语法规则" class="headerlink" title="bs4解析前戏-html语法规则"></a>bs4解析前戏-html语法规则</h4><p>​    HTML(Hyper Text Markup Language)超⽂本标记语⾔, 是我们编写 ⽹⻚的最基本也是最核⼼的⼀种语⾔. 其语法规则就是⽤不同的标签 对⽹⻚上的内容进⾏标记, 从⽽使⽹⻚显示出不同的展示效果. </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;</span><br><span class="line"> 我爱你</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p>​    上述代码的含义是在⻚⾯中显示”我爱你”三个字, 但是我爱你三个字 被”&lt;h1&gt;“和&lt;h1&gt;标记了. ⽩话就是被括起来了. 被H1这个标签括 起来了. 这个时候. 浏览器在展示的时候就会让我爱你变粗变⼤. 俗称 标题, 所以HTML的语法就是⽤类似这样的标签对⻚⾯内容进⾏标记. 不同的标签表现出来的效果也是不⼀样的.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h1: ⼀级标题</span><br><span class="line">h2: ⼆级标题</span><br><span class="line">p: 段落</span><br><span class="line">font: 字体(被废弃了, 但能⽤)</span><br><span class="line">body: 主体</span><br></pre></td></tr></table></figure>

<p>​    标签我们明⽩了, 接下来就是属性了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;</span><br><span class="line"> 我爱你</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">&#x27;right&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> 我爱你妹</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>​    这两个标签都是h1标签, 都是⼀级标题, 但是下⾯这个会显示 在右边. 也就是说, 通过xxx=xxx这种形式对h1标签进⼀步的说明了. 那么这种语法在html中被称为标签的属性. 并且属性可以有很多个.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;body text=<span class="string">&quot;green&quot;</span> bgcolor=<span class="string">&quot;#eee&quot;</span>&gt;</span><br><span class="line"> 你看我的颜⾊. 贼健康</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p>​    有了这些知识, 我们再去看bs4就会得⼼应⼿了. 因为bs4就是通过标 签和属性去定位⻚⾯上的内容的.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;1&quot;</span> <span class="keyword">class</span>-<span class="string">&quot;h1&quot;</span>&gt;周杰伦&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;h1&quot;</span>&gt;</span>林俊杰<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id-</span>&quot;<span class="attr">3</span>&quot; <span class="attr">class</span>=<span class="string">&quot;h1&quot;</span>&gt;</span>麻花藤<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;h1&quot;</span>&gt;</span>天老鸭<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id-</span>&quot;<span class="attr">5</span>&quot; <span class="attr">class</span>=<span class="string">&quot;h4&quot;</span>&gt;</span>李多海<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cLass</span>=<span class="string">&quot;h5&quot;</span>&gt;</span>厉害多<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>XXxxx<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">＃ 通过标签名称来拿到数据</span><br><span class="line"># div -&gt; <span class="attr">id</span>:<span class="number">3</span> =&gt; 麻花藤</span><br><span class="line"># div -&gt; <span class="attr">class</span>:<span class="function"><span class="params">h4</span> =&gt;</span> 李多海</span><br><span class="line"># bs4</span><br></pre></td></tr></table></figure>

<h4 id="bs4解析入门-豆瓣top获取"><a href="#bs4解析入门-豆瓣top获取" class="headerlink" title="bs4解析入门-豆瓣top获取"></a>bs4解析入门-豆瓣top获取</h4><p>​    1、拿到页面源代码，和之前类似</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/top250?start=0&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                  <span class="string">&quot;Chrome/104.0.0.0 Safari/537.36 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<p>​    2、把页面源码交给Beautifulsoup处理，生成bs对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、把页面源码交给Beautifulsoup处理，生成bs4对象</span></span><br><span class="line">page = BeautifulSoup(resp.text)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074033.jpg"
                      alt="image-20220909160846391"
                ></p>
<p>​    这是因为bs不知道是什么类型的源码，会先当成html解析。我们告诉他是html即可消除</p>
<p>​    3、从bs对象中查找数据</p>
<p>​    find(标签，属性=值) 只找第一个</p>
<p>​    find_all(标签，属性=值) 全部都找</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、拿到页面源代码</span></span><br><span class="line"><span class="comment"># 2、使用bs4进行解析，拿到数据</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/top250?start=0&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                  <span class="string">&quot;Chrome/104.0.0.0 Safari/537.36 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析数据</span></span><br><span class="line"><span class="comment"># 1、把页面源码交给Beautifulsoup处理，生成bs4对象</span></span><br><span class="line">page = BeautifulSoup(resp.text, <span class="string">&quot;html.parser&quot;</span>)  <span class="comment"># 指定html解析器</span></span><br><span class="line"><span class="comment"># 2、从bs对象中查找数据</span></span><br><span class="line"><span class="comment"># find(标签，属性=值) 只找第一个</span></span><br><span class="line"><span class="comment"># find_all(标签，属性=值) 全部都找</span></span><br><span class="line">title = page.find(<span class="string">&quot;span&quot;</span>, class_=<span class="string">&quot;title&quot;</span>)  <span class="comment"># class是python的关键字，所以要换个写法</span></span><br><span class="line"><span class="built_in">print</span>(title)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074035.jpg"
                      alt="image-20220909172836510"
                ></p>
<p>​    另一种写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、拿到页面源代码</span></span><br><span class="line"><span class="comment"># 2、使用bs4进行解析，拿到数据</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/top250?start=0&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                  <span class="string">&quot;Chrome/104.0.0.0 Safari/537.36 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析数据</span></span><br><span class="line"><span class="comment"># 1、把页面源码交给Beautifulsoup处理，生成bs4对象</span></span><br><span class="line">page = BeautifulSoup(resp.text, <span class="string">&quot;html.parser&quot;</span>)  <span class="comment"># 指定html解析器</span></span><br><span class="line"><span class="comment"># 2、从bs对象中查找数据</span></span><br><span class="line"><span class="comment"># find(标签，属性=值) 只找第一个</span></span><br><span class="line"><span class="comment"># find_all(标签，属性=值) 全部都找</span></span><br><span class="line"><span class="comment"># title = page.find(&quot;span&quot;, class_=&quot;title&quot;)  # class是python的关键字，所以要换个写法</span></span><br><span class="line">title = page.find(<span class="string">&quot;span&quot;</span>, attrs=&#123;<span class="string">&quot;class&quot;</span>: <span class="string">&quot;title&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(title)</span><br><span class="line"></span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<h4 id="bs4解析入门-新发地爬虫"><a href="#bs4解析入门-新发地爬虫" class="headerlink" title="bs4解析入门-新发地爬虫"></a>bs4解析入门-新发地爬虫</h4><p>​    这是最开始的程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">resp = requests.get(<span class="string">&quot;http://www.xinfadi.com.cn/marketanalysis/0/list/1.shtml&quot;</span>)</span><br><span class="line">page = BeautifulSoup(resp.text,<span class="string">&quot;html.paser&quot;</span>)</span><br><span class="line">table = page.find(<span class="string">&quot;table&quot;</span>, class_=<span class="string">&quot;hq_table&quot;</span>)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;新发地.csv&quot;</span>, mode=<span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">cv_writer = csv.writer(f)</span><br><span class="line"><span class="comment"># 提取到所有tr</span></span><br><span class="line">tr_list = table.find_all(<span class="string">&quot;tr&quot;</span>)[<span class="number">1</span>:] <span class="comment"># 注意,第⼀⾏并不是我想要的数据. (第⼀⾏是表头)</span></span><br><span class="line"><span class="keyword">for</span> tr <span class="keyword">in</span> tr_list:</span><br><span class="line">	td_list = tr.find_all(<span class="string">&quot;td&quot;</span>)</span><br><span class="line">	name = td_list[<span class="number">0</span>].text <span class="comment"># 获取⽂本内容</span></span><br><span class="line">	low = td_list[<span class="number">1</span>].text</span><br><span class="line">	avg = td_list[<span class="number">2</span>].text</span><br><span class="line">	high = td_list[<span class="number">3</span>].text</span><br><span class="line">	gui = td_list[<span class="number">4</span>].text</span><br><span class="line">	dan = td_list[<span class="number">5</span>].text</span><br><span class="line">	day = td_list[<span class="number">6</span>].text</span><br><span class="line">	cv_writer.writerow([name, low, avg, high,gui, dan, day])</span><br><span class="line">f.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;搞定&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>​    去看的时候已经改掉了，改成了前端js渲染，这里也写一个小爬虫，可自行参考</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.xinfadi.com.cn/getPriceData.html&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                  <span class="string">&quot;Chrome/104.0.0.0 Safari/537.36 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = <span class="string">&quot;limit=&amp;current=&amp;pubDateStartTime=&amp;pubDateEndTime=&amp;prodPcatid=&amp;prodCatid=&amp;prodName=&quot;</span></span><br><span class="line"></span><br><span class="line">resp = requests.post(url, headers=headers, data=data)</span><br><span class="line">respdata = resp.json()</span><br><span class="line">pricedata = respdata[<span class="string">&#x27;list&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> pd <span class="keyword">in</span> pricedata:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;名字: &quot;</span>+pd[<span class="string">&#x27;prodName&#x27;</span>] + <span class="string">&quot; 最低价格: &quot;</span>+pd[<span class="string">&#x27;lowPrice&#x27;</span>]+<span class="string">&quot; 最高价格: &quot;</span>+pd[<span class="string">&#x27;highPrice&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074036.jpg"
                      alt="image-20220909182618978"
                ></p>
<h4 id="抓取唯美壁纸图片"><a href="#抓取唯美壁纸图片" class="headerlink" title="抓取唯美壁纸图片"></a>抓取唯美壁纸图片</h4><p>​    url:<a class="link"   target="_blank" rel="noopener" href="https://www.umei.cc/bizhitupian/weimeibizhi/" >https://www.umei.cc/bizhitupian/weimeibizhi/<i class="fas fa-external-link-alt"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074040.jpg"
                      alt="image-20220909213318770"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74042.jpg"
                      alt="image-20220909214725010"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074044.jpg"
                      alt="image-20220909224457523"
                ></p>
<p>​    1.拿到主页面的源代码，拿到链接地址 ,href</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.umei.cc/bizhitupian/weimeibizhi/&quot;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line">resp.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<p>​    2.源代码交给bs</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">main_page = BeautifulSoup(resp.text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">alist = main_page.find(<span class="string">&quot;div&quot;</span>, class_=<span class="string">&quot;pic-box&quot;</span>).find_all(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br></pre></td></tr></table></figure>

<p>​    3.拼接url拿到子链接地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.拿到主页面的源代码，拿到链接地址 ,href</span></span><br><span class="line"><span class="comment"># 2、通过href拿到子页面的内容，从子页面中找到图片的下载地址  img -&gt; src</span></span><br><span class="line"><span class="comment"># 3、下载图片</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">child_href_list = []</span><br><span class="line"></span><br><span class="line">urlhome = <span class="string">&quot;https://www.umei.cc&quot;</span></span><br><span class="line">url = <span class="string">&quot;https://www.umei.cc/bizhitupian/weimeibizhi/&quot;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line">resp.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码交给bs</span></span><br><span class="line">main_page = BeautifulSoup(resp.text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">alist = main_page.find(<span class="string">&quot;div&quot;</span>, class_=<span class="string">&quot;pic-box&quot;</span>).find_all(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="comment"># print(alist)</span></span><br><span class="line"><span class="comment"># for a in alist:</span></span><br><span class="line"><span class="comment">#     print(a.get(&#x27;href&#x27;))  # 拿到的是href里的值</span></span><br><span class="line"><span class="keyword">for</span> hrefList <span class="keyword">in</span> alist:</span><br><span class="line">    child_href = urlhome + hrefList.get(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">    child_href_list.append(child_href)</span><br><span class="line"><span class="built_in">print</span>(child_href_list)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074048.jpg"
                      alt="image-20220909224544336"
                ></p>
<p>​    看看子页面</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074050.jpg"
                      alt="image-20220909225940673"
                ></p>
<p>​    提取子页面内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.拿到主页面的源代码，拿到链接地址 ,href</span></span><br><span class="line"><span class="comment"># 2、通过href拿到子页面的内容，从子页面中找到图片的下载地址  img -&gt; src</span></span><br><span class="line"><span class="comment"># 3、下载图片</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">child_href_list = []</span><br><span class="line"></span><br><span class="line">urlhome = <span class="string">&quot;https://www.umei.cc&quot;</span></span><br><span class="line">url = <span class="string">&quot;https://www.umei.cc/bizhitupian/weimeibizhi/&quot;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line">resp.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码交给bs</span></span><br><span class="line">main_page = BeautifulSoup(resp.text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">alist = main_page.find(<span class="string">&quot;div&quot;</span>, class_=<span class="string">&quot;pic-box&quot;</span>).find_all(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="comment"># print(alist)</span></span><br><span class="line"><span class="comment"># for a in alist:</span></span><br><span class="line"><span class="comment">#     print(a.get(&#x27;href&#x27;))  # 拿到的是href里的值</span></span><br><span class="line"><span class="keyword">for</span> hrefList <span class="keyword">in</span> alist:</span><br><span class="line">    href = hrefList.get(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> href:</span><br><span class="line">        child_href = urlhome + href</span><br><span class="line">        child_href_list.append(child_href)</span><br><span class="line"><span class="comment"># print(child_href_list)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取子页面内容</span></span><br><span class="line"><span class="keyword">for</span> href <span class="keyword">in</span> child_href_list:</span><br><span class="line">    child_resp = requests.get(href)</span><br><span class="line">    child_resp.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    child_page_text = child_resp.text</span><br><span class="line">    <span class="comment"># print(child_page_text)</span></span><br><span class="line">    child_page = BeautifulSoup(child_page_text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    img = child_page.find(<span class="string">&quot;section&quot;</span>, class_=<span class="string">&quot;img-content&quot;</span>).find(<span class="string">&quot;img&quot;</span>)</span><br><span class="line">    src = img.get(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">    <span class="comment"># print(src)</span></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74051.jpg"
                      alt="image-20220911141107707"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.拿到主页面的源代码，拿到链接地址 ,href</span></span><br><span class="line"><span class="comment"># 2、通过href拿到子页面的内容，从子页面中找到图片的下载地址  img -&gt; src</span></span><br><span class="line"><span class="comment"># 3、下载图片</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">child_href_list = []</span><br><span class="line"></span><br><span class="line">urlhome = <span class="string">&quot;https://www.umei.cc&quot;</span></span><br><span class="line">url = <span class="string">&quot;https://www.umei.cc/bizhitupian/weimeibizhi/&quot;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line">resp.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码交给bs</span></span><br><span class="line">main_page = BeautifulSoup(resp.text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">alist = main_page.find(<span class="string">&quot;div&quot;</span>, class_=<span class="string">&quot;pic-box&quot;</span>).find_all(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="comment"># print(alist)</span></span><br><span class="line"><span class="comment"># for a in alist:</span></span><br><span class="line"><span class="comment">#     print(a.get(&#x27;href&#x27;))  # 拿到的是href里的值</span></span><br><span class="line"><span class="keyword">for</span> hrefList <span class="keyword">in</span> alist:</span><br><span class="line">    href = hrefList.get(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> href:</span><br><span class="line">        child_href = urlhome + href</span><br><span class="line">        child_href_list.append(child_href)</span><br><span class="line"><span class="comment"># print(child_href_list)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取子页面内容</span></span><br><span class="line"><span class="keyword">for</span> href <span class="keyword">in</span> child_href_list:</span><br><span class="line">    child_resp = requests.get(href)</span><br><span class="line">    child_resp.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    child_page_text = child_resp.text</span><br><span class="line">    <span class="comment"># print(child_page_text)</span></span><br><span class="line">    child_page = BeautifulSoup(child_page_text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    img = child_page.find(<span class="string">&quot;section&quot;</span>, class_=<span class="string">&quot;img-content&quot;</span>).find(<span class="string">&quot;img&quot;</span>)</span><br><span class="line">    src = img.get(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">    <span class="comment"># print(src)</span></span><br><span class="line">    <span class="comment"># 下载图片</span></span><br><span class="line">    img_resp = requests.get(src)</span><br><span class="line">    <span class="comment"># img_rest.content  # 这里是字节</span></span><br><span class="line">    img_name = src.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>]  <span class="comment"># 拿到url中的最后一个/以后的内容</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;img/&quot;</span> + img_name, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(img_resp.content)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;over!!&quot;</span>, img_name)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">resp.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;allover!!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    如果很卡，可能在pycharm里选择，这样pycharm就不会作索引，会变快一点</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074053.jpg"
                      alt="image-20220911142002956"
                ></p>
<h4 id="Xpath入门"><a href="#Xpath入门" class="headerlink" title="Xpath入门"></a>Xpath入门</h4><p>​    XPath是⼀⻔在 XML ⽂档中查找信息的语⾔. XPath可⽤来在 XML ⽂档中对元素和属性进⾏遍历. ⽽我们熟知的HTML恰巧属于XML的 ⼀个⼦集. 所以完全可以⽤xpath去查找html中的内容</p>
<p>​    ⾸先, 先了解⼏个概念.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>野花遍地⾹<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">price</span>&gt;</span>1.23<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">author</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">nick</span>&gt;</span>周⼤强<span class="tag">&lt;/<span class="name">nick</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">nick</span>&gt;</span>周芷若<span class="tag">&lt;/<span class="name">nick</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    在上述html中</p>
<pre><code>1. book, id, name, price....都被称为节点. 
1.  Id, name, price, author被称为book的⼦节点 
1.  book被称为id, name, price, author的⽗节点  
1.  id, name, price,author被称为同胞节点 
</code></pre>
<p>​     有了这些基础知识后, 我们就可以开始了解xpath的基本语法了 在python中想要使⽤xpath, 需要安装lxml模块.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install lxml</span><br></pre></td></tr></table></figure>

<p>​    ⽤法: </p>
<pre><code>1. 将要解析的html内容构造出etree对象. 
1.  使⽤etree对象的xpath()⽅法配合xpath表达式来完成对数据的提取
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">xml = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;book&gt;</span></span><br><span class="line"><span class="string">    &lt;id&gt;1&lt;/id&gt;</span></span><br><span class="line"><span class="string">    &lt;name&gt;野花遍地⾹&lt;/name&gt;</span></span><br><span class="line"><span class="string">    &lt;price&gt;1.23&lt;/price&gt;</span></span><br><span class="line"><span class="string">    &lt;nick&gt;臭⾖腐&lt;/nick&gt;</span></span><br><span class="line"><span class="string">    &lt;author&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;10086&quot;&gt;周⼤强&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;10010&quot;&gt;周芷若&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick class=&quot;joy&quot;&gt;周杰伦&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick class=&quot;jolin&quot;&gt;蔡依林&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">            &lt;nick&gt;惹了&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/author&gt;</span></span><br><span class="line"><span class="string">    &lt;partner&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;ppc&quot;&gt;胖胖陈&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;ppbc&quot;&gt;胖胖不陈&lt;/nick&gt;</span></span><br><span class="line"><span class="string">   &lt;/partner&gt;</span></span><br><span class="line"><span class="string">&lt;/book&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">tree = etree.XML(xml)</span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book&quot;)  # /表示层级关系，第一个/是根节点</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book/name&quot;)</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book/name/text()&quot;)  # text() 拿文本</span></span><br><span class="line">result = tree.xpath(<span class="string">&quot;/book/author/nick/text()&quot;</span>) <span class="comment"># [&#x27;周⼤强&#x27;, &#x27;周芷若&#x27;, &#x27;周杰伦&#x27;, &#x27;蔡依林&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">xml = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;book&gt;</span></span><br><span class="line"><span class="string">    &lt;id&gt;1&lt;/id&gt;</span></span><br><span class="line"><span class="string">    &lt;name&gt;野花遍地⾹&lt;/name&gt;</span></span><br><span class="line"><span class="string">    &lt;price&gt;1.23&lt;/price&gt;</span></span><br><span class="line"><span class="string">    &lt;nick&gt;臭⾖腐&lt;/nick&gt;</span></span><br><span class="line"><span class="string">    &lt;author&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;10086&quot;&gt;周⼤强&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;10010&quot;&gt;周芷若&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick class=&quot;joy&quot;&gt;周杰伦&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick class=&quot;jolin&quot;&gt;蔡依林&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">            &lt;nick&gt;热热热热&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">            &lt;nick&gt;热热热热2&lt;/nick&gt;</span></span><br><span class="line"><span class="string">            &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;nick&gt;热热热热3&lt;/nick&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/author&gt;</span></span><br><span class="line"><span class="string">    &lt;partner&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;ppc&quot;&gt;胖胖陈&lt;/nick&gt;</span></span><br><span class="line"><span class="string">        &lt;nick id=&quot;ppbc&quot;&gt;胖胖不陈&lt;/nick&gt;</span></span><br><span class="line"><span class="string">   &lt;/partner&gt;</span></span><br><span class="line"><span class="string">&lt;/book&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">tree = etree.XML(xml)</span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book&quot;)  # /表示层级关系，第一个/是根节点</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book/name&quot;)</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book/name/text()&quot;)  # text() 拿文本</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book/author/nick/text()&quot;)  # [&#x27;周⼤强&#x27;, &#x27;周芷若&#x27;, &#x27;周杰伦&#x27;, &#x27;蔡依林&#x27;]</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book/author//nick/text()&quot;)  # 找到所有后代节点里的nick节点</span></span><br><span class="line">result = tree.xpath(<span class="string">&quot;/book/author/*/nick/text()&quot;</span>)  <span class="comment"># *任意的节点. 通配符</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>​    找到所有后代节点里的nick节点：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074054.jpg"
                      alt="image-20220911223833325"
                ></p>
<p>​    *任意的节点. 通配符</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074056.jpg"
                      alt="image-20220911224313256"
                ></p>
<p>​    xpath如何提取属性信息. 上⼀段真实的HTML来给各位讲解⼀ 下 准备HTML：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.google.com&quot;</span>&gt;</span>⾕歌<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.sogou.com&quot;</span>&gt;</span>搜狗<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;feiji&quot;</span>&gt;</span>⻜机<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;dapao&quot;</span>&gt;</span>⼤炮<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;huoche&quot;</span>&gt;</span>⽕⻋<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;job&quot;</span>&gt;</span>李嘉诚<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;common&quot;</span>&gt;</span>胡辣汤<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    注意xpath的顺序是从1开始的,[]表示索引:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">tree = etree.parse(<span class="string">&quot;a.html&quot;</span>)</span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html&#x27;)</span></span><br><span class="line">result = tree.xpath(<span class="string">&#x27;/html/body/ul/li[1]/a/text()&#x27;</span>)  <span class="comment"># 注意xpath的顺序是从1开始的,[]表示索引</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074058.jpg"
                      alt="image-20220911225624129"
                ></p>
<p>​    [@xxx=xxx]属性的筛选</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">tree = etree.parse(<span class="string">&quot;a.html&quot;</span>)</span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html&#x27;)</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html/body/ul/li[1]/a/text()&#x27;)  # 注意xpath的顺序是从1开始的,[]表示索引</span></span><br><span class="line">result = tree.xpath(<span class="string">&quot;/html/body/ol/li/a[@href=&#x27;dapao&#x27;]/text()&quot;</span>) <span class="comment"># [@xxx=xxx]属性的筛选</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074101.jpg"
                      alt="image-20220911230512542"
                ></p>
<p>​    从每一个li提取文字信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">tree = etree.parse(<span class="string">&quot;a.html&quot;</span>)</span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html&#x27;)</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html/body/ul/li[1]/a/text()&#x27;)  # 注意xpath的顺序是从1开始的,[]表示索引</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/html/body/ol/li/a[@href=&#x27;dapao&#x27;]/text()&quot;) # [@xxx=xxx]属性的筛选</span></span><br><span class="line">ol_li_list = tree.xpath(<span class="string">&quot;/html/body/ol/li&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> ol_li_list:</span><br><span class="line">    <span class="comment"># 从每一个li提取文字信息</span></span><br><span class="line">    result = li.xpath(<span class="string">&quot;./a/text()&quot;</span>)  <span class="comment"># 在li中继续寻找，相对查找</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074102.jpg"
                      alt="image-20220911230539552"
                ></p>
<p>​    在li中找到a标签里href里的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">tree = etree.parse(<span class="string">&quot;a.html&quot;</span>)</span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html&#x27;)</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html/body/ul/li[1]/a/text()&#x27;)  # 注意xpath的顺序是从1开始的,[]表示索引</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/html/body/ol/li/a[@href=&#x27;dapao&#x27;]/text()&quot;) # [@xxx=xxx]属性的筛选</span></span><br><span class="line">ol_li_list = tree.xpath(<span class="string">&quot;/html/body/ol/li&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> ol_li_list:</span><br><span class="line">    <span class="comment"># 从每一个li提取文字信息</span></span><br><span class="line">    result = li.xpath(<span class="string">&quot;./a/text()&quot;</span>)  <span class="comment"># 在li中继续寻找，相对查找</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    result2 = li.xpath(<span class="string">&quot;./a/@href&quot;</span>)  <span class="comment"># 在li中找到a标签里href里的值</span></span><br><span class="line">    <span class="built_in">print</span>(result2)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074103.jpg"
                      alt="image-20220911230555882"
                ></p>
<p>​    下面这种方式也可拿到，返回的事一个列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">tree = etree.parse(<span class="string">&quot;a.html&quot;</span>)</span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html&#x27;)</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&#x27;/html/body/ul/li[1]/a/text()&#x27;)  # 注意xpath的顺序是从1开始的,[]表示索引</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/html/body/ol/li/a[@href=&#x27;dapao&#x27;]/text()&quot;) # [@xxx=xxx]属性的筛选</span></span><br><span class="line">ol_li_list = tree.xpath(<span class="string">&quot;/html/body/ol/li&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> ol_li_list:</span><br><span class="line">    <span class="comment"># 从每一个li提取文字信息</span></span><br><span class="line">    result = li.xpath(<span class="string">&quot;./a/text()&quot;</span>)  <span class="comment"># 在li中继续寻找，相对查找</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    result2 = li.xpath(<span class="string">&quot;./a/@href&quot;</span>)  <span class="comment"># 在li中找到a标签里href里的值</span></span><br><span class="line">    <span class="built_in">print</span>(result2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(tree.xpath(<span class="string">&quot;/html/body/ul/li/a/@href&quot;</span>))</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074106.jpg"
                      alt="image-20220911230809799"
                ></p>
<p>​    浏览器是可以直接获取xpath的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74107.jpg"
                      alt="image-20220911231040763"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(tree.xpath(<span class="string">&#x27;/html/body/div[1]/text()&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074108.jpg"
                      alt="image-20220911231240138"
                ></p>
<h4 id="Xpath实战-猪八戒信息"><a href="#Xpath实战-猪八戒信息" class="headerlink" title="Xpath实战-猪八戒信息"></a>Xpath实战-猪八戒信息</h4><p>​    url：<a class="link"   target="_blank" rel="noopener" href="https://beijing.zbj.com/search/f/?type=new&amp;kw=saas&amp;r=1" >https://beijing.zbj.com/search/f/?type=new&amp;kw=saas&amp;r=1<i class="fas fa-external-link-alt"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074110.jpg"
                      alt="image-20220911232759037"
                ></p>
<p>​    查看页面源代码发现在源代码里：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074111.jpg"
                      alt="image-20220911233505695"
                >    复制的xpath是这样的：/html/body/div[2]/div/div/div[2]/div/div[3]/div[4]/div[1]/div[3]，我们把最后一个删掉：/html/body/div[2]/div/div/div[2]/div/div[3]/div[4]/div[1]/div，即可获得所有的框。</p>
<p>​    这里我们碰到了一些小问题，我们从浏览器直接获得的xpath没办法获取到信息了，询问大佬得知，某些网站在静态获取的时候xpath和动态的时候不一样，可能通过js改变了某些结构，从而让我们获取不到信息。我们可以通过某些关键元素的特征然后一步一步获取信息。</p>
<p>​    就比如我们现在直接获取price的数值，写一个小程序看看能不能获取：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://beijing.zbj.com/search/f/?type=new&amp;kw=saas&amp;r=1&quot;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析</span></span><br><span class="line">html = etree.HTML(resp.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每一个div</span></span><br><span class="line">divs = html.xpath(<span class="string">&#x27;/html/body/div[2]/div/div/div[2]/div/div[3]/div[4]/div[1]/div&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> div <span class="keyword">in</span> divs:</span><br><span class="line">    price = div.xpath(<span class="string">&quot;./div/div[3]/div[1]/span/text()&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(price)</span><br></pre></td></tr></table></figure>

<p>​    寄，但是换一种写法就可以了,所以不要局限于一种方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拿到页面源代码</span></span><br><span class="line"><span class="comment"># 提取和解析数据</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://beijing.zbj.com/search/f/?type=new&amp;kw=saas&amp;r=1&quot;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析</span></span><br><span class="line">html = etree.HTML(resp.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每一个div</span></span><br><span class="line">divs = html.xpath(<span class="string">&quot;/html/body//div[@class=&#x27;service-card-wrap&#x27;]&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> div <span class="keyword">in</span> divs:</span><br><span class="line">    price = div.xpath(<span class="string">&quot;.//div[@class=&#x27;price&#x27;]/span/text()&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(price)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074113.jpg"
                      alt="image-20220912013905069"
                ></p>
<p>​    做一下数据处理：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拿到页面源代码</span></span><br><span class="line"><span class="comment"># 提取和解析数据</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://beijing.zbj.com/search/f/?type=new&amp;kw=saas&amp;r=1&quot;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析</span></span><br><span class="line">html = etree.HTML(resp.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每一个div</span></span><br><span class="line">divs = html.xpath(<span class="string">&quot;/html/body//div[@class=&#x27;service-card-wrap&#x27;]&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> div <span class="keyword">in</span> divs:</span><br><span class="line">    price = div.xpath(<span class="string">&quot;.//div[@class=&#x27;price&#x27;]/span/text()&quot;</span>)[<span class="number">0</span>].strip(<span class="string">&quot;￥&quot;</span>).strip(<span class="string">&quot;狂欢价：&quot;</span>).strip(<span class="string">&quot;¥&quot;</span>)</span><br><span class="line">    title = <span class="string">&quot;saas&quot;</span>.join(div.xpath(<span class="string">&quot;.//a[@target=&#x27;_blank&#x27;]/text()&quot;</span>))</span><br><span class="line">    com_name = div.xpath(<span class="string">&quot;.//div[@class=&#x27;shop-info text-overflow-line&#x27;]/text()&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    high = div.xpath(<span class="string">&quot;.//div[@class=&#x27;shop-star&#x27;]/span[@class=&#x27;el-tooltip item&#x27;]/text()&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(high)</span><br></pre></td></tr></table></figure>

<p>​    ok完成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拿到页面源代码</span></span><br><span class="line"><span class="comment"># 提取和解析数据</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://beijing.zbj.com/search/f/?type=new&amp;kw=saas&amp;r=1&quot;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析</span></span><br><span class="line">html = etree.HTML(resp.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每一个div</span></span><br><span class="line">divs = html.xpath(<span class="string">&quot;/html/body//div[@class=&#x27;service-card-wrap&#x27;]&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> div <span class="keyword">in</span> divs:</span><br><span class="line">    price = div.xpath(<span class="string">&quot;.//div[@class=&#x27;price&#x27;]/span/text()&quot;</span>)[<span class="number">0</span>].strip(<span class="string">&quot;￥&quot;</span>).strip(<span class="string">&quot;狂欢价：&quot;</span>).strip(<span class="string">&quot;¥&quot;</span>)</span><br><span class="line">    title = <span class="string">&quot;saas&quot;</span>.join(div.xpath(<span class="string">&quot;.//a[@target=&#x27;_blank&#x27;]/text()&quot;</span>))</span><br><span class="line">    com_name = div.xpath(<span class="string">&quot;.//div[@class=&#x27;shop-info text-overflow-line&#x27;]/text()&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    high = div.xpath(<span class="string">&quot;.//div[@class=&#x27;shop-star&#x27;]/span[@class=&#x27;el-tooltip item&#x27;]/text()&quot;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>([<span class="string">&#x27;公司名称：&#x27;</span> + com_name] + [<span class="string">&#x27; 公司价格：&#x27;</span> + price] + [<span class="string">&#x27; 广告名称：&#x27;</span> + title] + [<span class="string">&#x27; 公司评分：&#x27;</span> + high])</span><br><span class="line"></span><br><span class="line">resp.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;over&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074116.jpg"
                      alt="image-20220912023007932"
                ></p>
<hr>
<h3 id="三"><a href="#三" class="headerlink" title="三"></a>三</h3><h4 id="requests进阶概述"><a href="#requests进阶概述" class="headerlink" title="requests进阶概述"></a>requests进阶概述</h4><p>​    我们在之前的爬⾍中其实已经使⽤过headers了. header为HTTP协 议中的请求头. ⼀般存放⼀些和请求内容⽆关的数据. 有时也会存放 ⼀些安全验证信息.⽐如常⻅的User-Agent, token, cookie等. </p>
<p>​    通过requests发送的请求, 我们可以把请求头信息放在headers中. 也 可以单独进⾏存放, 最终由requests⾃动帮我们拼接成完整的http请求头. </p>
<p>​    本章内容: </p>
<pre><code>1. 模拟浏览器登录-&gt;处理cookie 
1. 防盗链处理-&gt; 抓取梨视频数据 
1. 代理 -&gt; 防⽌被封IP 
</code></pre>
<p>​    综合训练: 抓取⽹易云⾳乐评论信息</p>
<h4 id="处理cookie登陆小说网"><a href="#处理cookie登陆小说网" class="headerlink" title="处理cookie登陆小说网"></a>处理cookie登陆小说网</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登陆 -&gt; 得到cookie</span></span><br><span class="line"><span class="comment"># 带着cookie去请求书架url -&gt; 书架上的内容</span></span><br><span class="line"><span class="comment"># 必须得把上面的两个操作连起来</span></span><br><span class="line"><span class="comment"># 用session进行请求 -&gt; session是一连串的请求，在这个过程中cookie不会丢失</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会话</span></span><br><span class="line">session = requests.session()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;loginName&quot;</span>: <span class="string">&quot;13000000000&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 1、登陆</span></span><br><span class="line">url = <span class="string">&quot;https://passport.17k.com/ck/user/login&quot;</span></span><br><span class="line">session.post(url, data=data)</span><br><span class="line"><span class="comment"># print(resp.text)</span></span><br><span class="line"><span class="comment"># print(resp.cookies)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、拿书架数据</span></span><br><span class="line">resp = session.get(<span class="string">&quot;https://user.17k.com/ck/author/shelf?page=1&amp;appKey=2406394919&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp.json())</span><br></pre></td></tr></table></figure>

<p>​    另一种写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登陆 -&gt; 得到cookie</span></span><br><span class="line"><span class="comment"># 带着cookie去请求书架url -&gt; 书架上的内容</span></span><br><span class="line"><span class="comment"># 必须得把上面的两个操作连起来</span></span><br><span class="line"><span class="comment"># 用session进行请求 -&gt; session是一连串的请求，在这个过程中cookie不会丢失</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会话</span></span><br><span class="line">session = requests.session()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;loginName&quot;</span>: <span class="string">&quot;13000000000&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 1、登陆</span></span><br><span class="line">url = <span class="string">&quot;https://passport.17k.com/ck/user/login&quot;</span></span><br><span class="line">session.post(url, data=data)</span><br><span class="line"><span class="comment"># print(resp.text)</span></span><br><span class="line"><span class="comment"># print(resp.cookies)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、拿书架数据</span></span><br><span class="line"><span class="comment"># resp = session.get(&quot;https://user.17k.com/ck/author/shelf?page=1&amp;appKey=2406394919&quot;)</span></span><br><span class="line"><span class="comment"># print(resp.json())</span></span><br><span class="line"></span><br><span class="line">resp = requests.get(<span class="string">&quot;https://user.17k.com/ck/author/shelf?page=1&amp;appKey=2406394919&quot;</span>, headers=&#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;uuid=ECF94FC9-441F-C404-260F-38B5BA521427; c_channel=0; c_csc=web; GUID=9ee2ce7f-dbc3-40e9-93c2-05c4bdf51309; Hm_lvt_9793f42b498361373512340937deb2a0=1662986278; sajssdk_2015_cross_new_user=1; accessToken=avatarUrl%3Dhttps%253A%252F%252Fcdn.static.17k.com%252Fuser%252Favatar%252F13%252F93%252F12%252F98061293.jpg-88x88%253Fv%253D1662984766000%26id%3D98061293%26nickname%3D%25E4%25B9%25A6%25E5%258F%258B002Wc1197%26e%3D1678538408%26s%3Dca1b65e41bd3904f&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(resp.json())</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074117.jpg"
                      alt="image-20220912212027861"
                ></p>
<h4 id="防盗链抓取梨视频"><a href="#防盗链抓取梨视频" class="headerlink" title="防盗链抓取梨视频"></a>防盗链抓取梨视频</h4><p>​    我们抓一下梨视频的视频</p>
<p>​    首先我们可以看到，我们的当前页面源码和显示源码是不一样的，因为在页面源码里没有&lt;video&gt;这个标签，应该是碰到了和前面一样的js修改的情况。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074118.jpg"
                      alt="image-20220912214102862"
                ></p>
<p>​    重新加载页面然后看一下js</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074120.jpg"
                      alt="image-20220912214247083"
                ></p>
<p>​    发现了视频链接，然后直接访问404，寄</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074122.jpg"
                      alt="image-20220912214338650"
                ></p>
<p>​    对比一下这几个链接，发现是替换了几个部分。替换的部分从哪来呢</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074123.jpg"
                      alt="image-20220912214617201"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074124.jpg"
                      alt="image-20220912214858149"
                ></p>
<p>​    还在文章的url也有</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074125.jpg"
                      alt="image-20220912215213653"
                >    </p>
<p>​    然后就可以开始写代码了</p>
<p>​    1、拿到contId</p>
<p>​    2、拿到videoStatus返回的json. -&gt; srcURL</p>
<p>​    3、srcURL里面的内容进行修整</p>
<p>​    4、下载视频</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、拿到contId</span></span><br><span class="line"><span class="comment"># 2、拿到videoStatus返回的json. -&gt; srcURL</span></span><br><span class="line"><span class="comment"># 3、srcURL里面的内容进行修整</span></span><br><span class="line"><span class="comment"># 4、下载视频</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.pearvideo.com/video_1168452&quot;</span></span><br><span class="line">contId = url.split(<span class="string">&quot;_&quot;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">videoStatusUrl = <span class="string">f&quot;https://www.pearvideo.com/videoStatus.jsp?contId=<span class="subst">&#123;contId&#125;</span>&amp;mrd=0.38022964971760365&quot;</span></span><br><span class="line">resp = requests.get(videoStatusUrl)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074126.jpg"
                      alt="image-20220912215828255"
                ></p>
<p>​    问题出在哪呢？加个UA和Referer吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、拿到contId</span></span><br><span class="line"><span class="comment"># 2、拿到videoStatus返回的json. -&gt; srcURL</span></span><br><span class="line"><span class="comment"># 3、srcURL里面的内容进行修整</span></span><br><span class="line"><span class="comment"># 4、下载视频</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.pearvideo.com/video_1168452&quot;</span></span><br><span class="line">contId = url.split(<span class="string">&quot;_&quot;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">videoStatusUrl = <span class="string">f&quot;https://www.pearvideo.com/videoStatus.jsp?contId=<span class="subst">&#123;contId&#125;</span>&amp;mrd=0.38022964971760365&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://www.pearvideo.com/video_1168452&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">resp = requests.get(videoStatusUrl, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074128.jpg"
                      alt="image-20220912220254577"
                ></p>
<p>​    处理一下格式吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、拿到contId</span></span><br><span class="line"><span class="comment"># 2、拿到videoStatus返回的json. -&gt; srcURL</span></span><br><span class="line"><span class="comment"># 3、srcURL里面的内容进行修整</span></span><br><span class="line"><span class="comment"># 4、下载视频</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.pearvideo.com/video_1168452&quot;</span></span><br><span class="line">contId = url.split(<span class="string">&quot;_&quot;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">videoStatusUrl = <span class="string">f&quot;https://www.pearvideo.com/videoStatus.jsp?contId=<span class="subst">&#123;contId&#125;</span>&amp;mrd=0.38022964971760365&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: url</span><br><span class="line">&#125;</span><br><span class="line">resp = requests.get(videoStatusUrl, headers=headers)</span><br><span class="line">dic = resp.json()</span><br><span class="line">srcUrl = dic[<span class="string">&#x27;videoInfo&#x27;</span>][<span class="string">&#x27;videos&#x27;</span>][<span class="string">&#x27;srcUrl&#x27;</span>]</span><br><span class="line">systemTime = dic[<span class="string">&#x27;systemTime&#x27;</span>]</span><br><span class="line">srcUrl = srcUrl.replace(systemTime, <span class="string">f&quot;cont-<span class="subst">&#123;contId&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(srcUrl)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074129.jpg"
                      alt="image-20220912221041287"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、拿到contId</span></span><br><span class="line"><span class="comment"># 2、拿到videoStatus返回的json. -&gt; srcURL</span></span><br><span class="line"><span class="comment"># 3、srcURL里面的内容进行修整</span></span><br><span class="line"><span class="comment"># 4、下载视频</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.pearvideo.com/video_1168452&quot;</span></span><br><span class="line">contId = url.split(<span class="string">&quot;_&quot;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">videoStatusUrl = <span class="string">f&quot;https://www.pearvideo.com/videoStatus.jsp?contId=<span class="subst">&#123;contId&#125;</span>&amp;mrd=0.38022964971760365&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: url</span><br><span class="line">&#125;</span><br><span class="line">resp = requests.get(videoStatusUrl, headers=headers)</span><br><span class="line">dic = resp.json()</span><br><span class="line">srcUrl = dic[<span class="string">&#x27;videoInfo&#x27;</span>][<span class="string">&#x27;videos&#x27;</span>][<span class="string">&#x27;srcUrl&#x27;</span>]</span><br><span class="line">systemTime = dic[<span class="string">&#x27;systemTime&#x27;</span>]</span><br><span class="line">srcUrl = srcUrl.replace(systemTime, <span class="string">f&quot;cont-<span class="subst">&#123;contId&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载视频</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;a.mp4&quot;</span>,mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(requests.get(srcUrl).content)</span><br><span class="line"></span><br><span class="line">f.close()</span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74130.jpg"
                      alt="image-20220912221433767"
                ></p>
<h4 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h4><p>​    当我们反复抓取⼀个⽹站时, 由于请求过于频繁, 服务器很可能会将 你的IP进⾏封锁来反爬. 应对⽅案就是通过⽹络代理的形式进⾏伪装。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074132.jpg"
                      alt="image-20220913202226934"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; IntelMac OS X 10_15_4) AppleWebKit/537.36 (KHTML, likeGecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&quot;https&quot;</span>:  <span class="string">&quot;http://23.26.236.11:3128&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(<span class="string">&quot;https://www.baidu.com&quot;</span>, proxies=proxies)</span><br><span class="line">resp.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<h4 id="网易云音乐评论信息"><a href="#网易云音乐评论信息" class="headerlink" title="网易云音乐评论信息"></a>网易云音乐评论信息</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74133.jpg"
                      alt="image-20220913204957315"
                ></p>
<p>​    想抓王心凌的评论🥵，怎么办呢。先看看网页源代码，不出所料没在源码里</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074133.jpg"
                      alt="image-20220913205128679"
                ></p>
<p>​    再看看框架源代码，也没有。框架源代码是什么呢，有的网页里。他会在一个html里嵌套另一个html，所以就有两套源代码</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074135.jpg"
                      alt="image-20220913205347166"
                ></p>
<p>​    抓个包看看，找到了评论🥵</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074137.jpg"
                      alt="image-20220913205733981"
                ></p>
<p>​    <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074138.jpg"
                      alt="image-20220913210620600"
                ></p>
<p>​    加密了，寄。放弃</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074139.jpg"
                      alt="image-20220913211159574"
                ></p>
<p>​    这个地方是请求调用堆栈的过程，从下往上依次调用，也就是加载js脚本的过程。我们找到第一个，下个断点。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74142.jpg"
                      alt="image-20220914005320553"
                ></p>
<p>​    发现url处不是我们想要的url，我们放过他，一直往后找，放了八九个包，找到啦。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074143.jpg"
                      alt="image-20220914010056161"
                ></p>
<p>​    发现在e2x参数时已经被加密啦，我们现在往回找</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074145.jpg"
                      alt="image-20220914010307648"
                ></p>
<p>​    查看调用堆栈，这里的东西和前面启动器里的是一样的，一个一个向上找，点开查看参数就行</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74146.jpg"
                      alt="image-20220914011501764"
                ></p>
<p>​    由上图，程序一定在t2x.be3x被加密，所以我们回看这个js</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074147.jpg"
                      alt="image-20220914012123369"
                ></p>
<p>​    先把断点打在此处，然后重新刷新，我们可以看到此时还没有被加密</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074150.jpg"
                      alt="image-20220914233434862"
                ></p>
<p>​    找到加密方法，我们可以一行一行下断点走下来，这里我不下了，直接下在加密处</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74152.jpg"
                      alt="image-20220914012839026"
                ></p>
<p>​    然后F10</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074153.jpg"
                      alt="image-20220914013502516"
                ></p>
<p>​    这一段的逻辑如下所示</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074154.jpg"
                      alt="image-20220914014202263"
                ></p>
<p>​    可以看到i2x为原始数据，先写成这样吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.找到未加密的参数, window.asrsea(参数,xxx,xxx,xxx)</span></span><br><span class="line"><span class="comment"># 2.想办法把参数进行加密, params =&gt; encText，encSecKey =&gt; encSecKey</span></span><br><span class="line"><span class="comment"># 3.请求到网易，拿到评论信息</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方式是post,拿真实参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;csrf_token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cursor&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;orderType&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageNo&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rid&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span>,</span><br><span class="line">    <span class="string">&quot;threadId&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理加密过程</span></span><br></pre></td></tr></table></figure>

<p>​    下面处理加密过程，直接搜加密函数，就俩，那实际执行的就是d</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074155.jpg"
                      alt="image-20220915000416491"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74157.jpg"
                      alt="image-20220915000538520"
                ></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params">a</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> d, e, b = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>, c = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (d = <span class="number">0</span>; a &gt; d; d += <span class="number">1</span>)</span><br><span class="line">            e = <span class="title class_">Math</span>.<span class="title function_">random</span>() * b.<span class="property">length</span>,</span><br><span class="line">            e = <span class="title class_">Math</span>.<span class="title function_">floor</span>(e),</span><br><span class="line">            c += b.<span class="title function_">charAt</span>(e);</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">b</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(b)</span><br><span class="line">          , d = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&quot;0102030405060708&quot;</span>)</span><br><span class="line">          , e = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(a)</span><br><span class="line">          , f = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(e, c, &#123;</span><br><span class="line">            <span class="attr">iv</span>: d,</span><br><span class="line">            <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> f.<span class="title function_">toString</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">c</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> d, e;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">setMaxDigits</span>(<span class="number">131</span>),</span><br><span class="line">        d = <span class="keyword">new</span> <span class="title class_">RSAKeyPair</span>(b,<span class="string">&quot;&quot;</span>,c),</span><br><span class="line">        e = <span class="title function_">encryptedString</span>(d, a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">d</span>(<span class="params">d, e, f, g</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> h = &#123;&#125;</span><br><span class="line">          , i = <span class="title function_">a</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">return</span> h.<span class="property">encText</span> = <span class="title function_">b</span>(d, g),</span><br><span class="line">        h.<span class="property">encText</span> = <span class="title function_">b</span>(h.<span class="property">encText</span>, i),</span><br><span class="line">        h.<span class="property">encSecKey</span> = <span class="title function_">c</span>(i, e, f),</span><br><span class="line">        h</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">e</span>(<span class="params">a, b, d, e</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> f = &#123;&#125;;</span><br><span class="line">        <span class="keyword">return</span> f.<span class="property">encText</span> = <span class="title function_">c</span>(a + e, b, d),</span><br><span class="line">        f</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​    入口是d，我们现在去看一下上面调用过程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bKB4F = <span class="variable language_">window</span>.<span class="title function_">asrsea</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(i2x), <span class="title function_">buV2x</span>([<span class="string">&quot;流泪&quot;</span>, <span class="string">&quot;强&quot;</span>]), <span class="title function_">buV2x</span>(<span class="title class_">Rg7Z</span>.<span class="property">md</span>), <span class="title function_">buV2x</span>([<span class="string">&quot;爱心&quot;</span>, <span class="string">&quot;女孩&quot;</span>, <span class="string">&quot;惊恐&quot;</span>, <span class="string">&quot;大笑&quot;</span>]));</span><br></pre></td></tr></table></figure>

<p>​    d参数就是我们的原数据，上面已经给出</p>
<p>​    e参数是（buV2x([“流泪”, “强”])）这个函数运行的结果，我们别管到底是什么了，直接跑一下，’010001’</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074158.jpg"
                      alt="image-20220915003323528"
                ></p>
<p>​    f和e类似，跑一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#x27;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074200.jpg"
                      alt="image-20220915003533490"
                ></p>
<p>​    g一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;0CoJUm6Qyw8W8jud&#x27;</span><br></pre></td></tr></table></figure>

<p>​    分析一下js,可以发现我们就得把i定死，具体看下面代码注释里的分析</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.找到未加密的参数, window.asrsea(参数,xxx,xxx,xxx)</span></span><br><span class="line"><span class="comment"># 2.想办法把参数进行加密, params =&gt; encText，encSecKey =&gt; encSecKey</span></span><br><span class="line"><span class="comment"># 3.请求到网易，拿到评论信息</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方式是post,拿真实参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;csrf_token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cursor&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;orderType&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageNo&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rid&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span>,</span><br><span class="line">    <span class="string">&quot;threadId&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f = <span class="string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3&quot;</span> \</span><br><span class="line">    <span class="string">&quot;ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557&quot;</span> \</span><br><span class="line">    <span class="string">&quot;c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e8&quot;</span> \</span><br><span class="line">    <span class="string">&quot;2047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7 &quot;</span></span><br><span class="line">g = <span class="string">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class="line">e = <span class="string">&quot;010001&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理加密过程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function a(a = 16) &#123;</span></span><br><span class="line"><span class="string">        var d, e, b = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;, c = &quot;&quot;;</span></span><br><span class="line"><span class="string">        for (d = 0; a &gt; d; d += 1) # 循环16次</span></span><br><span class="line"><span class="string">            e = Math.random() * b.length, # 随机数，假如是 1.2345</span></span><br><span class="line"><span class="string">            e = Math.floor(e), # 取整 ，假设下会变为 1</span></span><br><span class="line"><span class="string">            c += b.charAt(e); # 取字符串中的xxx位置 假设下会拿出字母b</span></span><br><span class="line"><span class="string">        return c #产生随机的16位字符串</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function b(a, b) &#123;</span></span><br><span class="line"><span class="string">        var c = CryptoJS.enc.Utf8.parse(b)</span></span><br><span class="line"><span class="string">          , d = CryptoJS.enc.Utf8.parse(&quot;0102030405060708&quot;)</span></span><br><span class="line"><span class="string">          , e = CryptoJS.enc.Utf8.parse(a)</span></span><br><span class="line"><span class="string">          , f = CryptoJS.AES.encrypt(e, c, &#123;</span></span><br><span class="line"><span class="string">            iv: d,</span></span><br><span class="line"><span class="string">            mode: CryptoJS.mode.CBC</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">        return f.toString()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function c(a, b, c) &#123;</span></span><br><span class="line"><span class="string">        var d, e;</span></span><br><span class="line"><span class="string">        return setMaxDigits(131),</span></span><br><span class="line"><span class="string">        d = new RSAKeyPair(b,&quot;&quot;,c),</span></span><br><span class="line"><span class="string">        e = encryptedString(d, a)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">d:数据</span></span><br><span class="line"><span class="string">e:010001</span></span><br><span class="line"><span class="string">f:&#x27;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#x27;</span></span><br><span class="line"><span class="string">g:&#x27;0CoJUm6Qyw8W8jud&#x27;</span></span><br><span class="line"><span class="string">    function d(d, e, f, g) &#123;</span></span><br><span class="line"><span class="string">        var h = &#123;&#125; #h现在是空对象</span></span><br><span class="line"><span class="string">          , i = a(16); #根据a函数，可以发现i为16位的随机值，我们就要把i想办法设置为定值</span></span><br><span class="line"><span class="string">        h.encText = b(d, g),</span></span><br><span class="line"><span class="string">        h.encText = b(h.encText, i), </span></span><br><span class="line"><span class="string">        h.encSecKey = c(i, e, f), #得到encSecKey,e和f是定死的，c函数也没有随机数产生，所以只取决于i。如果此时把i设置为定值，encSeckey就固定了</span></span><br><span class="line"><span class="string">        return h</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function e(a, b, d, e) &#123;</span></span><br><span class="line"><span class="string">        var f = &#123;&#125;;</span></span><br><span class="line"><span class="string">        return f.encText = c(a + e, b, d),</span></span><br><span class="line"><span class="string">        f</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    我们现在在d函数上设置一个断点，asrsea的断点也在。可以发现我们的分析没有错</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74203.jpg"
                      alt="image-20220915010148829"
                ></p>
<p>​    把i定为：jVQn8x1vCuwKtrdO，我们在asrsea函数下面一行再设置一个断点，这样就可以观察出来加密的数值了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074203.jpg"
                      alt="image-20220915011447650"
                ></p>
<p>​    得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">encSecKey：&quot;a7ef208899da73d457083e5186f7781531cc6bd374b789ee7023ea8251c30f2974a234fa63bd1d70580f4efaffdcae6e4ef273346099d9cfab045722b9d4464e12ff2ad867b11a46adeec7a6880a004a2bd25c2c4e3357b40865702ee7695b814a9ce28c978f17fc55cc8f157dd25073ea5b5a60fcc322a74d1b88ff43db4091&quot;</span><br></pre></td></tr></table></figure>

<p>​    把js全部理清之后得到这样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.找到未加密的参数, window.asrsea(参数,xxx,xxx,xxx)</span></span><br><span class="line"><span class="comment"># 2.想办法把参数进行加密, params =&gt; encText，encSecKey =&gt; encSecKey</span></span><br><span class="line"><span class="comment"># 3.请求到网易，拿到评论信息</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方式是post,拿真实参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;csrf_token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cursor&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;orderType&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageNo&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rid&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span>,</span><br><span class="line">    <span class="string">&quot;threadId&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f = <span class="string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3&quot;</span> \</span><br><span class="line">    <span class="string">&quot;ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557&quot;</span> \</span><br><span class="line">    <span class="string">&quot;c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e8&quot;</span> \</span><br><span class="line">    <span class="string">&quot;2047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7 &quot;</span></span><br><span class="line">g = <span class="string">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class="line">e = <span class="string">&quot;010001&quot;</span></span><br><span class="line">i = <span class="string">&quot;jVQn8x1vCuwKtrdO&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encSeckey</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;a7ef208899da73d457083e5186f7781531cc6bd374b789ee7023ea8251c&quot;</span> \</span><br><span class="line">           <span class="string">&quot;30f2974a234fa63bd1d70580f4efaffdcae6e4ef273346099d9cfab0457&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22b9d4464e12ff2ad867b11a46adeec7a6880a004a2bd25c2c4e3357b40&quot;</span> \</span><br><span class="line">           <span class="string">&quot;865702ee7695b814a9ce28c978f17fc55cc8f157dd25073ea5b5a60fcc3&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22a74d1b88ff43db4091&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理加密过程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function a(a = 16) &#123;</span></span><br><span class="line"><span class="string">        var d, e, b = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;, c = &quot;&quot;;</span></span><br><span class="line"><span class="string">        for (d = 0; a &gt; d; d += 1) # 循环16次</span></span><br><span class="line"><span class="string">            e = Math.random() * b.length, # 随机数，假如是 1.2345</span></span><br><span class="line"><span class="string">            e = Math.floor(e), # 取整 ，假设下会变为 1</span></span><br><span class="line"><span class="string">            c += b.charAt(e); # 取字符串中的xxx位置 假设下会拿出字母b</span></span><br><span class="line"><span class="string">        return c #产生随机的16位字符串</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function b(a, b) &#123; # a是要加密的内容</span></span><br><span class="line"><span class="string">        var c = CryptoJS.enc.Utf8.parse(b) # b是密钥</span></span><br><span class="line"><span class="string">          , d = CryptoJS.enc.Utf8.parse(&quot;0102030405060708&quot;)</span></span><br><span class="line"><span class="string">          , e = CryptoJS.enc.Utf8.parse(a) # e是数据</span></span><br><span class="line"><span class="string">          , f = CryptoJS.AES.encrypt(e, c, &#123;   # c是加密的密钥</span></span><br><span class="line"><span class="string">            iv: d, # 偏移量</span></span><br><span class="line"><span class="string">            mode: CryptoJS.mode.CBC #CBC模式加密</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">        return f.toString()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function c(a, b, c) &#123;   #c不产生随机数</span></span><br><span class="line"><span class="string">        var d, e;</span></span><br><span class="line"><span class="string">        return setMaxDigits(131),</span></span><br><span class="line"><span class="string">        d = new RSAKeyPair(b,&quot;&quot;,c),</span></span><br><span class="line"><span class="string">        e = encryptedString(d, a)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">d:数据</span></span><br><span class="line"><span class="string">e:010001</span></span><br><span class="line"><span class="string">f:&#x27;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#x27;</span></span><br><span class="line"><span class="string">g:&#x27;0CoJUm6Qyw8W8jud&#x27;</span></span><br><span class="line"><span class="string">    function d(d, e, f, g) &#123;</span></span><br><span class="line"><span class="string">        var h = &#123;&#125; #h现在是空对象</span></span><br><span class="line"><span class="string">          , i = a(16); #根据a函数，可以发现i为16位的随机值，我们就要把i想办法设置为定值</span></span><br><span class="line"><span class="string">        return h.encText = b(d, g), # g就是密钥</span></span><br><span class="line"><span class="string">        h.encText = b(h.encText, i),  #返回的就是params,流程是：数据+g =&gt; b() =&gt; 第一次加密+i =&gt; b() =&gt; params , i也是密钥</span></span><br><span class="line"><span class="string">        h.encSecKey = c(i, e, f), #得到encSecKey,e和f是定死的，c函数也没有随机数产生，所以只取决于i。如果此时把i设置为定值，encSeckey就固定了</span></span><br><span class="line"><span class="string">        h</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function e(a, b, d, e) &#123;</span></span><br><span class="line"><span class="string">        var f = &#123;&#125;;</span></span><br><span class="line"><span class="string">        return f.encText = c(a + e, b, d),</span></span><br><span class="line"><span class="string">        f</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>​    下面写代码，注意data是字典，而get_params接受字符串，我们需要用json转一下格式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.找到未加密的参数, window.asrsea(参数,xxx,xxx,xxx)</span></span><br><span class="line"><span class="comment"># 2.想办法把参数进行加密, params =&gt; encText，encSecKey =&gt; encSecKey</span></span><br><span class="line"><span class="comment"># 3.请求到网易，拿到评论信息</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方式是post,拿真实参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;csrf_token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cursor&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;orderType&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageNo&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rid&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span>,</span><br><span class="line">    <span class="string">&quot;threadId&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f = <span class="string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3&quot;</span> \</span><br><span class="line">    <span class="string">&quot;ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557&quot;</span> \</span><br><span class="line">    <span class="string">&quot;c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e8&quot;</span> \</span><br><span class="line">    <span class="string">&quot;2047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7 &quot;</span></span><br><span class="line">g = <span class="string">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class="line">e = <span class="string">&quot;010001&quot;</span></span><br><span class="line">i = <span class="string">&quot;jVQn8x1vCuwKtrdO&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encSeckey</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;a7ef208899da73d457083e5186f7781531cc6bd374b789ee7023ea8251c&quot;</span> \</span><br><span class="line">           <span class="string">&quot;30f2974a234fa63bd1d70580f4efaffdcae6e4ef273346099d9cfab0457&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22b9d4464e12ff2ad867b11a46adeec7a6880a004a2bd25c2c4e3357b40&quot;</span> \</span><br><span class="line">           <span class="string">&quot;865702ee7695b814a9ce28c978f17fc55cc8f157dd25073ea5b5a60fcc3&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22a74d1b88ff43db4091&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">data</span>):  <span class="comment"># 默认收到的是字符串</span></span><br><span class="line">    first = enc_params(data, g)</span><br><span class="line">    second = enc_params(first, i)</span><br><span class="line">    <span class="keyword">return</span> second  <span class="comment"># 返回的就是params</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密过程</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc_params</span>(<span class="params">data, key</span>):</span><br><span class="line">    iv = <span class="string">&quot;0102030405060708&quot;</span></span><br><span class="line">    aes = AES.new(key=key.encode(<span class="string">&#x27;utf-8&#x27;</span>), IV=iv.encode(<span class="string">&#x27;utf-8&#x27;</span>), mode=AES.MODE_CBC)  <span class="comment"># 创建加密器</span></span><br><span class="line">    bs = aes.encrypt(data)  <span class="comment"># 加密，得到字节</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(b64encode(bs), <span class="string">&quot;utf-8&quot;</span>)  <span class="comment"># 转化成字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = requests.post(url, data=&#123;</span><br><span class="line">    <span class="string">&quot;params&quot;</span>: get_params(json.dumps(data)),</span><br><span class="line">    <span class="string">&quot;encSecKey&quot;</span>: get_encSeckey()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理加密过程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function a(a = 16) &#123;</span></span><br><span class="line"><span class="string">        var d, e, b = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;, c = &quot;&quot;;</span></span><br><span class="line"><span class="string">        for (d = 0; a &gt; d; d += 1) # 循环16次</span></span><br><span class="line"><span class="string">            e = Math.random() * b.length, # 随机数，假如是 1.2345</span></span><br><span class="line"><span class="string">            e = Math.floor(e), # 取整 ，假设下会变为 1</span></span><br><span class="line"><span class="string">            c += b.charAt(e); # 取字符串中的xxx位置 假设下会拿出字母b</span></span><br><span class="line"><span class="string">        return c #产生随机的16位字符串</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function b(a, b) &#123; # a是要加密的内容</span></span><br><span class="line"><span class="string">        var c = CryptoJS.enc.Utf8.parse(b) # b是密钥</span></span><br><span class="line"><span class="string">          , d = CryptoJS.enc.Utf8.parse(&quot;0102030405060708&quot;)</span></span><br><span class="line"><span class="string">          , e = CryptoJS.enc.Utf8.parse(a) # e是数据</span></span><br><span class="line"><span class="string">          , f = CryptoJS.AES.encrypt(e, c, &#123;   # c是加密的密钥</span></span><br><span class="line"><span class="string">            iv: d, # 偏移量</span></span><br><span class="line"><span class="string">            mode: CryptoJS.mode.CBC #CBC模式加密</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">        return f.toString()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function c(a, b, c) &#123;   #c不产生随机数</span></span><br><span class="line"><span class="string">        var d, e;</span></span><br><span class="line"><span class="string">        return setMaxDigits(131),</span></span><br><span class="line"><span class="string">        d = new RSAKeyPair(b,&quot;&quot;,c),</span></span><br><span class="line"><span class="string">        e = encryptedString(d, a)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">d:数据</span></span><br><span class="line"><span class="string">e:010001</span></span><br><span class="line"><span class="string">f:&#x27;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#x27;</span></span><br><span class="line"><span class="string">g:&#x27;0CoJUm6Qyw8W8jud&#x27;</span></span><br><span class="line"><span class="string">    function d(d, e, f, g) &#123;</span></span><br><span class="line"><span class="string">        var h = &#123;&#125; #h现在是空对象</span></span><br><span class="line"><span class="string">          , i = a(16); #根据a函数，可以发现i为16位的随机值，我们就要把i想办法设置为定值</span></span><br><span class="line"><span class="string">        return h.encText = b(d, g), # g就是密钥</span></span><br><span class="line"><span class="string">        h.encText = b(h.encText, i),  #返回的就是params,流程是：数据+g =&gt; b() =&gt; 第一次加密+i =&gt; b() =&gt; params , i也是密钥</span></span><br><span class="line"><span class="string">        h.encSecKey = c(i, e, f), #得到encSecKey,e和f是定死的，c函数也没有随机数产生，所以只取决于i。如果此时把i设置为定值，encSeckey就固定了</span></span><br><span class="line"><span class="string">        h</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function e(a, b, d, e) &#123;</span></span><br><span class="line"><span class="string">        var f = &#123;&#125;;</span></span><br><span class="line"><span class="string">        return f.encText = c(a + e, b, d),</span></span><br><span class="line"><span class="string">        f</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074205.jpg"
                      alt="image-20220915020643346"
                ></p>
<p>​    好了我们运行一下，应该没问题了吧，寄</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074206.jpg"
                      alt="image-20220915020743173"
                ></p>
<p>​    看看，原来是加密的长度必须是16的倍数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.找到未加密的参数, window.asrsea(参数,xxx,xxx,xxx)</span></span><br><span class="line"><span class="comment"># 2.想办法把参数进行加密, params =&gt; encText，encSecKey =&gt; encSecKey</span></span><br><span class="line"><span class="comment"># 3.请求到网易，拿到评论信息</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方式是post,拿真实参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;csrf_token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cursor&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;orderType&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageNo&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rid&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span>,</span><br><span class="line">    <span class="string">&quot;threadId&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f = <span class="string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3&quot;</span> \</span><br><span class="line">    <span class="string">&quot;ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557&quot;</span> \</span><br><span class="line">    <span class="string">&quot;c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e8&quot;</span> \</span><br><span class="line">    <span class="string">&quot;2047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7 &quot;</span></span><br><span class="line">g = <span class="string">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class="line">e = <span class="string">&quot;010001&quot;</span></span><br><span class="line">i = <span class="string">&quot;jVQn8x1vCuwKtrdO&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encSeckey</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;a7ef208899da73d457083e5186f7781531cc6bd374b789ee7023ea8251c&quot;</span> \</span><br><span class="line">           <span class="string">&quot;30f2974a234fa63bd1d70580f4efaffdcae6e4ef273346099d9cfab0457&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22b9d4464e12ff2ad867b11a46adeec7a6880a004a2bd25c2c4e3357b40&quot;</span> \</span><br><span class="line">           <span class="string">&quot;865702ee7695b814a9ce28c978f17fc55cc8f157dd25073ea5b5a60fcc3&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22a74d1b88ff43db4091&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">data</span>):  <span class="comment"># 默认收到的是字符串</span></span><br><span class="line">    first = enc_params(data, g)</span><br><span class="line">    second = enc_params(first, i)</span><br><span class="line">    <span class="keyword">return</span> second  <span class="comment"># 返回的就是params</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_16</span>(<span class="params">data</span>):</span><br><span class="line">    pad = <span class="number">16</span> - <span class="built_in">len</span>(data) % <span class="number">16</span></span><br><span class="line">    data += <span class="built_in">chr</span>(pad) * pad</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密过程</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc_params</span>(<span class="params">data, key</span>):</span><br><span class="line">    iv = <span class="string">&quot;0102030405060708&quot;</span></span><br><span class="line">    aes = AES.new(key=key.encode(<span class="string">&#x27;utf-8&#x27;</span>), IV=iv.encode(<span class="string">&#x27;utf-8&#x27;</span>), mode=AES.MODE_CBC)  <span class="comment"># 创建加密器</span></span><br><span class="line">    data = to_16(data)</span><br><span class="line">    bs = aes.encrypt(data)  <span class="comment"># 加密，得到字节,加密的长度必须是16的倍数 &quot;123456789abcdfgh chr(16)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(b64encode(bs), <span class="string">&quot;utf-8&quot;</span>)  <span class="comment"># 转化成字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = requests.post(url, data=&#123;</span><br><span class="line">    <span class="string">&quot;params&quot;</span>: get_params(json.dumps(data)),</span><br><span class="line">    <span class="string">&quot;encSecKey&quot;</span>: get_encSeckey()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理加密过程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function a(a = 16) &#123;</span></span><br><span class="line"><span class="string">        var d, e, b = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;, c = &quot;&quot;;</span></span><br><span class="line"><span class="string">        for (d = 0; a &gt; d; d += 1) # 循环16次</span></span><br><span class="line"><span class="string">            e = Math.random() * b.length, # 随机数，假如是 1.2345</span></span><br><span class="line"><span class="string">            e = Math.floor(e), # 取整 ，假设下会变为 1</span></span><br><span class="line"><span class="string">            c += b.charAt(e); # 取字符串中的xxx位置 假设下会拿出字母b</span></span><br><span class="line"><span class="string">        return c #产生随机的16位字符串</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function b(a, b) &#123; # a是要加密的内容</span></span><br><span class="line"><span class="string">        var c = CryptoJS.enc.Utf8.parse(b) # b是密钥</span></span><br><span class="line"><span class="string">          , d = CryptoJS.enc.Utf8.parse(&quot;0102030405060708&quot;)</span></span><br><span class="line"><span class="string">          , e = CryptoJS.enc.Utf8.parse(a) # e是数据</span></span><br><span class="line"><span class="string">          , f = CryptoJS.AES.encrypt(e, c, &#123;   # c是加密的密钥</span></span><br><span class="line"><span class="string">            iv: d, # 偏移量</span></span><br><span class="line"><span class="string">            mode: CryptoJS.mode.CBC #CBC模式加密</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">        return f.toString()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function c(a, b, c) &#123;   #c不产生随机数</span></span><br><span class="line"><span class="string">        var d, e;</span></span><br><span class="line"><span class="string">        return setMaxDigits(131),</span></span><br><span class="line"><span class="string">        d = new RSAKeyPair(b,&quot;&quot;,c),</span></span><br><span class="line"><span class="string">        e = encryptedString(d, a)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">d:数据</span></span><br><span class="line"><span class="string">e:010001</span></span><br><span class="line"><span class="string">f:&#x27;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#x27;</span></span><br><span class="line"><span class="string">g:&#x27;0CoJUm6Qyw8W8jud&#x27;</span></span><br><span class="line"><span class="string">    function d(d, e, f, g) &#123;</span></span><br><span class="line"><span class="string">        var h = &#123;&#125; #h现在是空对象</span></span><br><span class="line"><span class="string">          , i = a(16); #根据a函数，可以发现i为16位的随机值，我们就要把i想办法设置为定值</span></span><br><span class="line"><span class="string">        return h.encText = b(d, g), # g就是密钥</span></span><br><span class="line"><span class="string">        h.encText = b(h.encText, i),  #返回的就是params,流程是：数据+g =&gt; b() =&gt; 第一次加密+i =&gt; b() =&gt; params , i也是密钥</span></span><br><span class="line"><span class="string">        h.encSecKey = c(i, e, f), #得到encSecKey,e和f是定死的，c函数也没有随机数产生，所以只取决于i。如果此时把i设置为定值，encSeckey就固定了</span></span><br><span class="line"><span class="string">        h</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function e(a, b, d, e) &#123;</span></span><br><span class="line"><span class="string">        var f = &#123;&#125;;</span></span><br><span class="line"><span class="string">        return f.encText = c(a + e, b, d),</span></span><br><span class="line"><span class="string">        f</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074207.jpg"
                      alt="image-20220915021442710"
                ></p>
<p>​    还报错，原来是字节的问题，转换成utf-8</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.找到未加密的参数, window.asrsea(参数,xxx,xxx,xxx)</span></span><br><span class="line"><span class="comment"># 2.想办法把参数进行加密, params =&gt; encText，encSecKey =&gt; encSecKey</span></span><br><span class="line"><span class="comment"># 3.请求到网易，拿到评论信息</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方式是post,拿真实参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;csrf_token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cursor&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;orderType&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageNo&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rid&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span>,</span><br><span class="line">    <span class="string">&quot;threadId&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f = <span class="string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3&quot;</span> \</span><br><span class="line">    <span class="string">&quot;ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557&quot;</span> \</span><br><span class="line">    <span class="string">&quot;c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e8&quot;</span> \</span><br><span class="line">    <span class="string">&quot;2047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7 &quot;</span></span><br><span class="line">g = <span class="string">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class="line">e = <span class="string">&quot;010001&quot;</span></span><br><span class="line">i = <span class="string">&quot;jVQn8x1vCuwKtrdO&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encSeckey</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;a7ef208899da73d457083e5186f7781531cc6bd374b789ee7023ea8251c&quot;</span> \</span><br><span class="line">           <span class="string">&quot;30f2974a234fa63bd1d70580f4efaffdcae6e4ef273346099d9cfab0457&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22b9d4464e12ff2ad867b11a46adeec7a6880a004a2bd25c2c4e3357b40&quot;</span> \</span><br><span class="line">           <span class="string">&quot;865702ee7695b814a9ce28c978f17fc55cc8f157dd25073ea5b5a60fcc3&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22a74d1b88ff43db4091&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">data</span>):  <span class="comment"># 默认收到的是字符串</span></span><br><span class="line">    first = enc_params(data, g)</span><br><span class="line">    second = enc_params(first, i)</span><br><span class="line">    <span class="keyword">return</span> second  <span class="comment"># 返回的就是params</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_16</span>(<span class="params">data</span>):</span><br><span class="line">    pad = <span class="number">16</span> - <span class="built_in">len</span>(data) % <span class="number">16</span></span><br><span class="line">    data += <span class="built_in">chr</span>(pad) * pad</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密过程</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc_params</span>(<span class="params">data, key</span>):</span><br><span class="line">    iv = <span class="string">&quot;0102030405060708&quot;</span></span><br><span class="line">    data = to_16(data)</span><br><span class="line">    aes = AES.new(key=key.encode(<span class="string">&#x27;utf-8&#x27;</span>), IV=iv.encode(<span class="string">&#x27;utf-8&#x27;</span>), mode=AES.MODE_CBC)  <span class="comment"># 创建加密器</span></span><br><span class="line">    bs = aes.encrypt(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 加密，得到字节,加密的长度必须是16的倍数 &quot;123456789abcdfgh chr(16)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(b64encode(bs), <span class="string">&quot;utf-8&quot;</span>)  <span class="comment"># 转化成字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = requests.post(url, data=&#123;</span><br><span class="line">    <span class="string">&quot;params&quot;</span>: get_params(json.dumps(data)),</span><br><span class="line">    <span class="string">&quot;encSecKey&quot;</span>: get_encSeckey()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理加密过程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function a(a = 16) &#123;</span></span><br><span class="line"><span class="string">        var d, e, b = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;, c = &quot;&quot;;</span></span><br><span class="line"><span class="string">        for (d = 0; a &gt; d; d += 1) # 循环16次</span></span><br><span class="line"><span class="string">            e = Math.random() * b.length, # 随机数，假如是 1.2345</span></span><br><span class="line"><span class="string">            e = Math.floor(e), # 取整 ，假设下会变为 1</span></span><br><span class="line"><span class="string">            c += b.charAt(e); # 取字符串中的xxx位置 假设下会拿出字母b</span></span><br><span class="line"><span class="string">        return c #产生随机的16位字符串</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function b(a, b) &#123; # a是要加密的内容</span></span><br><span class="line"><span class="string">        var c = CryptoJS.enc.Utf8.parse(b) # b是密钥</span></span><br><span class="line"><span class="string">          , d = CryptoJS.enc.Utf8.parse(&quot;0102030405060708&quot;)</span></span><br><span class="line"><span class="string">          , e = CryptoJS.enc.Utf8.parse(a) # e是数据</span></span><br><span class="line"><span class="string">          , f = CryptoJS.AES.encrypt(e, c, &#123;   # c是加密的密钥</span></span><br><span class="line"><span class="string">            iv: d, # 偏移量</span></span><br><span class="line"><span class="string">            mode: CryptoJS.mode.CBC #CBC模式加密</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">        return f.toString()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function c(a, b, c) &#123;   #c不产生随机数</span></span><br><span class="line"><span class="string">        var d, e;</span></span><br><span class="line"><span class="string">        return setMaxDigits(131),</span></span><br><span class="line"><span class="string">        d = new RSAKeyPair(b,&quot;&quot;,c),</span></span><br><span class="line"><span class="string">        e = encryptedString(d, a)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">d:数据</span></span><br><span class="line"><span class="string">e:010001</span></span><br><span class="line"><span class="string">f:&#x27;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#x27;</span></span><br><span class="line"><span class="string">g:&#x27;0CoJUm6Qyw8W8jud&#x27;</span></span><br><span class="line"><span class="string">    function d(d, e, f, g) &#123;</span></span><br><span class="line"><span class="string">        var h = &#123;&#125; #h现在是空对象</span></span><br><span class="line"><span class="string">          , i = a(16); #根据a函数，可以发现i为16位的随机值，我们就要把i想办法设置为定值</span></span><br><span class="line"><span class="string">        return h.encText = b(d, g), # g就是密钥</span></span><br><span class="line"><span class="string">        h.encText = b(h.encText, i),  #返回的就是params,流程是：数据+g =&gt; b() =&gt; 第一次加密+i =&gt; b() =&gt; params , i也是密钥</span></span><br><span class="line"><span class="string">        h.encSecKey = c(i, e, f), #得到encSecKey,e和f是定死的，c函数也没有随机数产生，所以只取决于i。如果此时把i设置为定值，encSeckey就固定了</span></span><br><span class="line"><span class="string">        h</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function e(a, b, d, e) &#123;</span></span><br><span class="line"><span class="string">        var f = &#123;&#125;;</span></span><br><span class="line"><span class="string">        return f.encText = c(a + e, b, d),</span></span><br><span class="line"><span class="string">        f</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>​    总算是拿到了王心凌的评论🥵</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074208.jpg"
                      alt="image-20220915022039772"
                ></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.找到未加密的参数, window.asrsea(参数,xxx,xxx,xxx)</span></span><br><span class="line"><span class="comment"># 2.想办法把参数进行加密, params =&gt; encText，encSecKey =&gt; encSecKey</span></span><br><span class="line"><span class="comment"># 3.请求到网易，拿到评论信息</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方式是post,拿真实参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;csrf_token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cursor&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;orderType&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageNo&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rid&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span>,</span><br><span class="line">    <span class="string">&quot;threadId&quot;</span>: <span class="string">&quot;R_SO_4_1474411443&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f = <span class="string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3&quot;</span> \</span><br><span class="line">    <span class="string">&quot;ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557&quot;</span> \</span><br><span class="line">    <span class="string">&quot;c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e8&quot;</span> \</span><br><span class="line">    <span class="string">&quot;2047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7 &quot;</span></span><br><span class="line">g = <span class="string">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class="line">e = <span class="string">&quot;010001&quot;</span></span><br><span class="line">i = <span class="string">&quot;jVQn8x1vCuwKtrdO&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encSeckey</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;a7ef208899da73d457083e5186f7781531cc6bd374b789ee7023ea8251c&quot;</span> \</span><br><span class="line">           <span class="string">&quot;30f2974a234fa63bd1d70580f4efaffdcae6e4ef273346099d9cfab0457&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22b9d4464e12ff2ad867b11a46adeec7a6880a004a2bd25c2c4e3357b40&quot;</span> \</span><br><span class="line">           <span class="string">&quot;865702ee7695b814a9ce28c978f17fc55cc8f157dd25073ea5b5a60fcc3&quot;</span> \</span><br><span class="line">           <span class="string">&quot;22a74d1b88ff43db4091&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">data</span>):  <span class="comment"># 默认收到的是字符串</span></span><br><span class="line">    first = enc_params(data, g)</span><br><span class="line">    second = enc_params(first, i)</span><br><span class="line">    <span class="keyword">return</span> second  <span class="comment"># 返回的就是params</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_16</span>(<span class="params">data</span>):</span><br><span class="line">    pad = <span class="number">16</span> - <span class="built_in">len</span>(data) % <span class="number">16</span></span><br><span class="line">    data += <span class="built_in">chr</span>(pad) * pad</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密过程</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc_params</span>(<span class="params">data, key</span>):</span><br><span class="line">    iv = <span class="string">&quot;0102030405060708&quot;</span></span><br><span class="line">    data = to_16(data)</span><br><span class="line">    aes = AES.new(key=key.encode(<span class="string">&#x27;utf-8&#x27;</span>), IV=iv.encode(<span class="string">&#x27;utf-8&#x27;</span>), mode=AES.MODE_CBC)  <span class="comment"># 创建加密器</span></span><br><span class="line">    bs = aes.encrypt(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 加密，得到字节,加密的长度必须是16的倍数 &quot;123456789abcdfgh chr(16)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(b64encode(bs), <span class="string">&quot;utf-8&quot;</span>)  <span class="comment"># 转化成字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = requests.post(url, data=&#123;</span><br><span class="line">    <span class="string">&quot;params&quot;</span>: get_params(json.dumps(data)),</span><br><span class="line">    <span class="string">&quot;encSecKey&quot;</span>: get_encSeckey()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">dic = resp.json()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>,<span class="number">100</span>):</span><br><span class="line">    user = dic[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;comments&#x27;</span>][i][<span class="string">&#x27;beReplied&#x27;</span>]</span><br><span class="line">    userId = user[<span class="number">0</span>][<span class="string">&#x27;user&#x27;</span>][<span class="string">&#x27;userId&#x27;</span>]</span><br><span class="line">    nickname = user[<span class="number">0</span>][<span class="string">&#x27;user&#x27;</span>][<span class="string">&#x27;nickname&#x27;</span>]</span><br><span class="line">    comment = user[<span class="number">0</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">    <span class="comment"># nickname = dic[&#x27;data&#x27;][&#x27;comments&#x27;][6][&#x27;beReplied&#x27;][0][&#x27;nickname&#x27;]</span></span><br><span class="line">    <span class="comment"># comment = dic[&#x27;data&#x27;][&#x27;comments&#x27;][6][&#x27;beReplied&#x27;][&#x27;content&#x27;]</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;用户ID：&quot;</span> + <span class="built_in">str</span>(userId) + <span class="string">&quot;   用户名：&quot;</span> + nickname + <span class="string">&quot;   评论内容：&quot;</span> + comment)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理加密过程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function a(a = 16) &#123;</span></span><br><span class="line"><span class="string">        var d, e, b = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;, c = &quot;&quot;;</span></span><br><span class="line"><span class="string">        for (d = 0; a &gt; d; d += 1) # 循环16次</span></span><br><span class="line"><span class="string">            e = Math.random() * b.length, # 随机数，假如是 1.2345</span></span><br><span class="line"><span class="string">            e = Math.floor(e), # 取整 ，假设下会变为 1</span></span><br><span class="line"><span class="string">            c += b.charAt(e); # 取字符串中的xxx位置 假设下会拿出字母b</span></span><br><span class="line"><span class="string">        return c #产生随机的16位字符串</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function b(a, b) &#123; # a是要加密的内容</span></span><br><span class="line"><span class="string">        var c = CryptoJS.enc.Utf8.parse(b) # b是密钥</span></span><br><span class="line"><span class="string">          , d = CryptoJS.enc.Utf8.parse(&quot;0102030405060708&quot;)</span></span><br><span class="line"><span class="string">          , e = CryptoJS.enc.Utf8.parse(a) # e是数据</span></span><br><span class="line"><span class="string">          , f = CryptoJS.AES.encrypt(e, c, &#123;   # c是加密的密钥</span></span><br><span class="line"><span class="string">            iv: d, # 偏移量</span></span><br><span class="line"><span class="string">            mode: CryptoJS.mode.CBC #CBC模式加密</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">        return f.toString()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function c(a, b, c) &#123;   #c不产生随机数</span></span><br><span class="line"><span class="string">        var d, e;</span></span><br><span class="line"><span class="string">        return setMaxDigits(131),</span></span><br><span class="line"><span class="string">        d = new RSAKeyPair(b,&quot;&quot;,c),</span></span><br><span class="line"><span class="string">        e = encryptedString(d, a)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">d:数据</span></span><br><span class="line"><span class="string">e:010001</span></span><br><span class="line"><span class="string">f:&#x27;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#x27;</span></span><br><span class="line"><span class="string">g:&#x27;0CoJUm6Qyw8W8jud&#x27;</span></span><br><span class="line"><span class="string">    function d(d, e, f, g) &#123;</span></span><br><span class="line"><span class="string">        var h = &#123;&#125; #h现在是空对象</span></span><br><span class="line"><span class="string">          , i = a(16); #根据a函数，可以发现i为16位的随机值，我们就要把i想办法设置为定值</span></span><br><span class="line"><span class="string">        return h.encText = b(d, g), # g就是密钥</span></span><br><span class="line"><span class="string">        h.encText = b(h.encText, i),  #返回的就是params,流程是：数据+g =&gt; b() =&gt; 第一次加密+i =&gt; b() =&gt; params , i也是密钥</span></span><br><span class="line"><span class="string">        h.encSecKey = c(i, e, f), #得到encSecKey,e和f是定死的，c函数也没有随机数产生，所以只取决于i。如果此时把i设置为定值，encSeckey就固定了</span></span><br><span class="line"><span class="string">        h</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function e(a, b, d, e) &#123;</span></span><br><span class="line"><span class="string">        var f = &#123;&#125;;</span></span><br><span class="line"><span class="string">        return f.encText = c(a + e, b, d),</span></span><br><span class="line"><span class="string">        f</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074209.jpg"
                      alt="image-20220915163007916"
                ></p>
<p>​    评论还是挺逆天的。</p>
<hr>
<h3 id="四"><a href="#四" class="headerlink" title="四"></a>四</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>​    可以解决爬⾍的基本抓取流程了. 但是抓取效率还是不够⾼. 可以选择多线程, 多进程, 协程等操作完成异步爬⾍. 这⾥我们不讨论蹩脚的概念性问题. 直接说效果. 打个⽐⽅, 我们⽬前写的爬⾍可以理解为单线程, ⽐喻为单⻋道公路. 如何提⾼效率呢? 很简单, 搞成多⻋道就OK了啊. 异步爬⾍你就可以 理解为多⻋道同时进⾏爬取.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074211.jpg"
                      alt="image-20220917144837004"
                ></p>
<p>​    在这⾥要特殊说明⼀下. 多线程异步爬⾍中每⼀步都可以设⽴成多线 程的. 具体操作得实际去分析. 当然, 也可以像我画图这样, 每⼀个url ⼀个单独线程. 还是那句话. 技术是死的. ⼈是活的. 怎么⼲还得看自己</p>
<h4 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h4><p>​    进程是一个资源单位，线程是一个执行单位。每一个进程至少要有一个线程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;func&quot;</span>, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动每一个程序默认都会有一个主线程</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    func()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;main&quot;</span>, i)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74212.jpg"
                      alt="image-20220917150208086"
                ></p>
<p>​    现在这是一个单线程，下面实现一个多线程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># def func():</span></span><br><span class="line"><span class="comment">#     for i in range(1000):</span></span><br><span class="line"><span class="comment">#         print(&quot;func&quot;, i)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># # 启动每一个程序默认都会有一个主线程</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     func()</span></span><br><span class="line"><span class="comment">#     for i in range(1000):</span></span><br><span class="line"><span class="comment">#         print(&quot;main&quot;, i)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多线程</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;func&quot;</span>, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t = Thread(target=func)  <span class="comment"># 给线程安排任务,注意这里没括号</span></span><br><span class="line">    t.start()  <span class="comment"># 多线程状态可以开始为工作状态，具体的执行时间由CPU决定</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;main&quot;</span>, i)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074214.jpg"
                      alt="image-20220917153356405"
                ></p>
<p>​    注意上面是没有括号的，加括号是对函数执行结果的调用，不加括号是对函数的调用</p>
<p>​    另一种写法，覆写run方法，和java挺像这里，不懂的可以去看我的java文章</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># def func():</span></span><br><span class="line"><span class="comment">#     for i in range(1000):</span></span><br><span class="line"><span class="comment">#         print(&quot;func&quot;, i)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># # 启动每一个程序默认都会有一个主线程</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     func()</span></span><br><span class="line"><span class="comment">#     for i in range(1000):</span></span><br><span class="line"><span class="comment">#         print(&quot;main&quot;, i)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # 多线程</span></span><br><span class="line"><span class="comment"># from threading import Thread</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def func():</span></span><br><span class="line"><span class="comment">#     for i in range(1000):</span></span><br><span class="line"><span class="comment">#         print(&quot;func&quot;, i)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     t = Thread(target=func)  # 给线程安排任务,注意这里没括号</span></span><br><span class="line"><span class="comment">#     t.start()  # 多线程状态可以开始为工作状态，具体的执行时间由CPU决定</span></span><br><span class="line"><span class="comment">#     for i in range(1000):</span></span><br><span class="line"><span class="comment">#         print(&quot;main&quot;, i)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 另一种写法</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;子线程&quot;</span>, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t = MyThread()</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;主线程&quot;</span>, i)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74215.jpg"
                      alt="image-20220917154229629"
                ></p>
<h4 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h4><p>​    用的比较少，开进程消耗资源比较多</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;子进程&quot;</span>, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = Process(target=func)</span><br><span class="line">    p.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;主进程&quot;</span>, i)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074216.jpg"
                      alt="image-20220917171218048"
                ></p>
<p>​    那么有时候我们需要给函数传参数，可以这么实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        <span class="built_in">print</span>(name, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t1 = Thread(target=func, args=(<span class="string">&quot;周杰伦&quot;</span>,))  <span class="comment"># 必须是元组</span></span><br><span class="line">    t2 = Thread(target=func, args=(<span class="string">&quot;王⼒宏&quot;</span>,))</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074218.jpg"
                      alt="image-20220917171708698"
                ></p>
<h4 id="线程池和进程池"><a href="#线程池和进程池" class="headerlink" title="线程池和进程池"></a>线程池和进程池</h4><p>​    发现这⽹站的数据太多了. 有⼀万多⻚. 也就对应着 ⼀万多个url. 那我们设计多线程的时候如果每个url对应⼀个线程就 会产⽣新问题. 朋友, 你⼀定要知道. 创建线程本身也是要消耗你的计 算机资源的. 线程不是变魔术变出来的. 那这时我们就可以考虑能不 能重复的使⽤线程呢? 答案当然可以. 线程池就可以帮你搞定.</p>
<p>​    线程池⼯作原理: 创建⼀个⼤池⼦, 存放固定数量的线程. 然后把我们要执⾏的任务丢给线程池. 由线程池去分配哪个线程来完成该任务. 其他的事情都不需要管.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fn</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(name, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 创建线程池</span></span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor(<span class="number">50</span>) <span class="keyword">as</span> t:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">            t.submit(fn, name=<span class="string">f&quot;线程<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 等待线程池中的任务全部执行完毕，才继续执行（守护）</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;123&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="线程池案例-搞搞菜价"><a href="#线程池案例-搞搞菜价" class="headerlink" title="线程池案例_搞搞菜价"></a>线程池案例_搞搞菜价</h4><p>​    线程池一般思路：</p>
<p>​    1、如何提取单个页面的数据</p>
<p>​    2、上线程池，多个页面同时抓取</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074219.jpg"
                      alt="image-20220919133926356"
                ></p>
<p>​    这个效率非常低下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.xinfadi.com.cn/getPriceData.html&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                  <span class="string">&quot;Chrome/104.0.0.0 Safari/537.36 &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;data.csv&quot;</span>, mode=<span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">csvwriter = csv.writer(f)</span><br><span class="line"></span><br><span class="line">list1 = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_all_page</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18157</span>):  <span class="comment"># 效率非常低下</span></span><br><span class="line">        data = <span class="string">f&quot;limit=20&amp;current=<span class="subst">&#123;i&#125;</span>&amp;pubDateStartTime=&amp;pubDateEndTime=&amp;prodPcatid=&amp;prodCatid=&amp;prodName=&quot;</span></span><br><span class="line">        resp = requests.post(url, data=data, headers=headers)</span><br><span class="line">        respdata = resp.json()[<span class="string">&quot;list&quot;</span>]</span><br><span class="line">        <span class="comment"># print(respdata)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">            onedata = respdata[i].items()</span><br><span class="line">            list1 = <span class="built_in">list</span>(onedata)</span><br><span class="line">            <span class="built_in">print</span>(list1)</span><br><span class="line">            csvwriter.writerow(list1)</span><br><span class="line">        <span class="built_in">print</span>(url + data, <span class="string">&quot;提取完毕!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    download_all_page(url)</span><br></pre></td></tr></table></figure>

<p>​    这里出现了一些小问题，知道思路好了，就不搞了，在改版前抓取的代码是这样的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="comment"># ⼲掉新发地</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">url</span>):</span><br><span class="line">	resp = requests.get(url)</span><br><span class="line">	html = etree.HTML(resp.text)</span><br><span class="line">	table =html.xpath(<span class="string">&quot;/html/body/div[2]/div[4]/div[1]/table&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">	trs = table.xpath(<span class="string">&quot;./tr[position()&gt;1]&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> tr <span class="keyword">in</span> trs:</span><br><span class="line"> 		tr_text = tr.xpath(<span class="string">&quot;./td/child::text()&quot;</span>)</span><br><span class="line"> 		tr_text = (item.replace(<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="keyword">for</span> item <span class="keyword">in</span> tr_text)</span><br><span class="line">		csv_writer.writerow(tr_text)</span><br><span class="line"> 	<span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"> 	csv_writer = csv.writer(<span class="built_in">open</span>(<span class="string">&quot;菜价.csv&quot;</span>,mode=<span class="string">&quot;w&quot;</span>))</span><br><span class="line"> 	<span class="keyword">with</span> ThreadPoolExecutor(<span class="number">50</span>) <span class="keyword">as</span> t:</span><br><span class="line"> 		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>): <span class="comment"># 别弄太狠. 不好</span></span><br><span class="line">			url_temp = <span class="string">f&quot;http://www.xinfadi.com.cn/marketanalysis/0/list</span></span><br><span class="line"><span class="string">/<span class="subst">&#123;i&#125;</span>.shtml&quot;</span></span><br><span class="line"> 		t.submit(fn=download, url=url_temp)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;all down!&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h4><p>​    协程是我要重点去讲解的⼀个知识点. 它能够更加⾼效的利⽤CPU. </p>
<p>​    其实, 我们能够⾼效的利⽤多线程来完成爬⾍其实已经很6了. 但是, 从某种⻆度讲, 线程的执⾏效率真的就⽆敌了么? 我们真的充分的利⽤CPU资源了么? </p>
<p>​    ⾮也~ ⽐如, 我们来看下⾯这个例⼦. 我们单独的⽤⼀个线程来完成某⼀个操作. 看看它的效率是否真的能 把CPU完全利⽤起来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我爱黎明&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我真的爱黎明&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    func()</span><br></pre></td></tr></table></figure>

<p>​    在该程序中, 我们的func()实际在执⾏的时候⾄少需要3秒的时间来完成操作. 中间的三秒钟需要让我当前的线程处于阻塞状态. 阻塞状态的线程 CPU是不会来执⾏你的. 那么此时cpu很可能会切换到其他程序上去执⾏. 此时, 对于你来说, CPU其实并没有为你 ⼯作(在这三秒内), 那么我们能不能通过某种⼿段, 让CPU⼀直为我⽽⼯作. 尽量的不要去管其他⼈. </p>
<p>​    我们要知道CPU⼀般抛开执⾏周期不谈, 如果⼀个线程遇到了IO操作, CPU就会⾃动的切换到其他线程进⾏执⾏. 那么, 如果我想办法让我的线程遇到了IO操作就挂起, 留下的都是运算操作. 那CPU是不是就会⻓时间的来照顾我. </p>
<p>​    以此为⽬的, 伟⼤的程序员就发明了⼀个新的执⾏过程. <strong>协程：当线程中遇到了IO操作的时候, 将线程中的任务进⾏切换, 切换成⾮ IO操作. 等原来的IO执⾏完了. 再恢复回原来的任务中.</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074221.jpg"
                      alt="image-20220919155532043"
                ></p>
<p>​    就形成了这样⼀种模型, 在程序遇到了IO操作(费时不费⼒的操作)时, ⾃动切换到其他任务. 该模型被称为协程. </p>
<p>​    协程：当程序遇见了I0操作的时候，可以选择性的切换到其他任务上，在微观上是一个任务一个任务的进行切换．切换条件一般就是I0操作。在宏观上，我们能看到的其实是多个任务一起在执行，也就是一个多任务异步操作。不过<strong>这些所讲的一切都是在单线程条件下</strong>。</p>
<p>​        协程的基本写法: 咱就介绍⼀种, 也是最好⽤的⼀种, 如果各位想看更加详细, 细致的协程推导过程。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 协程：当程序遇见了I0操作的时候，可以选择性的切换到其他任务上，</span></span><br><span class="line"><span class="comment"># 在微观上是一个任务一个任务的进行切换．切换条件一般就是I0操作</span></span><br><span class="line"><span class="comment"># 在宏观上，我们能看到的其实是多个任务一起在执行</span></span><br><span class="line"><span class="comment"># 多任务异步操作</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我叫赛利亚&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    g = func()  <span class="comment"># 此时的函数是异步协程函数，此时函数执行得到的是一个协程对象</span></span><br><span class="line">    <span class="comment"># print(g)</span></span><br><span class="line">    asyncio.run(g)  <span class="comment"># 协程程序运行霜要asyncio模块的支持</span></span><br></pre></td></tr></table></figure>

<p>​    此时是并不会比原来快的，我们重新建一个任务</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 协程：当程序遇见了I0操作的时候，可以选择性的切换到其他任务上，</span></span><br><span class="line"><span class="comment"># 在微观上是一个任务一个任务的进行切换．切换条件一般就是I0操作</span></span><br><span class="line"><span class="comment"># 在宏观上，我们能看到的其实是多个任务一起在执行</span></span><br><span class="line"><span class="comment"># 多任务异步操作</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是mes9s0&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是mes9s0&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是王建国&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是王建国&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func3</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是李雪琴&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">4</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是李雪琴&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    f1 = func1()</span><br><span class="line">    f2 = func2()</span><br><span class="line">    f3 = func3()</span><br><span class="line">    tasks = [</span><br><span class="line">        f1, f2, f3</span><br><span class="line">    ]</span><br><span class="line">    t1 = time.time()  <span class="comment"># 记录时间</span></span><br><span class="line">    <span class="comment"># 一次启动多个任务(协程)</span></span><br><span class="line">    asyncio.run(asyncio.wait(tasks))</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    <span class="built_in">print</span>(t2 - t1)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-74222.jpg"
                      alt="image-20220919161037452"
                ></p>
<p>​    这会疑问了，我们明明是异步操作，却还是9s多，这是因为当程序出现了同步操作的时候，异步就中断了。我们这么修改下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 协程：当程序遇见了I0操作的时候，可以选择性的切换到其他任务上，</span></span><br><span class="line"><span class="comment"># 在微观上是一个任务一个任务的进行切换．切换条件一般就是I0操作</span></span><br><span class="line"><span class="comment"># 在宏观上，我们能看到的其实是多个任务一起在执行</span></span><br><span class="line"><span class="comment"># 多任务异步操作</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是mes9s0&quot;</span>)</span><br><span class="line">    <span class="comment"># time.sleep(3)  # 当程序出现了同步操作的时候，异步就中断了</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是mes9s0&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是王建国&quot;</span>)</span><br><span class="line">    <span class="comment"># time.sleep(2)</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是王建国&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func3</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是李雪琴&quot;</span>)</span><br><span class="line">    <span class="comment"># time.sleep(4)</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">4</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是李雪琴&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    f1 = func1()</span><br><span class="line">    f2 = func2()</span><br><span class="line">    f3 = func3()</span><br><span class="line">    tasks = [</span><br><span class="line">        f1, f2, f3</span><br><span class="line">    ]</span><br><span class="line">    t1 = time.time()  <span class="comment"># 记录时间</span></span><br><span class="line">    <span class="comment"># 一次启动多个任务(协程)</span></span><br><span class="line">    asyncio.run(asyncio.wait(tasks))</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    <span class="built_in">print</span>(t2 - t1)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074223.jpg"
                      alt="image-20220919165911861"
                ></p>
<p>​    这只是一种直观的观察方式，平时我们不这么写代码，我们再修改下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是mes9s0&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是mes9s0&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是王建国&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是王建国&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func3</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是李雪琴&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">4</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是李雪琴&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 写法一 , 不推荐</span></span><br><span class="line">    <span class="comment"># f1 = func1()</span></span><br><span class="line">    <span class="comment"># await f1  # 一般await挂起操作放在协程对象前面</span></span><br><span class="line">    <span class="comment"># 写法二</span></span><br><span class="line">    tasks = [</span><br><span class="line">        func1(),</span><br><span class="line">        func2(),</span><br><span class="line">        func3()</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t1 = time.time()</span><br><span class="line">    asyncio.run(main())</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    <span class="built_in">print</span>(t2 - t1)</span><br></pre></td></tr></table></figure>

<p>​    下面提供一个模版，注意只是演示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;准备开始下载&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 模拟网络请求</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;下载完成&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    urls = [</span><br><span class="line">        <span class="string">&quot;http://www.baidu.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http://www.bilibili.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http://www.163.com&quot;</span></span><br><span class="line">    ]</span><br><span class="line">    tasks = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        d = download(url)</span><br><span class="line">        tasks.append(d)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>

<p>​    注意，3.8可能会报一个警告。在后续的写法里我们需要吧对象包装成协程对象就可以</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # 协程：当程序遇见了I0操作的时候，可以选择性的切换到其他任务上，</span></span><br><span class="line"><span class="comment"># # 在微观上是一个任务一个任务的进行切换．切换条件一般就是I0操作</span></span><br><span class="line"><span class="comment"># # 在宏观上，我们能看到的其实是多个任务一起在执行</span></span><br><span class="line"><span class="comment"># # 多任务异步操作</span></span><br><span class="line"><span class="comment"># import asyncio</span></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># async def func1():</span></span><br><span class="line"><span class="comment">#     print(&quot;你好啊，我是mes9s0&quot;)</span></span><br><span class="line"><span class="comment">#     # time.sleep(3)  # 当程序出现了同步操作的时候，异步就中断了</span></span><br><span class="line"><span class="comment">#     await asyncio.sleep(3)  # 异步操作的代码</span></span><br><span class="line"><span class="comment">#     print(&quot;你好啊，我是mes9s0&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># async def func2():</span></span><br><span class="line"><span class="comment">#     print(&quot;你好啊，我是王建国&quot;)</span></span><br><span class="line"><span class="comment">#     # time.sleep(2)</span></span><br><span class="line"><span class="comment">#     await asyncio.sleep(2)  # 异步操作的代码</span></span><br><span class="line"><span class="comment">#     print(&quot;你好啊，我是王建国&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># async def func3():</span></span><br><span class="line"><span class="comment">#     print(&quot;你好啊，我是李雪琴&quot;)</span></span><br><span class="line"><span class="comment">#     # time.sleep(4)</span></span><br><span class="line"><span class="comment">#     await asyncio.sleep(4)  # 异步操作的代码</span></span><br><span class="line"><span class="comment">#     print(&quot;你好啊，我是李雪琴&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     f1 = func1()</span></span><br><span class="line"><span class="comment">#     f2 = func2()</span></span><br><span class="line"><span class="comment">#     f3 = func3()</span></span><br><span class="line"><span class="comment">#     tasks = [</span></span><br><span class="line"><span class="comment">#         f1, f2, f3</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment">#     t1 = time.time()  # 记录时间</span></span><br><span class="line"><span class="comment">#     # 一次启动多个任务(协程)</span></span><br><span class="line"><span class="comment">#     asyncio.run(asyncio.wait(tasks))</span></span><br><span class="line"><span class="comment">#     t2 = time.time()</span></span><br><span class="line"><span class="comment">#     print(t2 - t1)</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是mes9s0&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是mes9s0&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是王建国&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是王建国&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func3</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是李雪琴&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">4</span>)  <span class="comment"># 异步操作的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你好啊，我是李雪琴&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 写法一 , 不推荐</span></span><br><span class="line">    <span class="comment"># f1 = func1()</span></span><br><span class="line">    <span class="comment"># await f1  # 一般await挂起操作放在协程对象前面</span></span><br><span class="line">    <span class="comment"># 写法二</span></span><br><span class="line">    tasks = [</span><br><span class="line">        asyncio.create_task(func1()),</span><br><span class="line">        asyncio.create_task(func2()),</span><br><span class="line">        asyncio.create_task(func3())</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t1 = time.time()</span><br><span class="line">    asyncio.run(main())</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    <span class="built_in">print</span>(t2 - t1)</span><br></pre></td></tr></table></figure>

<h4 id="异步http请求aiohttp模块"><a href="#异步http请求aiohttp模块" class="headerlink" title="异步http请求aiohttp模块"></a>异步http请求aiohttp模块</h4><p>​    aiohttp是python的⼀个⾮常优秀的第三⽅异步http请求库. 我们可以 ⽤aiohttp来编写异步爬⾍(协程).</p>
<p>​    写一个试一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># requests.get()同步的代码 -&gt; 异步操作aiohttp</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"></span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&quot;https://www.umei.cc/d/file/20220919/d39ee6d21a61bac1ca1837c8e64015ab.jpg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://www.umei.cc/d/file/20220919/3ccb2fe3793d9eb05e5aac78d21fc136.jpg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://www.umei.cc/d/file/20220919/34e157502386c3abfadf159c717cc393.jpg&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">aiodownload</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="comment"># s = aiohttp.ClientSession() &lt;==&gt; requests.session()</span></span><br><span class="line">    <span class="comment"># requests.get()   .post()</span></span><br><span class="line">    <span class="comment"># s.get()    .post()</span></span><br><span class="line">    <span class="comment"># 发送请求</span></span><br><span class="line">    <span class="comment"># 得到图片内容</span></span><br><span class="line">    <span class="comment"># 保存文件</span></span><br><span class="line">    <span class="comment"># 加with的作用是不用关链接了</span></span><br><span class="line">    name = url.rsplit(<span class="string">&quot;/&quot;</span>, <span class="number">1</span>)[<span class="number">1</span>]  <span class="comment"># 从右边切，切一次，得到[1]位置的内容</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:  <span class="comment"># requests</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> resp:  <span class="comment"># resp = requests.get()</span></span><br><span class="line">            <span class="comment"># 请求回来了，写入文件</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(name, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="keyword">await</span> resp.content.read())  <span class="comment"># 读取内容异步的，需要await挂起</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;搞定&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    tasks = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        tasks.append(aiodownload(url))</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h4 id="异步爬虫扒光西游记"><a href="#异步爬虫扒光西游记" class="headerlink" title="异步爬虫扒光西游记"></a>异步爬虫扒光西游记</h4><p>​    分析网站得到一下几个url</p>
<p>​    <a class="link"   target="_blank" rel="noopener" href="https://dushu.baidu.com/api/pc/getCatalog?data=%7B&quot;book_id&quot;:&quot;4306063500&quot;%7D" >https://dushu.baidu.com/api/pc/getCatalog?data={&quot;book_id&quot;:&quot;4306063500&quot;}<i class="fas fa-external-link-alt"></i></a> =&gt; 所有章节的内容(名称，cid)</p>
<p>​    <a class="link"   target="_blank" rel="noopener" href="https://dushu.baidu.com/api/pc/getChapterContent?data=%7B&quot;book_id&quot;:&quot;4306063500&quot;,&quot;cid&quot;:&quot;4306063500%7C1569782244&quot;,&quot;need_bookinfo&quot;:1%7D" >https://dushu.baidu.com/api/pc/getChapterContent?data={&quot;book_id&quot;:&quot;4306063500&quot;,&quot;cid&quot;:&quot;4306063500|1569782244&quot;,&quot;need_bookinfo&quot;:1}<i class="fas fa-external-link-alt"></i></a> =&gt; 章节的内容</p>
<p>​    分析一下，上面的url我们并不需要异步，而后面爬取网站的时候才需要。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://dushu.baidu.com/api/pc/getCatalog?data=&#123;&quot;book_id&quot;:&quot;4306063500&quot;&#125; =&gt; 所有章节的内容(名称，cid)</span></span><br><span class="line"><span class="comment"># 章节内部的内容</span></span><br><span class="line"><span class="comment"># https://dushu.baidu.com/api/pc/getChapterContent?data=&#123;&quot;book_id&quot;:&quot;4306063500&quot;,&quot;cid&quot;:&quot;4306063500|1569782244&quot;,&quot;need_bookinfo&quot;:1&#125;</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> aiofiles</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1. 同步操作：访问getCatalog 拿到所有章节的cid和名称</span></span><br><span class="line"><span class="string">2. 异步操作：访问getchapterContent 下载所有的文章内容</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">aiodownload</span>(<span class="params">cid, b_id, title</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;book_id&quot;</span>: b_id,</span><br><span class="line">        <span class="string">&quot;cid&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;b_id&#125;</span>|<span class="subst">&#123;cid&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;need_bookinfo&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = json.dumps(data)</span><br><span class="line">    url = <span class="string">f&quot;https://dushu.baidu.com/api/pc/getChapterContent?data=<span class="subst">&#123;data&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span>  <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> resp:</span><br><span class="line">            dic = <span class="keyword">await</span> resp.json()</span><br><span class="line">            <span class="comment"># 文件异步读写</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">with</span> aiofiles.<span class="built_in">open</span>(<span class="string">&quot;novel/&quot;</span> + title, mode=<span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="keyword">await</span> f.write(dic[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;novel&#x27;</span>][<span class="string">&#x27;content&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">getCatlog</span>(<span class="params">url</span>):</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    dic = resp.json()</span><br><span class="line">    tasks = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> dic[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;novel&#x27;</span>][<span class="string">&#x27;items&#x27;</span>]:</span><br><span class="line">        title = item[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">        cid = item[<span class="string">&#x27;cid&#x27;</span>]</span><br><span class="line">        <span class="comment"># 准备异步任务</span></span><br><span class="line">        tasks.append(asyncio.create_task(aiodownload(cid, b_id, title)))</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    b_id = <span class="string">&quot;4306063500&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;https://dushu.baidu.com/api/pc/getCatalog?data=&#123;&quot;book_id&quot;:&quot;&#x27;</span> + b_id + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">    asyncio.run(getCatlog(url))</span><br></pre></td></tr></table></figure>

<p>​    一瞬间就好了</p>
<h4 id="综合训练-视频网站工作原理"><a href="#综合训练-视频网站工作原理" class="headerlink" title="综合训练-视频网站工作原理"></a>综合训练-视频网站工作原理</h4><p>​    你现在想要做⼀个视频⽹站. 也有很多的UP猪帮你上传视频. OK, 作为服务器作者的你. 只需要把视频保存起来. 然后给出⼀个视频的链接即可. 然后在你的HTML代码中通过 video 标签引⼊即可.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;1_1_爬⾍概述.mp4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    就可以了. 但是, 如果你这么做. 你的⽤户和⽼板⼀定会把你骂的狗⾎临头. 为什么呢? 假设你的视频是10个G的⾼清⽆码⼤资源. 那么此时, 你的⽤户和你⽼板将⾯临如下困境</p>
<pre><code> 1. ⽤户: 这个视频怎么加载的这么慢. 点击快进也快进不了. 太慢了. 
 1. ⽼板: 怎么这个⽉的流量费⼜这么⾼啊. 
</code></pre>
<p>​    视频那么⼤. 每次⽤户打开的时候. 可能只是差了最后⼏分钟没看呢. 那此时它必须把整个视 频都传输完毕. 才能看到他想看的那⾥. 等待时间肯定超⻓. ⽽每次都要把10G的⽂件进⾏⽹络传输. 流量费你懂的. </p>
<p>​    但凡有点⼉经验的程序员肯定会想办法把⽤户上传好的视频进⾏转码(不同清晰度)做切⽚(ts)处理. 这样既⽅便⽤户进⾏⼤跨度的调整进度条(最⼩延迟). 也能为公司节省⼤量的流量费. 既然要把视频切成⾮常多个⼩碎⽚. 那就需要有个⽂件来记录这些<strong>视频播放的顺序和⼩碎⽚的路径</strong>. </p>
<p>​    该⽂件⼀般为M3U⽂件. M3U⽂件中的内容经过UTF-8 的编码后, 就是M3U8⽂件. 今天, 我们看到的各⼤视频⽹站平台使⽤的⼏乎都是M3U8⽂件.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://mes9s0hexo.oss-cn-hangzhou.aliyuncs.com/2023-04-15-074226.jpg"
                      alt="image-20220921013924750"
                ></p>
<p>​    那么抓取一个视频的流程如下：</p>
<p>​    1、找到m3u8（各种手段）2、通过m3u8下载到ts文件 3、通过各种手段（不仅仅是编程手段）把ts文件合并为一个mp4文件</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：Python爬虫从零到一</li>
        <li>本文作者：mes9s0</li>
        <li>创建时间：2022-08-13 22:12:29</li>
        <li>
            本文链接：https://mes9s0.github.io/2022/08/13/Python爬虫从零到一/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Python/">#Python</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E7%88%AC%E8%99%AB/">#爬虫</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/08/26/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%BB%E5%87%BB%E9%9D%A2%F0%9F%98%AA/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">数据库攻击面😪</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/08/07/%E6%B2%A1%E7%94%A8%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7-RED/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">没用的小技巧(RED)</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="valine-container">
        <script 
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script >
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'VOW0hvnes0uKAXRkVyEuVvR4-9Nh9j0Va',
                    appKey: '46zItzkbXxcS29wD64JlGikD',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情吐槽吧~',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'mes9s0';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('false') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">mes9s0</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80"><span class="nav-number">1.</span> <span class="nav-text">一</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#robots-txt"><span class="nav-number">1.1.</span> <span class="nav-text">robots.txt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#py%E5%AD%97%E7%AC%A6%E9%9B%86%E9%97%AE%E9%A2%98"><span class="nav-number">1.2.</span> <span class="nav-text">py字符集问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%B0%8F%E7%88%AC%E8%99%AB"><span class="nav-number">1.3.</span> <span class="nav-text">第一个小爬虫</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web%E8%AF%B7%E6%B1%82%E5%89%96%E6%9E%90"><span class="nav-number">1.4.</span> <span class="nav-text">web请求剖析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B8%B2%E6%9F%93"><span class="nav-number">1.4.1.</span> <span class="nav-text">服务器渲染</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%89%8D%E7%AB%AFJS%E6%B8%B2%E6%9F%93"><span class="nav-number">1.4.2.</span> <span class="nav-text">前端JS渲染</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.5.</span> <span class="nav-text">HTTP协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#requests%E6%A8%A1%E5%9D%97%E2%BC%8A%E2%BB%94%E2%80%93GET"><span class="nav-number">1.6.</span> <span class="nav-text">requests模块⼊⻔–GET</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#requests%E6%A8%A1%E5%9D%97%E2%BC%8A%E2%BB%94%E2%80%93POST"><span class="nav-number">1.7.</span> <span class="nav-text">requests模块⼊⻔–POST</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#requests%E6%A8%A1%E5%9D%97%E2%BC%8A%E2%BB%94%E2%80%93GET%E8%BF%9B%E9%98%B6"><span class="nav-number">1.8.</span> <span class="nav-text">requests模块⼊⻔–GET进阶</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C"><span class="nav-number">2.</span> <span class="nav-text">二</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E6%A6%82%E8%BF%B0"><span class="nav-number">2.1.</span> <span class="nav-text">数据解析概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">2.2.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#re%E6%A8%A1%E5%9D%97"><span class="nav-number">2.3.</span> <span class="nav-text">re模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B1%86%E7%93%A3top250%E7%94%B5%E5%BD%B1%E6%8E%92%E8%A1%8C%E6%A6%9C"><span class="nav-number">2.4.</span> <span class="nav-text">豆瓣top250电影排行榜</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%B5%E5%BD%B1%E5%A4%A9%E5%A0%82yyds"><span class="nav-number">2.5.</span> <span class="nav-text">电影天堂yyds</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bs4%E8%A7%A3%E6%9E%90%E5%89%8D%E6%88%8F-html%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99"><span class="nav-number">2.6.</span> <span class="nav-text">bs4解析前戏-html语法规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bs4%E8%A7%A3%E6%9E%90%E5%85%A5%E9%97%A8-%E8%B1%86%E7%93%A3top%E8%8E%B7%E5%8F%96"><span class="nav-number">2.7.</span> <span class="nav-text">bs4解析入门-豆瓣top获取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bs4%E8%A7%A3%E6%9E%90%E5%85%A5%E9%97%A8-%E6%96%B0%E5%8F%91%E5%9C%B0%E7%88%AC%E8%99%AB"><span class="nav-number">2.8.</span> <span class="nav-text">bs4解析入门-新发地爬虫</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96%E5%94%AF%E7%BE%8E%E5%A3%81%E7%BA%B8%E5%9B%BE%E7%89%87"><span class="nav-number">2.9.</span> <span class="nav-text">抓取唯美壁纸图片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Xpath%E5%85%A5%E9%97%A8"><span class="nav-number">2.10.</span> <span class="nav-text">Xpath入门</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Xpath%E5%AE%9E%E6%88%98-%E7%8C%AA%E5%85%AB%E6%88%92%E4%BF%A1%E6%81%AF"><span class="nav-number">2.11.</span> <span class="nav-text">Xpath实战-猪八戒信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89"><span class="nav-number">3.</span> <span class="nav-text">三</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#requests%E8%BF%9B%E9%98%B6%E6%A6%82%E8%BF%B0"><span class="nav-number">3.1.</span> <span class="nav-text">requests进阶概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86cookie%E7%99%BB%E9%99%86%E5%B0%8F%E8%AF%B4%E7%BD%91"><span class="nav-number">3.2.</span> <span class="nav-text">处理cookie登陆小说网</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%B2%E7%9B%97%E9%93%BE%E6%8A%93%E5%8F%96%E6%A2%A8%E8%A7%86%E9%A2%91"><span class="nav-number">3.3.</span> <span class="nav-text">防盗链抓取梨视频</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%90%86"><span class="nav-number">3.4.</span> <span class="nav-text">代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E8%AF%84%E8%AE%BA%E4%BF%A1%E6%81%AF"><span class="nav-number">3.5.</span> <span class="nav-text">网易云音乐评论信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B"><span class="nav-number">4.</span> <span class="nav-text">四</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">4.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="nav-number">4.2.</span> <span class="nav-text">多线程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B"><span class="nav-number">4.3.</span> <span class="nav-text">多进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%92%8C%E8%BF%9B%E7%A8%8B%E6%B1%A0"><span class="nav-number">4.4.</span> <span class="nav-text">线程池和进程池</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%A1%88%E4%BE%8B-%E6%90%9E%E6%90%9E%E8%8F%9C%E4%BB%B7"><span class="nav-number">4.5.</span> <span class="nav-text">线程池案例_搞搞菜价</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B"><span class="nav-number">4.6.</span> <span class="nav-text">协程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5http%E8%AF%B7%E6%B1%82aiohttp%E6%A8%A1%E5%9D%97"><span class="nav-number">4.7.</span> <span class="nav-text">异步http请求aiohttp模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB%E6%89%92%E5%85%89%E8%A5%BF%E6%B8%B8%E8%AE%B0"><span class="nav-number">4.8.</span> <span class="nav-text">异步爬虫扒光西游记</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%BC%E5%90%88%E8%AE%AD%E7%BB%83-%E8%A7%86%E9%A2%91%E7%BD%91%E7%AB%99%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">4.9.</span> <span class="nav-text">综合训练-视频网站工作原理</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>



</body>
</html>
